<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="RSP">
        <link rel="canonical" href="https://iot-kmutnb.github.io/blogs/teaching/fpga_tutorials/intro_7seg_time_multiplexing/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Tutorial: 4-Digit 7-Segment Display with Time Multiplexing Control - IoT Engineering Education</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/arduino.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/vhdl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/verilog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/text.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/plaintext.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/matlab.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/julia.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-966FQ6RN6W"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-966FQ6RN6W");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">IoT Engineering Education</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#tutorial-4-digit-7-segment-display-with-time-multiplexing-control" class="nav-link">Tutorial: 4-Digit 7-Segment Display with Time Multiplexing Control</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#7-segment-display-modules" class="nav-link">7-Segment Display Modules</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#time-multiplexing-technique" class="nav-link">Time-Multiplexing Technique</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#vhdl-demo-code" class="nav-link">VHDL Demo Code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#coding-exercise" class="nav-link">Coding Exercise</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="tutorial-4-digit-7-segment-display-with-time-multiplexing-control"><strong>Tutorial: 4-Digit 7-Segment Display with Time Multiplexing Control</strong><a class="headerlink" href="#tutorial-4-digit-7-segment-display-with-time-multiplexing-control" title="Permanent link">#</a></h1>
<hr />
<h2 id="7-segment-display-modules"><strong>7-Segment Display Modules</strong><a class="headerlink" href="#7-segment-display-modules" title="Permanent link">#</a></h2>
<p>A 7-segment display is an output device consisting of 7 LED segments,
along with an optional decimal point (DP). It is primarily used to
display digits from '0' to '9', and
can also represent some letters and symbols with limitations.</p>
<p>There are two types of 7-segment displays:</p>
<ul>
<li><strong>Common Cathode (CC)</strong>: All cathodes of the LEDs are connected to a common GND pin.</li>
<li><strong>Common Anode (CA)</strong>: All anodes of the LEDs are connected to a common VCC pin.</li>
</ul>
<p>A typical 7-segment display has 8 segment control pins 
('A' - 'G' and 'DP') and one common ('COM') pin.
For the CA type, the 'com' pin must be connected to VCC, 
while for the CC type, it must be connected to GND.</p>
<p>7-segment displays can have multiple digits.
Controlling each digit independently requires 8 pins per digit.
For example, a 6-digit display would need 6 Ã— 8 = 48 control pins.
Some FPGA boards, such as the <strong>MAX10-Lite</strong>, have onboard 6-digit 7-segment displays 
with separate 8-bit control lines for each digit. This configuration requires a relatively large number of I/O pins.</p>
<p><img alt="" src="4dig_7seg_module.jpg" /></p>
<p><strong>Figure:</strong> An example of 4-digit 7-segment display module</p>
<p>&nbsp;</p>
<hr />
<h2 id="time-multiplexing-technique"><strong>Time-Multiplexing Technique</strong><a class="headerlink" href="#time-multiplexing-technique" title="Permanent link">#</a></h2>
<p>To reduce the number of required control pins, <strong>time-multiplexing</strong> is often used:</p>
<ul>
<li>In this method, all digits share the same segment control lines.</li>
<li>Each digit is activated one at a time in rapid succession, with its corresponding segment data.</li>
</ul>
<p>When this switching occurs fast enough (e.g., over 100 Hz), <strong>persistence of vision</strong> 
makes it appear as if all digits are lit simultaneously, each showing its correct value.
This technique dramatically reduces I/O usage while maintaining readable output.</p>
<p>To selectively control which digit is active in a multi-digit 7-segment display, 
transistors &mdash; such as BJTs or MOSFETs &mdash; 
are used to switch the COM (common) pin of each digit.
For example, a 4-digit display would require 4 control transistors, one for each digit.</p>
<p>&nbsp;</p>
<hr />
<h2 id="vhdl-demo-code"><strong>VHDL Demo Code</strong><a class="headerlink" href="#vhdl-demo-code" title="Permanent link">#</a></h2>
<p>This VHDL code demonstrates how to control a 4-digit 7-segment display module 
(common-anode type) using a time-multiplexing technique.
The design displays a fixed BCD sequence ('0123') across the 4 digits.
When the reset signal (<code>RST_N</code>) is asserted low, all digits display '0'.</p>
<p><strong>VHDL Code Listing</strong></p>
<pre><code class="language-VHDL">-- File: disp_7seg_demo.vhd
LIBRARY ieee;
USE ieee.std_logic_1164.ALL;
USE ieee.numeric_std.ALL;

ENTITY disp_7seg_demo IS
    GENERIC (
        CLK_HZ     : NATURAL := 50000000; -- system clock frequency
        NUM_DIGITS : NATURAL := 4 -- number of digits used
    );
    PORT (
        CLK    : IN STD_LOGIC;
        RST_N  : IN STD_LOGIC;
        SEG7   : OUT STD_LOGIC_VECTOR(7 DOWNTO 0); -- 7-segment + DP
        DIGITS : OUT STD_LOGIC_VECTOR(NUM_DIGITS - 1 DOWNTO 0) -- 7seg control bits
    );
END disp_7seg_demo;

ARCHITECTURE behavioral OF disp_7seg_demo IS
    CONSTANT SCAN_CNT_MAX : NATURAL := (CLK_HZ/250) - 1;

    TYPE digit_array_t IS ARRAY (0 TO NUM_DIGITS - 1) OF INTEGER RANGE 0 TO 9;
    SIGNAL bcd_count   : digit_array_t;

    SIGNAL data_buf    : STD_LOGIC_VECTOR(7 DOWNTO 0);
    SIGNAL digits_sel  : STD_LOGIC_VECTOR(NUM_DIGITS - 1 DOWNTO 0);
    SIGNAL digit_index : NATURAL RANGE 0 TO NUM_DIGITS - 1 := 0;

    SUBTYPE nibble IS unsigned(3 DOWNTO 0);
    -- This function implements a BCD to 7-Segment decoder.
    FUNCTION BCD2SEG7(data : nibble) RETURN STD_LOGIC_VECTOR IS
        VARIABLE seg7bits  : STD_LOGIC_VECTOR(6 DOWNTO 0);
    BEGIN
        CASE data IS
            WHEN &quot;0000&quot; =&gt; seg7bits := &quot;0111111&quot;; -- 0
            WHEN &quot;0001&quot; =&gt; seg7bits := &quot;0000110&quot;; -- 1
            WHEN &quot;0010&quot; =&gt; seg7bits := &quot;1011011&quot;; -- 2
            WHEN &quot;0011&quot; =&gt; seg7bits := &quot;1001111&quot;; -- 3
            WHEN &quot;0100&quot; =&gt; seg7bits := &quot;1100110&quot;; -- 4
            WHEN &quot;0101&quot; =&gt; seg7bits := &quot;1101101&quot;; -- 5
            WHEN &quot;0110&quot; =&gt; seg7bits := &quot;1111101&quot;; -- 6
            WHEN &quot;0111&quot; =&gt; seg7bits := &quot;0000111&quot;; -- 7
            WHEN &quot;1000&quot; =&gt; seg7bits := &quot;1111111&quot;; -- 8
            WHEN &quot;1001&quot; =&gt; seg7bits := &quot;1101111&quot;; -- 9
            WHEN OTHERS =&gt; seg7bits := &quot;0000000&quot;; -- off
        END CASE;
        RETURN seg7bits;
    END BCD2SEG7;

BEGIN

    PROCESS (RST_N, CLK)
    BEGIN
        IF RST_N = '0' THEN
            bcd_count(0) &lt;= 0;
            bcd_count(1) &lt;= 0;
            bcd_count(2) &lt;= 0;
            bcd_count(3) &lt;= 0;
        ELSIF rising_edge(CLK) THEN
            bcd_count(0) &lt;= 0;
            bcd_count(1) &lt;= 1;
            bcd_count(2) &lt;= 2;
            bcd_count(3) &lt;= 3;
        END IF;
    END PROCESS;

    -- This process implements a 7-segment driver using time-multiplexing.
    PROCESS (RST_N, CLK)
        VARIABLE wait_cnt    : NATURAL RANGE 0 TO SCAN_CNT_MAX := 0;
        VARIABLE clk_enabled : BOOLEAN;
        VARIABLE bcd_value   : unsigned(3 DOWNTO 0);
    BEGIN
        IF RST_N = '0' THEN
            wait_cnt := 0;
            data_buf &lt;= x&quot;00&quot;;
            digits_sel &lt;= (OTHERS =&gt; '0');
            digit_index &lt;= 0;
        ELSIF rising_edge(CLK) THEN
            IF wait_cnt = SCAN_CNT_MAX THEN
                wait_cnt := 0;
                clk_enabled := true;
            ELSE
                wait_cnt := wait_cnt + 1;
                clk_enabled := false;
            END IF;
            IF clk_enabled THEN
                IF digit_index = NUM_DIGITS - 1 THEN
                    digit_index &lt;= 0;
                ELSE
                    digit_index &lt;= digit_index + 1;
                END IF;
                FOR i IN 0 TO NUM_DIGITS - 1 LOOP
                    IF i = digit_index THEN
                        digits_sel(i) &lt;= '1'; -- active
                    ELSE
                        digits_sel(i) &lt;= '0'; -- inactive
                    END IF;
                END LOOP;
                bcd_value := to_unsigned(bcd_count(digit_index), 4);
                data_buf &lt;= '0' &amp; BCD2SEG7(bcd_value);
            END IF;
        END IF;
    END PROCESS;

    DIGITS &lt;= NOT digits_sel; -- active-low
    SEG7   &lt;= NOT data_buf; -- for common-anode 7-segment LEDs

END behavioral;
</code></pre>
<p>&nbsp;</p>
<p>The 4-digit 7-segment display module used in this tutorial has the following pins:</p>
<ul>
<li><code>VCC</code>: Power supply pin  </li>
<li><code>D1</code> ~ <code>D4</code>: Digit control or select pins (active-low), 
   corresponding to digits from left to right  </li>
<li><code>A</code> ~ <code>G</code>: Segment control pins for the seven segments  </li>
<li><code>DP</code>: Dot or decimal point pin</li>
</ul>
<p><img alt="" src="ca_4dig_7seg_disp.jpg" /></p>
<p><strong>Figure:</strong> 4-digit 7-segment display (CA type) with PNP BJTs as digit control transistors</p>
<p>&nbsp;</p>
<p>A Tcl script for FPGA pin assignment is also provided below. 
Note use 3.3V pin for the VCC pin of the display module.</p>
<pre><code class="language-Tcl">#============================================================
# FPGA assignments
#============================================================

#set_global_assignment -name FAMILY &quot;MAX 10 FPGA&quot;
#set_global_assignment -name DEVICE 10M50DAF484C7G

#============================================================
# CLOCK
#============================================================
set_instance_assignment -name IO_STANDARD &quot;3.3-V LVTTL&quot; -to CLK
set_location_assignment PIN_P11 -to CLK

#============================================================
# PUSH BUTTONS
#============================================================

set_instance_assignment -name IO_STANDARD &quot;3.3 V SCHMITT TRIGGER&quot; -to RST_N
set_location_assignment PIN_B8 -to RST_N

#============================================================
# GPIO
#============================================================

foreach i {0 1 2 3 4 5 6 7} {
    set_instance_assignment -name IO_STANDARD &quot;3.3-V LVTTL&quot; -to SEG7[$i]
}
foreach i {0 1 2 3} {
    set_instance_assignment -name IO_STANDARD &quot;3.3-V LVTTL&quot; -to DIGITS[$i]
}

set_location_assignment PIN_W5   -to SEG7[7]
set_location_assignment PIN_AA14 -to SEG7[6]
set_location_assignment PIN_W12  -to SEG7[5]
set_location_assignment PIN_AB12 -to SEG7[4]
set_location_assignment PIN_AB11 -to SEG7[3]
set_location_assignment PIN_AB10 -to SEG7[2]
set_location_assignment PIN_AA9  -to SEG7[1]
set_location_assignment PIN_AA8  -to SEG7[0]

set_location_assignment PIN_AA7 -to DIGITS[3]
set_location_assignment PIN_AA6 -to DIGITS[2]
set_location_assignment PIN_AA5 -to DIGITS[1]
set_location_assignment PIN_AB3 -to DIGITS[0]
</code></pre>
<p>The following photos show the <code>disp_7seg_demo</code> design 
being tested on the MAX10 Lite FPGA board.</p>
<p><img alt="" src="demo.jpg" /></p>
<p><strong>Figure:</strong>  MAX10 Lite FPGA board + 4-digit 7-segment display module</p>
<hr />
<h2 id="coding-exercise"><strong>Coding Exercise</strong><a class="headerlink" href="#coding-exercise" title="Permanent link">#</a></h2>
<ul>
<li>Modify the VHDL code to implement a <strong>4-digit BCD counter</strong> 
that can count from <code>0000</code> to <code>9999</code>, wrapping around when it exceeds its limits.</li>
<li>Use slide switches to control the counting direction (up/down) and speed (e.g., slow or fast).</li>
<li>Ensure the display updates correctly using time-multiplexing.</li>
</ul>
<hr />
<p><em>This work is licensed under a</em> <strong><em>Creative Commons Attribution-ShareAlike 4.0 International License</em></strong>.</p>
<p>Created: 2025-06-11 | Last Updated: 2025-06-11</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021-2025 IoT Engineering Education, Bangkok/Thailand</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
