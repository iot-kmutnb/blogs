<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="RSP">
        <link rel="canonical" href="http://iot-kmutnb.github.com/blogs/mbedos/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>ARM Mbed OS - IoT Engineering Education</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../css/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/arduino.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/vhdl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/verilog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/text.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/matlab.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/julia.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-966FQ6RN6W"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-966FQ6RN6W');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">IoT Engineering Education</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#arm-mbed-os" class="nav-link">ARM Mbed OS</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#arm-mbed" class="nav-link">&#9655; โครงการ ARM Mbed และความเป็นมา</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#arm-mbed-compiler" class="nav-link">&#9655; ARM Mbed Compiler</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#mbed-os-rtos" class="nav-link">&#9655; Mbed OS ตัวเลือกสำหรับการใช้งาน RTOS</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#mbed-api" class="nav-link">&#9655; การจัดกลุ่มของ Mbed API</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#mbed-os" class="nav-link">&#9655; ซอฟต์แวร์ที่เป็นองค์ประกอบของ Mbed OS</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#mbed-api_1" class="nav-link">&#9655; ตัวอย่างคลาสสำหรับไดร์เวอร์ของ Mbed API</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#mbed" class="nav-link">&#9655; บอร์ดไมโครคอนโทรลเลอร์สำหรับ Mbed ยุคแรก</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#mbed_1" class="nav-link">&#9655; รายการบอร์ดไมโครคอนโทรลเลอร์สำหรับ Mbed</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#mbed_2" class="nav-link">&#9655; ซอฟต์แวร์สำหรับ Mbed</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#mbed_3" class="nav-link">&#9655; ซอฟต์แวร์จำลองการทำงาน Mbed</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#mbed-os_1" class="nav-link">&#9655; หลักการทำงานของเธรดใน Mbed OS</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_1" class="nav-link">&#9655; กล่าวสรุป</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link">&#9655; แหล่งข้อมูลสำหรับศึกษาเพิ่มเติม</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="arm-mbed-os">ARM Mbed OS<a class="headerlink" href="#arm-mbed-os" title="Permanent link">#</a></h1>
<p>เนื้อหาในส่วนนี้เกี่ยวข้องกับการใช้งาน <strong>ARM Mbed OS</strong> ซึ่งเป็นระบบปฏิบัติการเวลาจริง  (<strong>RTOS</strong>)
เหมาะสำหรับงานด้าน  <strong>IoT</strong> และเป็นซอฟต์แวร์ประเภท  <strong>Open Source</strong>
ที่ได้มีการพัฒนามาเพื่อใช้งานกับไมโครคอนโทรลเลอร์ของบริษัทต่าง ๆ 
ที่มีตัวประมวลผลตระกูล <strong>ARM Cortex-M Series</strong></p>
<p><strong>Keywords</strong>: <em>ARM Cortex-M Series</em>, <em>Mbed OS</em>, <em>RTOS</em>, <em>Multi-Threading</em></p>
<hr />
<h2 id="arm-mbed">&#9655; <strong>โครงการ ARM Mbed และความเป็นมา</strong><a class="headerlink" href="#arm-mbed" title="Permanent link">#</a></h2>
<p><strong>ARM Mbed</strong> เป็นโครงการที่มีจุดเริ่มต้นในราวปี ค.ศ. 2005 ซึ่งเกิดจากการสนทนาในช่วงพักดื่มน้ำชา
ระหว่างนักพัฒนาสองท่านคือ <strong>Simon Ford</strong> และ <strong>Chris Styles</strong>
และเป็นพนักงานของบริษัท <strong>Arm Ltd. (UK)</strong> 
ในช่วงเวลานั้น ทั้งคนได้ร่วมกันทำกิจกรรมเพื่อช่วยให้นักเรียนในชมรมอิเล็กทรอนิกส์ของโรงเรียน
หรือให้คำปรึกษาสำหรับโครงงานของนักศึกษาได้หันมาสนใจการเรียนรู้และใช้งานไมโครคอนโทรลเลอร์ </p>
<p>แต่จากปัญหาและอุปสรรคในการทำงานที่ทั้งสองได้รับรู้มา ก็นำไปสู่แนวคิดที่จะออกแบบฮาร์ดแวร์ 
เช่น บอร์ดไมโครคอนโทรลเลอร์ และซอฟต์แวร์ที่นำมาใช้งานได้ง่ายขึ้นสำหรับผู้ใช้ทั่วไป
และสามารถใช้งานผ่านหน้าเว็บเบราว์เซอร์ได้</p>
<p>จากแนวความคิดดังกล่าว ทางบริษัท <strong>Arm Ltd.</strong> ได้มีการสนับสนุน จนในปี ค.ศ. 2009 
จึงได้เปิดตัวโครงการที่มีชื่อว่า <strong>mbed</strong> (คงหมายถึงคำว่า <em>"embedded"</em>) 
ให้กลุ่มผู้ใช้แบบออนไลน์ (<strong>Online Community</strong>) และมีซอฟต์แวร์ประเภท 
<strong>Cloud-based Integrated Development Environment (IDE)</strong> 
แบบออนไลน์ ให้ใช้งานได้ฟรี </p>
<p>&mdash;&mdash; 
อ้างอิงจากบทความ <a href="https://os.mbed.com/handbook/Founders-interview"><strong><em>"Founders interview: An interview with the mbed originators"</em></strong></a></p>
<p>&nbsp;</p>
<hr />
<h2 id="arm-mbed-compiler">&#9655; <strong>ARM Mbed Compiler</strong><a class="headerlink" href="#arm-mbed-compiler" title="Permanent link">#</a></h2>
<p>ซอฟต์แวร์หลักคือ <strong>Mbed Compiler</strong> 
(<a href="https://ide.mbed.com/compiler">https://ide.mbed.com/compiler</a>) 
ผู้ใช้สามารถสมัครและสร้างบัญชีผู้ใช้ได้ฟรี และเข้าใช้งานโดยใช้เว็บเบราว์เซอร์ ซอฟต์แวร์นี้ประกอบไปด้วย</p>
<ul>
<li><strong>Arm C/C++ Compiler</strong> ใช้คอมไพเลอร์ <a href="https://www.keil.com/support/man/docs/armcc/"><strong>ARMCC</strong></a> 
เหมือนกับ <a href="https://www2.keil.com/mdk5"><strong>Keil MDK-ARM</strong></a> (<em>Microcontroller Development Kit for ARM</em>)
ซึ่งเป็นซอฟต์แวร์ประเภท <strong>Commercial</strong></li>
<li><strong>Code Editor</strong> สำหรับการเขียนโค้ด</li>
<li><strong>Mbed OS</strong> ซึ่งเป็นระบบปฏิบัติการเวลาจริง และ</li>
<li><strong>Libraries / Drivers</strong> เป็นต้น </li>
</ul>
<p><img alt="ARM Mbed Software" src="images/mbed_software.png" /></p>
<p>รูปภาพ: <strong>ARM Mbed Software - IDE &amp; Toolchains</strong> (Source: Arm Mbed)</p>
<p><img alt="ARM Software" src="images/arm_software-1.png" />
รูปภาพ: ตัวเลือกซอฟต์แวร์ประเภท <strong>IDEs</strong> ของบริษัท <strong>Arm Ltd. / Keil</strong></p>
<p><img alt="ARM Software" src="images/arm_software-2.png" />
รูปภาพ: ตัวเลือกซอฟต์แวร์นอกเหนือจาก <strong>IDEs</strong> เช่น <strong>Compilers / Toolchains</strong> และประเภทอื่น </p>
<p>&nbsp;</p>
<hr />
<h2 id="mbed-os-rtos">&#9655; <strong>Mbed OS ตัวเลือกสำหรับการใช้งาน RTOS</strong><a class="headerlink" href="#mbed-os-rtos" title="Permanent link">#</a></h2>
<p>ในการพัฒนาแอพพลิเคชันสำหรับระบบสมองกลฝังตัว ในหลายกรณีการใช้งานระบบปฏิบัติการประเภท <strong>RTOS</strong>
ก็อาจมีความจำเป็น ดังนั้นทาง <strong>ARM Mbed</strong>
จึงได้พัฒนา <a href="https://os.mbed.com/mbed-os/"><strong>Mbed OS</strong></a>
ซึ่งเป็น <strong>Open Source RTOS</strong>
เพื่อวัตถุประสงค์ดังกล่าว และมีการแชร์โค้ดที่เกี่ยวข้องไว้ใน <a href="https://github.com/ARMmbed/mbed-os"><strong>Github Repo</strong></a></p>
<p><img alt="Mbed OS Repository" src="images/github_mbed_os.png" /></p>
<p>รูปภาพ: <strong>Mbed OS repository on Github</strong></p>
<p>&nbsp;</p>
<p><strong>Mbed OS</strong> ได้มีการพัฒนามาหลายเวอร์ชัน 
(<a href="https://os.mbed.com/mbed-os/releases/"><strong>Releases</strong></a>) โดยสามารถจำแนกได้ดังนี้</p>
<ul>
<li><strong>Mbed OS 2</strong> ("Classic"): release date: February 28, 2013</li>
<li><strong>Mbed OS 3</strong> ("Eventing OS"): release date: October 15, 2015</li>
<li><strong>Mbed OS 5</strong> ("Mbed 2 + Mbed 3"): release date: August 5, 2016</li>
<li><strong>Mbed OS 6</strong>: release date: June 4, 2020</li>
</ul>
<p><strong>Mbed OS 5</strong> เป็นจุดเริ่มต้นของการนำ <strong>Mbed OS 2</strong> กับ <strong>Mbed OS 3</strong> มารวมกัน 
และได้มีการเปลี่ยนมาใช้ <strong>Real-Time Kernel</strong> ที่มีชื่อว่า <strong>RTX</strong> (<em>v4.79.0</em>) 
ซึ่งเป็นของบริษัท <strong>Keil</strong> และนำมาเผยแพร่ให้เป็น <strong>Open Source (Apache License)</strong></p>
<p>&nbsp;</p>
<p><img alt="Mbed OS 2 and 3 Merging" src="images/mbed_3_and_5_merged.png" /></p>
<p>รูปภาพ: การนำ <strong>Mbed OS</strong> เวอร์ชัน 2 และ 3 มารวมกันเป็นเวอร์ชัน 5</p>
<p>&nbsp;</p>
<p><strong>Mbed OS</strong> จากเวอร์ชัน 5 ไปสู่เวอร์ชัน 6 ใช้เวลาในการพัฒนาประมาณ 4 ปี และมีการปรับปรุงเพื่อรองรับการใช้งานด้าน 
<strong>IoT</strong> และใช้งานร่วมกับบริการ <strong>IoT Cloud Services (Cloud services support)</strong> ยกตัวอย่างเช่น</p>
<ul>
<li><strong>Amazon Web Services (AWS)</strong></li>
<li><strong>Microsoft Azure</strong></li>
<li><strong>Google IoT Cloud</strong></li>
</ul>
<p>และรองรับรูปแบบการสื่อสารเชื่อมต่อด้วยโพรโทคอลแบบต่าง ๆ เช่น </p>
<ul>
<li><strong>Ethernet</strong> </li>
<li><strong>Wi-Fi</strong></li>
<li><strong>Bluetooth LE</strong></li>
<li><strong>NFC / RFID </strong> </li>
<li><strong>Cellular</strong></li>
<li><strong>6LoWPAN Sub-GHz Mesh</strong></li>
<li><strong>LoRa LPWAN</strong></li>
</ul>
<p>ในปัจจุบัน (ขณะที่จัดทำเอกสารนี้) เวอร์ชันล่าสุดคือ <strong>Mbed OS 6.15.0</strong> (อ้างอิงจาก:
<a href="https://os.mbed.com/mbed-os/releases">https://os.mbed.com/mbed-os/releases</a>) </p>
<p>รูปแบบการใช้งาน <strong>Mbed OS</strong> แบ่งเป็น 2 ลักษณะ (เรียกว่า <strong>Profiles</strong>) ดังนี้</p>
<ul>
<li><strong>Mbed OS Full Profile</strong>: เป็น <strong>Default Profile</strong> 
เหมาะสำหรับงานที่ต้องการใช้ <strong>RTOS</strong> (ใช้ <strong>Keil RTX</strong> ตามรูปแบบของ <strong>CMSIS RTOS</strong>) </li>
<li><strong>Mbed OS Bare-Metal Profile</strong> 
(<a href="https://os.mbed.com/docs/mbed-os/latest/bare-metal/index.html">อ้างอิง</a>): 
เหมาะสำหรับงานที่ไม่ต้องการใช้ <strong>RTOS</strong> (ไม่มีการทำงานแบบหลายเธรด มีเพียงเธรดหลักเท่านั้น และไม่ได้ใช้ <strong> Keil RTX</strong>)
ทำให้โค้ดมีขนาดเล็กลงเมื่อคอมไพล์แล้ว (<strong>Smaller Memory Footprint</strong>)
โปรแกรมจะทำงานตามโปรไฟล์นี้ โดยใช้หลักการของ <strong>Interrupt / Event-driven Programming</strong>
และในส่วนของการใช้งานไลบรารีสำหรับภาษา <strong>C</strong> หรือที่เรียกว่า <strong>Standard C library</strong> ก็จะใช้แบบ <code>small</code>
(แทนที่จะเป็น <code>std</code>) ซึ่งหมายถึง ไลบรารี <code>microlib</code> (สำหรับ <strong>ARMCC toolchain</strong>) หรือ <code>newlib-nano</code> (<strong>GCC ARM toolchain</strong>)
ซึ่งมีขนาดเล็ก (และฟังก์ชันก็ไม่จำเป็นต้องเป็น <strong>thread-safe</strong>)</li>
</ul>
<p>&nbsp;</p>
<p>การเลือกโปรไฟล์แบบ  <a href="https://os.mbed.com/docs/mbed-os/latest/bare-metal/using-the-bare-metal-profile.html"><strong>Bare-Metal </strong></a> ของ <strong>Mbed OS</strong> เพื่อใช้งาน 
ก็ทำได้โดยการเขียนระบุไว้ในไฟล์ <code>mbed_app.json</code> ของโปรเจกต์ 
พร้อมกับการเลือกใช้ <strong>Small-footprint C Library</strong> ตามตัวอย่างดังนี้</p>
<pre><code>{
  &quot;requires&quot;: [&quot;bare-metal&quot;],
  &quot;target_overrides&quot;: {
    &quot;*&quot;: {
       &quot;target.c_lib&quot;: &quot;small&quot;
    }
  }
}
</code></pre>
<p>นอกจากนั้นแล้วในไฟล์ <code>CMakeLists.txt</code> ภายใต้ไดเรกทอรีของโปรเจกต์
จะต้องมีการแก้ไขชื่อของไลบรารีสำหรับ <strong>Mbed</strong> ที่จะใช้งาน ในบรรทัดดังนี้
(เปลี่ยนจาก <code>mbed-os</code> ไปเป็น <code>mbed-baremetal</code>)</p>
<pre><code>target_link_libraries(${APP_TARGET} mbed-baremetal)
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="mbed-api">&#9655; <strong>การจัดกลุ่มของ Mbed API</strong><a class="headerlink" href="#mbed-api" title="Permanent link">#</a></h2>
<p>การจัดกลุ่มของ <strong>ARM Mbed APIs</strong> แบ่งเป็น 3 ช่วง ดังนี้</p>
<ul>
<li><em>Experimental</em> &mdash; เป็นเวอร์ชันที่มีการทดลองฟังก์ชันการทำงานใหม่ อาจยังมีบักและไม่เสถียร</li>
<li><em>Stable</em> &mdash; เป็นเวอร์ชันที่ถือว่า มีความเสถียรในการใช้งาน</li>
<li><em>Deprecated</em> &mdash; ยังใช้ได้แต่จะถูกถอดหรือยกเลิกการใช้ในอนาคต
( <em>An API that will be removed in the next major release.</em> )</li>
</ul>
<p>และยังมีการแบ่งระดับของ
<a href="https://os.mbed.com/docs/mbed-os/latest/introduction/versions-and-releases.html"><strong>Software Releases</strong></a>
(<em>Mbed OS x.y.z</em>) ดังนี้</p>
<ul>
<li><em>Major release</em> เช่น เปลี่ยนจาก <strong>v5.0</strong> เป็น <strong>v6.0</strong> </li>
<li><em>Feature release</em> เช่น <strong>v6.15.0</strong> </li>
<li><em>Patch release</em> เช่น <strong>v6.15.1</strong> เน้นการแก้ไขข้อผิดพลาด (<strong>Bug Fixes</strong>)
มีการเพิ่มบอร์ดใหม่ (<strong>Support for New Target Boards</strong>) เป็นต้น</li>
</ul>
<p>การเปลี่ยนเวอร์ชันจาก <strong>Mbed OS 2</strong> เป็น <strong>Mbed OS 5</strong> และ <strong>Mbed OS 6</strong> ซึ่งถือว่าเป็น 
<strong>Major Releases</strong> ตามลำดับ และมีการเปลี่ยนแปลงของ <strong>Mbed OS API</strong> 
ค่อนข้างมาก เช่น บางฟังก์ชันก็มีสถานะเป็น <code>deprecated</code> (ไม่แนะนำให้ใช้ และจะมีการตัดออกไปหรือเลิกใช้ในอนาคต)</p>
<p>&nbsp;</p>
<p><img alt="" src="images/mbed-os_deprecated_method.png" /></p>
<p>รูปภาพ: ตัวอย่างโค้ดของเมธอดของคลาส <code>TickerBase</code> ที่มีการระบุว่าเป็น 
<code>MBED_DEPRECATED_SINCE</code> สำหรับ <strong>Mbed 6.6</strong> เป็นต้นไป</p>
<p>&nbsp;</p>
<hr />
<h2 id="mbed-os">&#9655; <strong>ซอฟต์แวร์ที่เป็นองค์ประกอบของ Mbed OS</strong><a class="headerlink" href="#mbed-os" title="Permanent link">#</a></h2>
<p>โครงสร้างเชิงสถาปัตยกรรมของซอฟต์แวร์สำหรับ <strong>Mbed OS</strong> มีการแบ่ง <strong>APIs</strong> 
ออกเป็นกลุ่มต่าง ๆ ตามลักษณะการใช้งาน เช่น </p>
<ul>
<li><strong>OS Core APIs</strong>  โดยมีพื้นฐานอยู่บนข้อกำหนด <strong>CMSIS-RTOS</strong> ของบริษัท <strong>Arm Ltd.</strong>
สำหรับการเขียนโปรแกรมโดยใช้ <strong>RTOS</strong></li>
<li><strong>Security APIs</strong>เช่น มีการพัฒนาไลบรารีที่มีชื่อว่า  <strong>MbedTLS</strong>
สำหรับการเชื่อมต่อแบบปลอดภัยในระบบเครือข่ายโดยใช้ <strong>TLS</strong> 
และการเข้ารหัสข้อมูล เป็นต้น</li>
<li><strong>Connectivity APIs</strong> เช่น การสื่อสารโดยใช้รูปแบบของ <strong>MQTT</strong> 
หรือ <strong>CoAP</strong> การสื่อสารโดยใช้ <strong>TCP/IP</strong> โดยใช้ <strong>Ethernet</strong> หรือ <strong>Wi-Fi</strong> 
และการสื่อสารโดยใช้ <strong>Bluetooth (BLE / Bluetooth Mesh)</strong> เป็นต้น</li>
<li><strong>Storage APIs</strong> สำหรับการจัดเก็บข้อมูล เช่น ในหน่วยความจำแบบ <strong>Flash NAND / NOR</strong> 
หรือการ์ดหน่วยความจำ <strong>MicroSD</strong> เป็นต้น</li>
</ul>
<p>&nbsp;</p>
<p><a href="images/mbed-os_6_diagram.png"><img alt="Mbed OS 6 Software Components" src="images/mbed-os_6_diagram.png" /></a></p>
<p>รูปภาพ: <strong>Mbed OS 6 Software Components</strong> (Source: ARM Mbed)</p>
<p>&nbsp;</p>
<p><strong>CMSIS-RTOS</strong> เป็นการกำหนด <strong>APIs</strong> ภายใต้กรอบใหญ่คือ 
<a href="https://developer.arm.com/tools-and-software/embedded/cmsis"><strong>ARM CMSIS v5</strong></a>
สำหรับใช้งาน <strong>RTOS</strong> และในปัจจุบัน มีสองเวอร์ชัน ได้แก่</p>
<ul>
<li><a href="http://arm-software.github.io/CMSIS_5/RTOS/html/index.html"><strong>CMSIS-RTOS v1</strong></a>
(<strong>Version 1.03</strong>) ใช้สำหรับไมโครคอนโทรลเลอร์ตระกูล <strong>ARM Cortex-M Series</strong> เท่านั้น 
และได้เลือก <strong>Keil RTX v4</strong> เป็นพื้นฐานในการพัฒนาตาม <strong>API</strong> ที่กำหนด</li>
<li><a href="https://arm-software.github.io/CMSIS_5/RTOS2/html/index.html"><strong>CMSIS-RTOS v2</strong></a>
(<strong>CMSIS-RTOS2 Version 2.1.3</strong>)
ใช้งานได้กับทั้งสถาปัตยกรรม <strong>ARM Cortex-M / Cortex-A Series</strong> และได้เลือก <strong>Keil RTX v5</strong> 
เป็นพื้นฐานในการพัฒนาตาม <strong>API</strong> ที่กำหนดไว้</li>
</ul>
<p>&nbsp;</p>
<p>การกำหนดรูปแบบของ <strong>Mbed OS APIs</strong> ทำให้เราสามารถเขียนโค้ดสำหรับนำไปใช้กับไมโครคอนโทรลเลอร์ที่แตกต่างกันได้ 
ถ้าลองดูใน <a href="https://github.com/ARMmbed/mbed-os"><strong>Official Mbed OS Repository</strong></a>
ภายใต้ไดเรกทอรี <a href="https://github.com/ARMmbed/mbed-os/tree/master/targets"><code>targets</code></a>
จะเห็นตัวอย่างไดเรกทอรีย่อย จำแนกตามชื่อไมโครคอนโทรลเลอร์ของบริษัทต่าง ๆ ที่ใช้งานได้กับ <strong>Mbed OS</strong></p>
<ul>
<li><code>TARGET_Ambiq_Micro</code></li>
<li><code>TARGET_Analog_Devices</code></li>
<li><code>TARGET_Cypress</code></li>
<li><code>TARGET_Freescale</code></li>
<li><code>TARGET_GigaDevice</code></li>
<li><code>TARGET_Maxim</code></li>
<li><code>TARGET_NORDIC</code></li>
<li><code>TARGET_NUVOTON</code></li>
<li><code>TARGET_NXP</code></li>
<li><code>TARGET_RENESAS</code></li>
<li><code>TARGET_STM</code></li>
<li><code>TARGET_Silicon_Labs</code></li>
<li><code>TARGET_RASPBERRYPI</code> (<a href="https://github.com/arduino/mbed-os"><strong>Mbed OS for Arduino Core</strong></a>)</li>
</ul>
<p>ยกตัวอย่างการทำงานในส่วนที่เรียกว่า <strong>Mbed Drivers</strong> ซึ่งเกี่ยวข้องกับการใช้งานวงจรภายในของชิป (<strong>On-chip Peripherals</strong>) หรือจะมองว่าเป็น <strong>Hardware Abstraction Layer</strong> อีกระดับหนึ่งที่สูงขึ้นไป
(เหมือนกรณีที่มีการพัฒนา <strong>Arduino Core APIs</strong> เพื่อใช้กับไมโครคอนโทรลเลอร์ได้หลายตระกูล)</p>
<ul>
<li>ถ้าเลือกใช้ไมโครคอนโทรลเลอร์ เช่น <a href="https://www.st.com/en/microcontrollers-microprocessors/stm32f4-series.html"><strong>STM32F4 Series</strong></a>
ของบริษัท <strong>STMicroelectronics</strong> 
โค้ดในระดับล่างของ <strong>Mbed OS</strong> อาศัยการทำงานของซอฟต์แวร์ที่เรียกว่า
<a href="https://github.com/STMicroelectronics/stm32f4xx_hal_driver"><strong>STM32F4 HAL APIs</strong></a> 
ซึ่งเป็นส่วนหนึ่งของ <a href="https://github.com/STMicroelectronics/STM32CubeF4"><strong>STM32Cube_F4 MCU Firmware Package</strong></a></li>
<li>ถ้าเลือกเลือกใช้ชิป <a href="https://infocenter.nordicsemi.com/index.jsp?topic=%2Fstruct_nrf52%2Fstruct%2Fnrf52.html"><strong>nRF52 Series</strong></a> ของบริษัท <strong>Nordic Semiconductor</strong>
โค้ดของ <strong>Mbed OS</strong> จะทำงานโดยอาศัยซอฟต์แวร์ 
<a href="https://www.nordicsemi.com/Products/Development-software/nRF5-SDK"><strong>Nordic nRF5-SDK</strong></a></li>
<li>ถ้าเลือกใช้ชิป <a href="https://www.raspberrypi.com/products/raspberry-pi-pico/"><strong>Raspberry Pi RP2040</strong></a> 
ก็จะต้องใช้ซอฟต์แวร์ <a href="https://www.raspberrypi.com/documentation/microcontrollers/c_sdk.html"><strong>Raspberry Pi C/C++ SDK</strong></a>
เป็นพื้นฐานในการทำงานระดับล่าง</li>
</ul>
<p><img alt="" src="images/stm32_mcu_package_architecture.png" /></p>
<p>รูปภาพ: <strong>STM32 MCU Package Architecture</strong> (Source: STMicroelectronics)</p>
<p><img alt="" src="images/nordic_sdk_architecture.png" /></p>
<p>รูปภาพ: <strong>Nordic SDK Architecture</strong> (Source: Nordic Semiconductor)</p>
<p>&nbsp;</p>
<p>ลองมาพิจารณาดูตัวอย่าง <a href="https://github.com/arduino/ArduinoCore-mbed"><strong>Arduino Cores</strong></a> เพื่อนำไปใช้งานกับบอร์ดไมโครคอนโทรลเลอร์ดังนี้ </p>
<ul>
<li><strong><a href="https://docs.arduino.cc/hardware/nano-33-ble/">Arduino Nano 33 BLE</a> (nRF52840 SoC)</strong> </li>
<li><strong><a href="https://docs.arduino.cc/hardware/portenta-h7/">Arduino Portenta H7</a> (STM32H747 SoC)</strong></li>
<li><strong><a href="https://docs.arduino.cc/hardware/nano-rp2040-connect/">Arduino Nano RP2040 Connect</a> (RP2040 SoC)</strong></li>
</ul>
<p>ในทั้งสามกรณีนี้ มีการใช้งาน <strong>Arduino Core APIs</strong> อยู่ชั้นบนสุด ถัดลงมาเป็น <strong>Mbed OS APIs</strong> 
และชั้นต่ำลงมาอีกชั้นจึงเป็นการใช้งาน <strong>nRF52 SDK</strong>, <strong>STM32CubeH7 / STM32H7 HAL</strong> และ <strong>RP2040 SDK</strong> แยกในแต่ละกรณี (เป็น <strong>Target-specific Implementation</strong>)</p>
<p>&nbsp;</p>
<hr />
<h2 id="mbed-api_1">&#9655; <strong>ตัวอย่างคลาสสำหรับไดร์เวอร์ของ Mbed API</strong><a class="headerlink" href="#mbed-api_1" title="Permanent link">#</a></h2>
<p>การเขียนโค้ดภาษา <strong>C/C++</strong> โดยใช้ <strong>ARM Mbed APIs</strong> จะเกี่ยวข้องกับการใช้งานคลาส <strong>C++</strong> 
ในส่วนที่เรียกว่า <strong>Mbed Drivers</strong> สำหรับวงจรพื้นฐานของไมโครคอนโทรลเลอร์ที่มักมีให้ใช้งานได้ทั่วไป เช่น</p>
<ul>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/digitalin.html"><code>DigitalIn</code></a>
 | <a href="https://os.mbed.com/docs/mbed-os/latest/apis/digitalout.html"><code>DigitalOut</code></a> 
 | <a href="https://os.mbed.com/docs/mbed-os/latest/apis/digitalinout.html"><code>DigitalInOut</code></a>
 สำหรับการใช้งานขา <strong>GPIO</strong> (<em>General-Purpose I/O</em>) ในโหมดดิจิทัล-อินพุตหรือเอาต์พุต</li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/interruptin.html"><code>InterruptIn</code></a> 
  สำหรับการใช้งานขาอินพุตในโหมดอินเทอร์รัพท์</li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/portin.html"><code>PortIn</code></a>
 | <a href="https://os.mbed.com/docs/mbed-os/latest/apis/portout.html"><code>PortOut</code></a>
 | <a href="https://os.mbed.com/docs/mbed-os/latest/apis/portinout.html"><code>PortInOut</code></a> 
  สำหรับการใช้งานขาของ <strong>I/O Port</strong> เดียวกัน 
แต่เลือกได้ว่าจะใช้ขาใดบ้าง </li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/busin.html"><code>BusIn</code></a>
 | <a href="https://os.mbed.com/docs/mbed-os/latest/apis/busout.html"><code>BusOut</code></a>
 | <a href="https://os.mbed.com/docs/mbed-os/latest/apis/businout.html"><code>BusInOut</code></a> 
  สำหรับการใช้งานขา <strong>GPIO</strong> แบบดิจิทัลหลายขาพร้อมกัน </li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/i-o-apis.html"><code>AnalogIn</code></a>
 | <a href="https://os.mbed.com/docs/mbed-os/latest/apis/analogout.html"><code>AnalogOut</code></a> 
  สำหรับการใช้งานขาแบบแอนะล็อกสำหรับ <strong>ADC</strong> (<em>Analog-to-Digital Converter</em>) และ
 <strong>DAC</strong> (<em>Digital-to-Analog Converter</em>)</li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/pwmout.html"><code>PwmOut</code></a>
  สำหรับการใช้งานขา <strong>GPIO</strong> เป็นเอาต์พุตเพื่อสร้างสัญญาณประเภท <strong>PWM</strong> (<em>Pulse Width Modulation</em>) </li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/i2c.html"><code>I2C</code></a>
| <a href="https://os.mbed.com/docs/mbed-os/latest/apis/i2cslave.html"><code>I2CSlave</code></a> 
  สำหรับการใช้งานบัส <strong>I2C</strong> โหมด <strong>I2C Master</strong> หรือ <strong>I2C Slave</strong></li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/spi.html"><code>SPI</code></a>
| <a href="https://os.mbed.com/docs/mbed-os/latest/apis/spislave.html"><code>SPISlave</code></a>
  สำหรับการใช้งานบัส <strong>SPI</strong> โหมด <strong>SPI Master</strong> หรือ <strong>SPI Slave</strong></li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/serial-uart-apis.html"><code>Serial</code></a>
 สำหรับการใช้งาน <strong>Serial (UART)</strong> แบ่งเป็น 2 กรณี คือ 
<a href="https://os.mbed.com/docs/mbed-os/latest/apis/serial-uart-apis.html"><code>BufferedSerial</code></a> 
 และ <a href="https://os.mbed.com/docs/mbed-os/latest/apis/unbufferedserial.html"><code>UnbufferedSerial</code></a>
 สำหรับการใช้งานบัส <strong>USB</strong> รูปแบบต่าง ๆ ในกรณีที่ไมโครคอนโทรลเลอร์รองรับการใช้งาน <strong>Native USB</strong> เช่น </li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/usb-apis.html"><code>USB</code></a> สำหรับไมโครคอนโทรลเลอร์ที่รองรับการใช้งาน <strong>Native USB</strong> และมีรูปแบบการใช้งาน เช่น <strong>USB CDC</strong>, <strong>USB Mass Storage</strong>, <strong>USB HID</strong> เป็นต้น</li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/apis/other-driver-apis.html"><code>CAN</code></a> 
 สำหรับการใช้งานบัส <strong>CAN</strong> (<em>Controller Area Network</em>)</li>
</ul>
<p>&nbsp;</p>
<hr />
<h2 id="mbed">&#9655; <strong>บอร์ดไมโครคอนโทรลเลอร์สำหรับ Mbed ยุคแรก</strong><a class="headerlink" href="#mbed" title="Permanent link">#</a></h2>
<p><strong>Mbed-enabled Platforms</strong> หมายถึง บอร์ดไมโครคอนโทรลเลอร์ที่ใช้ซีพียูตระกูล <strong>ARM Cortex-M</strong> 
จากหลายบริษัท และสามารถนำมาใช้ได้กับ <strong>Mbed OS</strong> (แต่ต้องพิจารณาดูเวอร์ชันที่ใช้ได้ด้วย) 
รายการของบอร์ดไมโครคอนโทรลเลอร์สามารถดูได้จากเว็บ
<a href="https://os.mbed.com/platforms/">https://os.mbed.com/platforms/</a> </p>
<p>ในช่วงแรกได้มีการพัฒนาบอร์ดไมโครคอนโทรลเลอร์ออกมา เพื่อสาธิตการทำงานของ <strong>Mbed OS</strong> แต่มีให้เลือกใช้เพียงไม่กี่บอร์ด 
เช่น </p>
<ul>
<li><a href="https://os.mbed.com/platforms/mbed-LPC1768/"><strong>ARM mbed NXP LPC1768 (Arm Cortex-M3) Board</strong></a></li>
<li><a href="https://os.mbed.com/platforms/mbed-LPC11U24/"><strong>ARM mbed NXP LPC11U24 (Arm Cortex-M0) Board</strong></a></li>
</ul>
<p>&nbsp;</p>
<p><img alt="mbed NXP LPC1768 Pin Out Diagram" src="images/mbed_lpc1768_pinout.png" /></p>
<p>รูปภาพ: บอร์ด <strong>mbed NXP LPC1768</strong> และ <strong>Pin Out Diagram</strong></p>
<p><img alt="mbed LPC11U24 Pin Out Diagram" src="images/mbed_lpc11U24_pinout.png" /></p>
<p>รูปภาพ: บอร์ด <strong>mbed NXP LPC11U24</strong> และ  <strong>Pin Out Diagram</strong></p>
<p>&nbsp;</p>
<p>หนังสือเล่มแรกที่แนะนำการใช้งานบอร์ด <strong>Mbed LPC1768</strong> คือ 
<a href="https://www.sciencedirect.com/book/9780080977683/fast-and-effective-embedded-systems-design"><strong><em>"Fast and Effective Embedded Systems Design"</em></strong></a>
ผู้แต่งคือ <strong>Rob Toulson &amp; Tim Wilmshurst</strong> และได้มีการตีพิมพ์ครั้งแรกในปี ค.ศ. 2012
และครั้งที่สองในปี ค.ศ. 2017 ตามลำดับ</p>
<p>&nbsp;</p>
<p><img alt="&quot;Fast and Effective Embedded Systems Design&quot; (2ed)" src="images/mbed_lpc1769_book_2017.png" /></p>
<p>รูปภาพ: หน้าปกหนังสือ <strong>Fast and Effective Embedded Systems Design (2ed)</strong></p>
<p>ตัวอย่างของหนังสืออีกเล่มหนึ่งที่กล่าวถึงการใช้งาน <strong>Mbed OS</strong> สำหรับบอร์ด <strong>NXP LPC1768</strong> และ 
<strong>Freescale FRDM-K64F</strong> คือ 
<a href="https://dl.acm.org/doi/book/10.5555/3285303"><strong><em>"Designing Embedded Systems 
and the Internet of Things (IoT) with the ARM mbed"</em></strong></a> 
ผู้แต่งคือ <strong>Perry Xiao</strong> ตีพิมพ์ในปี ค.ศ. 2018</p>
<p><strong>คำแนะนำ:</strong> ในการเลือกหนังสือเพื่อนำมาศึกษา เนื่องจากว่า <strong>Mbed OS</strong> มีการเปลี่ยนแปลงอย่างต่อเนื่อง หนังสือบางเล่มที่ได้มีการตีพิมพ์มาหลายปีแล้ว
อาจมีเนื้อหา เช่น ตัวอย่างโค้ด หรือการใช้ <strong>Mbed OS API</strong> เป็นเวอร์ชันเก่า </p>
<p>&nbsp;</p>
<hr />
<h2 id="mbed_1">&#9655; <strong>รายการบอร์ดไมโครคอนโทรลเลอร์สำหรับ Mbed</strong><a class="headerlink" href="#mbed_1" title="Permanent link">#</a></h2>
<p>ถ้าดูจากรายการ <strong>Mbed Platforms</strong> จะเห็นว่า ในปัจจุบันมีจำนวนบอร์ดไมโครคอนโทรลเลอร์ที่ใช้งานได้กับ <strong>Mbed OS</strong> 
มากขึ้น โดยส่วนใหญ่แล้วก็เป็นของบริษัท <strong>STMicroelectronics</strong> เช่น บอร์ดในกลุ่ม <strong>STM32 Nucleo</strong> เป็นต้น 
และบอร์ดของบริษัท <strong>NXP/Freescale</strong> ซึ่งทั้งสองบริษัทเป็น <strong>Mbed Official Partners</strong> มาตั้งแต่ช่วงเริ่มเปิดตัวโครงการ </p>
<p>&nbsp;</p>
<p><img alt="ตัวอย่างบอร์ดของ STM" src="images/mbed_boards_stm.png" /></p>
<p>รูปภาพ: ตัวอย่างบอร์ดของ <strong>STM</strong></p>
<p><img alt="ตัวอย่างบอร์ดของ NXP/Freescale" src="images/mbed_boards_nxp.png" /></p>
<p>รูปภาพ: ตัวอย่างบอร์ดของ <strong>NXP/Freescale</strong></p>
<p>&nbsp;</p>
<p><strong>Community supported boards</strong>: นอกจากบอร์ดในกลุ่มที่เรียกว่า <strong>"Official Mbed-enabled"</strong> 
แล้ว <strong>ARM Mbed</strong> ก็เปิดโอกาสให้นักพัฒนาสามารถเพิ่ม <strong>Custom Boards</strong> อื่นมาใช้ได้ด้วย เช่น</p>
<ul>
<li><a href="https://os.mbed.com/users/hudakz/code/mbed-os-bluepill/"><strong>BluePill STM32F103 (ARM Cortex-M3)</strong></a>
สามารถทำงานได้กับ <strong>Mbed OS 6.2</strong> </li>
<li><a href="https://github.com/Terstegge/mbed-os-MSP432"><strong>TI MSP432 (ARM Cortex-M4F)</strong></a>
สามารถทำงานได้กับ <strong>Mbed OS 6.1 ~ 6.11</strong></li>
</ul>
<p>&nbsp;</p>
<hr />
<h2 id="mbed_2">&#9655; <strong>ซอฟต์แวร์สำหรับ Mbed</strong><a class="headerlink" href="#mbed_2" title="Permanent link">#</a></h2>
<p>ข้อดีของการใช้ <strong>Online IDE &amp; Toolchain</strong> คือ ผู้ใช้ไม่ต้องติดตั้งโปรแกรมใด ๆ 
ในเครื่องคอมพิวเตอร์ของผู้ใช้ เข้าใช้งานได้โดยเปิดเว็บเบราว์เซอร์ แต่ก็จะต้องเชื่อมต่อกับอินเทอร์เน็ตเพื่อใช้งาน
และถ้าจะนำไฟล์ที่ได้จากการคอมไพล์ไปใช้กับบอร์ด จะต้องดาวน์โหลดไฟล์ไบนารี .bin มายังคอมพิวเตอร์ของผู้ใช้
แล้วนำไปอัปโหลดไปยังบอร์ดทดลอง ซึ่งถือว่า ไม่สะดวกในการใช้งาน </p>
<p>&nbsp;</p>
<p><img alt="Mbed IDE" src="images/mbed_ide_demo.png" /></p>
<p>รูปภาพ: ตัวอย่างการใช้งาน <strong>Mbed online IDE</strong></p>
<p><img alt="Mbed Platform Selection" src="images/mbed_ide_platform_selection.png" /></p>
<p>รูปภาพ: การเลือกหรือเปลี่ยนบอร์ดไมโครคอนโทรลเลอร์เมื่อใช้งาน <strong>Mbed Online IDE</strong></p>
<p>&nbsp;</p>
<p>นอกจากการใช้งานซอฟต์แวร์แบบออนไลน์แล้ว ก็มีตัวเลือกสำหรับใช้งานแบบ <strong>Desktop (Offline)</strong> ดังนี้</p>
<ul>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/build-tools/mbed-cli-1.html"><strong>Mbed CLI v1</strong></a>
เป็น <strong>Python-based Command Line Tools</strong> เวอร์ชันแรก 
ใช้ชื่อคำสั่ง <code>mbed-cli</code> สำหรับจัดการโปรเจกต์และคอมไพล์โค้ดที่ใช้ <strong>Mbed OS 2</strong> และ <strong>Mbed OS 5.x</strong> 
ไปจนถึง <strong>Mbed OS 6.4</strong> </li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/build-tools/mbed-cli-2.html"><strong>Mbed CLI v2</strong></a>
เป็น <strong>Python3-based Command Line Tools</strong> เวอร์ชันสอง 
และใช้ชื่อคำสั่ง <code>mbed-tools</code> และได้มีการเปลี่ยนมาใช้ <strong>CMake</strong> และ <strong>Ninja Build System</strong> 
สำหรับจัดการโปรเจกต์และคอมไพล์โค้ดที่ใช้ <strong>Mbed OS 6.5</strong> หรือสูงกว่า <ul>
<li>อ่านบทความ: <a href="./mbed-cli-2"><strong>แนะนำการใช้งาน ARM Mbed CLI 2</strong></a> สำหรับระบบปฏิบัติการ 
   <strong>Linux</strong> หรือ <strong>Windows</strong> และทดลองกับบอร์ด <strong>STM32 NUCLEO</strong> ในเบื้องต้น</li>
</ul>
</li>
<li><a href="https://os.mbed.com/studio/"><strong>ARM Mbed Studio</strong></a> 
เป็นซอฟต์แวร์ <strong>Desktop App</strong> ประเภท <strong>IDE</strong> 
สำหรับระบบปฏิบัติการ <strong>Windows / Linux / Mac OS</strong> (64 บิต) 
และใช้ <strong>Eclipse THEIA IDE</strong> และ <strong>Monaco Editor</strong> เป็นพื้นฐานในการพัฒนา 
ในส่วนของคอมไพล์เลอร์จะใช้ <a href="https://developer.arm.com/tools-and-software/embedded/arm-compiler/downloads/version-6"><strong>Arm C/C++ Compiler 6 (AC6)</strong></a> 
ของบริษัท <strong>Arm Ltd.</strong></li>
</ul>
<p>&nbsp;</p>
<p><img alt="Mbed Studio" src="images/mbed_studio_download.png" /></p>
<p>รูปภาพ: <strong>Mbed Studio IDE</strong> และการดาวน์โหลดไฟล์เพื่อติดตั้งใช้งาน </p>
<p><img alt="Mbed Studio" src="images/mbed_studio_ide.png" /></p>
<p>รูปภาพ: ตัวอย่างการใช้งาน <strong>Mbed Studio IDE</strong></p>
<p>&nbsp;</p>
<p>โปรเจกต์ที่ผู้ใช้ได้สร้างขึ้นเมื่อใช้งาน
<a href="https://ide.mbed.com/compiler/"><strong>Mbed Online Compiler</strong></a> 
แบบออนไลน์ ก็สามารถนำออกมา (<strong>Export</strong>) มาใช้กับ <strong>IDE</strong> แบบ <strong>Offline</strong> ได้ มีหลายตัวเลือก เช่น</p>
<ul>
<li><a href="https://www2.keil.com/mdk5/uvision/"><strong>Keil µVision IDE</strong></a></li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/debug-test/eclipse.html"><strong>Eclipse IDE / CDT Plugin + GNU Arm Embedded Toolchain</strong></a></li>
<li><a href="https://os.mbed.com/docs/mbed-os/latest/debug-test/visual-studio-code.html"><strong>Visual Studio Code + GNU Arm Embedded Toolchain</strong></a></li>
<li><a href="https://www.st.com/en/development-tools/sw4stm32.html"><strong>SW4STM32 System Workbench for STM32</strong></a></li>
<li>...</li>
</ul>
<p>&nbsp;</p>
<p><img alt="Mbed IDE" src="images/mbed_project_export.png" /></p>
<p>รูปภาพ: ตัวเลือกสำหรับการนำออกโปรเจกต์ใน <strong>Mbed Online IDE</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="mbed_3">&#9655; <strong>ซอฟต์แวร์จำลองการทำงาน Mbed</strong><a class="headerlink" href="#mbed_3" title="Permanent link">#</a></h2>
<p><strong>Jan Jongboom</strong> ซึ่งเป็นหนึ่งในทีมงาน <strong>Mbed Labs</strong> ในขณะนั้น ได้พัฒนา 
<a href="https://os.mbed.com/blog/entry/introducing-mbed-simulator/"><strong>Mbed OS Simulator</strong></a> ซึ่งเป็นซอฟต์แวร์ประเภท <strong>Open Source</strong> และได้แชร์โค้ดไว้ใน <strong>Github</strong>
(<a href="https://github.com/janjongboom/mbed-simulator">https://github.com/janjongboom/mbed-simulator</a>)</p>
<p>โปรแกรมนี้ใช้ภาษา <strong>JavaScript / Nodejs</strong> ในการทำงาน และใช้ 
<a href="https://emscripten.org/"><strong>Emscripten</strong></a> 
ซึ่งเป็นคอมไพล์เลอร์ที่ทำหน้าที่แปลงโค้ดภาษา  <strong>C/C++</strong> ให้เป็น 
<strong>JavaScript</strong> หรือ <strong>WebAssembly</strong> ได้ ดังนั้นโค้ดที่ใช้ <strong>Mbed OS 5</strong>
จึงสามารถนำไปรันบนหน้าเว็บเบราว์เซอร์ได้  แต่ก็มีข้อจำกัด เช่น</p>
<ul>
<li>เลือกโค้ดจากตัวอย่าง (<strong>Demos</strong>) มาลองรันได้เท่านั้น แก้ไขโค้ดตัวอย่างได้  ผู้ใช้ไม่สามารถสร้างโปรแกรมใหม่ได้</li>
<li>ไม่รองรับการทำงานแบบ <strong>Multi-threading</strong> (เป็น <strong>single-threaded</strong>) </li>
<li>ใช้คำสั่งของ <strong>Mbed OS 5</strong> แต่ไม่รองรับ <strong>Mbed OS 6</strong></li>
</ul>
<p>แต่หลังจาก <strong>Jan Jongboom</strong> ได้ลาออกไปร่วมก่อตั้งบริษัทใหม่ โปรเจกต์นี้ก็ไม่ได้มีการพัฒนาต่อ
ดังนั้นจึงแนะนำให้เข้าไปลองใช้งาน <strong>Mbed Simulator</strong>: <a href="https://simulator.mbed.com/">https://simulator.mbed.com/</a> <u>เฉพาะสำหรับ</u> ผู้ที่เริ่มต้นใช้งาน <strong>Mbed OS</strong> และยังไม่มีอุปกรณ์ฮาร์ดแวร์
ในการทดลองเท่านั้น ลองเขียนโค้ดใหม่โดยใช้คำสั่งต่าง ๆ ของ <strong>Mbed Driver API</strong> เช่น 
<code>DigitalOut</code>, <code>DigitalIn</code>, <code>InterruptIn</code>, <code>BusOut</code>, <code>PwmOut</code> เป็นต้น</p>
<p>&nbsp;</p>
<p><img alt="" src="images/mbed_5_simulator.png" />
รูปภาพ: <strong>Web-based Mbed Simulator</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="mbed-os_1">&#9655; <strong>หลักการทำงานของเธรดใน Mbed OS</strong><a class="headerlink" href="#mbed-os_1" title="Permanent link">#</a></h2>
<p>ถ้าอ้างอิงจากเอกสารออนไลน์ <a href="https://os.mbed.com/docs/mbed-os/latest/apis/scheduling-concepts.html"><strong>Mbed OS - Scheduling Concepts</strong></a>
จะทราบได้ว่า <strong>Mbed OS / Full Profile</strong> มีการกำหนดสถานะของเธรด (<strong>Thread States</strong>) ไว้ดังนี้ </p>
<ul>
<li><strong>Running</strong>: เป็นสถานะที่เธรดนั้นกำลังทำงาน และจะมีเพียงเธรดเดียวเท่านั้นในระบบที่ทำงานในช่วงเวลาหนึ่ง</li>
<li><strong>Ready</strong>: เป็นสถานะของเธรดที่พร้อมจะทำงาน และยังไม่ได้ทำงาน </li>
<li><strong>Waiting</strong>: เป็นสถานะที่เธรดกำลังรอเหตุการณ์บางอย่าง และไม่ทำงาน</li>
<li><strong>Inactive</strong>: เป็นสถานะของเธรดที่ยังไม่ถูกสร้างขึ้นมา หรือได้จบการทำงานไปแล้ว</li>
</ul>
<p>เมื่อเธรดที่กำลังทำงานอยู่ได้จบการทำงานลง (<strong>Terminated</strong>) หรือได้เปลี่ยนไปเป็นสถานะรอ (<strong>Waiting</strong>) 
ก็จะทำให้เธรดที่พร้อมจะทำงานและมีระดับความสำคัญสูงสุดในกลุ่มที่พร้อมจะทำได้ ได้ถูกเลือกให้ทำงานเป็นลำดับถัดไป</p>
<p>หรือในอีกกรณีหนึ่ง ถ้าเธรดที่กำลังรออยู่ ได้เปลี่ยนสถานะเป็นพร้อมที่จะทำงานเมื่อเกิดเหตุการณ์หรือเงื่อนไขบางอย่างเป็นจริง
จะทำให้การรอจบลง และถ้าเธรดดังกล่าวมีความสำคัญสูงกว่าเธรดที่อยู่ในสถานะทำงานขณะนั้น
ก็จะเกิดการเปลี่ยนบริบทของเธรดในการทำงาน เพื่อให้เธรดที่พร้อมและมีความสำคัญสูงกว่าได้ทำงานทันที<br />
กรณีนี้เรียกว่า <strong>Premption</strong> </p>
<p>รูปภาพต่อไปนี้แสดงให้เห็นสถานะของเธรดและเงื่อนไขในการเปลี่ยนแปลงสถานะของเธรด (<strong>State Transitions</strong>)</p>
<p>&nbsp;</p>
<p><img alt="" src="images/mbed_thread_states.png" /></p>
<p>รูปภาพ: สถานะของเธรดในระบบ <strong>RTOS</strong> ของ <strong>Mbed OS</strong> (Source: ARM Mbed)</p>
<p>&nbsp;</p>
<p>ถ้าเธรดอยู่ในสถานะรอ ก็มีการจำแนกกรณีที่เกิดขึ้นสำหรับ <strong>Mbed OS</strong> ไว้ดังนี้</p>
<ul>
<li><strong>WaitingDelay</strong>: การหยุดเพื่อรอเวลาให้ผ่านไปตามระยะเวลาที่กำหนดไว้</li>
<li><strong>WaitingJoin</strong>: การหยุดรอเพื่อให้อีกเธรดหนึ่งจบการทำงานก่อน</li>
<li><strong>WaitingThreadFlag</strong>: การรอเพื่อให้เกิดการเซตค่าของ Flag สำหรับเธรด (เรียกว่า <strong>Thread Flag</strong>) </li>
<li><strong>WaitingEventFlag</strong>: การรอเพื่อให้เกิดการเซตค่าของ Flag สำหรับเหตุการณ์ (เรียกว่า <strong>Event Flag</strong>)</li>
<li><strong>WaitingMutex</strong>: การรอเพื่อให้เกิดเหตุการณ์ที่เกี่ยวข้องกับการทำงานของ <strong>Mutex</strong></li>
<li><strong>WaitingSemaphore</strong>: การรอเพื่อให้เกิดเหตุการณ์ที่เกี่ยวข้องกับการทำงานของ <strong>Semaphore</strong></li>
<li><strong>WaitingMemoryPool</strong>: การรอเพื่อเข้าถึง <strong>Memory Pool</strong> หรือ <strong>MailBox</strong></li>
<li><strong>WaitingMessageGet</strong>: การรอรับข้อความถัดไป </li>
<li><strong>WaitingMessagePut</strong>: การรอที่จะส่งข้อความออกไป </li>
</ul>
<p>ดังนั้นหากต้องการจะศึกษาวิธีการเขียนโค้ดโดยใช้ <strong>Mbed OS</strong> ก็ควรจะทำความเข้าใจหลักการทำงานของ
<strong>RTOS</strong> โดยทั่วไป เช่น การทำงานของเธรด การสร้างเธรดใหม่ สถานะของเธรด
การรอเหตุการณ์และการสื่อสารกันระหว่างเธรด
(<strong>Inter-Thread Synchronization &amp; Communication</strong>) 
และสิ่งที่ <strong>RTOS</strong> มีให้ใช้สำหรับการสื่อสารหรือรอจังหวะกันระหว่างเธรดในรูปแบบต่าง ๆ 
(เช่น <strong>Thread Flags / Event Flags / Semaphores / Mutexes / Memory Pools</strong> เป็นต้น)</p>
<p>&nbsp;</p>
<hr />
<h2 id="_1">&#9655; <strong>กล่าวสรุป</strong><a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p><strong>Mbed</strong> เป็นอีกตัวเลือกหนึ่งสำหรับผู้ที่สนใจจะใช้ระบบปฏิบัติการเวลาจริง และซอฟต์แวร์อื่นที่เกี่ยวข้อง
เพื่อนำมาใช้ในการพัฒนาซอฟต์แวร์สำหรับไมโครคอนโทรลเลอร์แบบมืออาชีพ 
จุดเด่นคือ เป็นซอฟต์แวร์ประเภท <strong>Open Source</strong> 
สามารถนำมาใช้งานกับบอร์ดไมโครคอนโทรลเลอร์ได้หลายแบบ 
แต่มีข้อจำกัดว่าต้องเป็นตัวประมวลผลที่ใช้สถาปัตยกรรมของ
<strong>Arm</strong> เท่านั้น (เช่น <strong>Arm Cortex-M / Cortex-A Series</strong>)</p>
<p>ในเรื่องของการพัฒนาซอฟต์แวร์ ก็มีบริษัท <strong>Arm Ltd.</strong> เป็นผู้สนับสนุน ร่วมกับบริษัท <strong>Partners</strong>
เช่น <strong>NXP</strong> / <strong>ST</strong> เป็นต้น ทำให้มีการพัฒนาอย่างต่อเนื่อง 
มีซอฟต์แวร์ให้เลือกใช้งานทั้งแบบออนไลน์ในระบบคลาวด์ 
(เช่น <strong>Mbed Online Compiler</strong> และ <strong>Keil Studio Cloud IDE</strong>) 
และแบบติดตั้งในเครื่องคอมพิวเตอร์ของผู้ใช้ (<strong>Mbed CLI / Mbed Studio</strong>) 
หรือจะใช้ซอฟต์แวร์อื่นอย่างเช่น <strong>VS Code + PlatformIO</strong> หรือ <strong>Eclipse IDE + CDT</strong> 
หรือเขียนโค้ดด้วย <strong>Arduino IDE</strong> (บางกรณี) ก็ได้เช่นกัน</p>
<p>&nbsp;</p>
<hr />
<h2 id="_2">&#9655; แหล่งข้อมูลสำหรับศึกษาเพิ่มเติม<a class="headerlink" href="#_2" title="Permanent link">#</a></h2>
<p>รายการบทความแนะนำและเกี่ยวข้องกับ <strong>Mbed OS</strong></p>
<ul>
<li><a href="./mbed-cli-2/">แนะนำการใช้งาน ARM Mbed CLI 2</a></li>
<li><a href="./mbed-online-compiler/">แนะนำการใช้งาน Mbed Online Compiler</a></li>
<li><a href="./mbed-studio-ide/">แนะนำการใช้งาน Mbed Studio Desktop IDE</a></li>
<li><a href="./arm-keil-studio-cloud-mbed/">แนะนำการใช้งาน Keil Studio Cloud</a></li>
<li><a href="./mbed-studio-blackpill/">แนะนำการใช้งาน Mbed OS สำหรับบอร์ด Black Pill (STM32F411CEU6)</a></li>
<li><a href="./mbed-stm32-part-1/">ตัวอย่างการเขียนโค้ด "ARM Mbed OS for STM32" (ตอนที่ 1)</a></li>
<li><a href="./mbed-stm32-part-2/">ตัวอย่างการเขียนโค้ด "ARM Mbed OS for STM32" (ตอนที่ 2)</a></li>
<li><a href="./mbed-stm32-part-3/">ตัวอย่างการเขียนโค้ด "ARM Mbed OS for STM32" (ตอนที่ 3)</a></li>
</ul>
<p>&nbsp;</p>
<hr />
<p><em>This work is licensed under a</em> <strong><em>Creative Commons Attribution-ShareAlike 4.0 International License.</em></strong></p>
<p>Created: 2021-11-23 | Last Updated: 2022-03-03</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021-2023 IoT Engineering Education, Bangkok/Thailand</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
