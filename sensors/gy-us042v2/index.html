<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="RSP">
        <link rel="canonical" href="https://iot-kmutnb.github.io/blogs/sensors/gy-us042v2/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>การใช้งานโมดูล GY-US042v2 Ultrasonic Sensor - IoT Engineering Education</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../../css/extra.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/arduino.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/vhdl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/verilog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/text.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/matlab.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/julia.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-966FQ6RN6W"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-966FQ6RN6W');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">IoT Engineering Education</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#gy-us042v2-ultrasonic-sensor" class="nav-link">การใช้งานโมดูล GY-US042v2 Ultrasonic Sensor</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#gy-us042v2" class="nav-link">&#9655; GY-US042v2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#i2c" class="nav-link">&#9655; การทำงานในโหมด I2C</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#serial" class="nav-link">&#9655; การทำงานในโหมด Serial</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#pulse" class="nav-link">&#9655; การทำงานในโหมด Pulse</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_1" class="nav-link">&#9655; กล่าวสรุป</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="gy-us042v2-ultrasonic-sensor">การใช้งานโมดูล GY-US042v2 Ultrasonic Sensor<a class="headerlink" href="#gy-us042v2-ultrasonic-sensor" title="Permanent link">#</a></h1>
<hr />
<h2 id="gy-us042v2">&#9655; <strong>GY-US042v2</strong><a class="headerlink" href="#gy-us042v2" title="Permanent link">#</a></h2>
<p>บทความนี้นำเสนอการใช้งาน <strong>GY-US042v2</strong> ซึ่งเป็นโมดูลเซนเซอร์อัลตราโซนิก  (<strong>Ultrasonic Sensor Module</strong>) 
ที่มีคุณสมบัติดังนี้</p>
<ul>
<li>ใช้แรงดันไฟเลี้ยง <strong>VCC</strong> ได้ในช่วง  <strong>3V ~ 5V</strong> (ใช้กระแสไฟฟ้าประมาณ <strong>9mA @5V</strong>)</li>
<li>ระยะทางที่วัดได้ (<strong>Measurement Range</strong>): เริ่มต้นตั้งแต่ <strong>20cm</strong> สูงสุด <strong>720cm</strong></li>
<li>ความละเอียดของค่าที่วัดได้ (<strong>Resolution</strong>): <strong>1cm</strong></li>
<li>โหมดการทำงาน 3 โหมด<ul>
<li><strong>I2C (SCL/SDA) mode</strong> (<em>default</em>)</li>
<li><strong>Serial (Tx/Rx) mode</strong> (<em>baud: 9600</em>)</li>
<li><strong>Pulse (Trigger/Echo) mode</strong></li>
</ul>
</li>
<li>ระยะเวลาในการวัดระยะทางจากวัตถุกีดขวางไม่เกิน: <strong>65ms</strong></li>
<li>คอนเนกเตอร์มี  6 ขา (2.54mm pin spacing)<ul>
<li><strong>Pin1: VCC</strong></li>
<li><strong>Pin2: GND</strong></li>
<li><strong>Pin3: CR (SCL/Rx/Trigger)</strong></li>
<li><strong>Pin4: DT (SDA/Tx/Echo)</strong></li>
<li><strong>Pin5: INT (Measurement Status)</strong></li>
<li><strong>Pin6: PS (Working Mode Selection)</strong></li>
</ul>
</li>
<li>ขาสัญญาณเชื่อมต่อ: <ul>
<li><strong>CR pin</strong>: <strong>SCL</strong> (I2C mode), <strong>Rx</strong> (Serial mode), <strong>Trigger</strong> (Pulse mode)</li>
<li><strong>DT pin</strong>: <strong>SDA</strong> (I2C mode), <strong>Tx</strong> (Serial mode), <strong>Echo</strong> (Pulse mode)</li>
</ul>
</li>
<li>ด้านหลังของโมดูลมี <strong>Solder Pads</strong> ไว้สำหรับบัดกรีเลือกโหมดการทำงาน หรือใช้ขา <strong>PS</strong> เป็นตัวเลือก<ul>
<li>โหมด <strong>Serial</strong>: ขา <strong>PS</strong> ต่อกับ <strong>VCC</strong> เพื่อกำหนดลอจิกเป็น <strong>H (High)</strong></li>
<li>โหมด <strong>Pulse</strong>: ขา <strong>PS</strong> ต่อกับ <strong>GND</strong> เพื่อกำหนดลอจิกเป็น <strong>L (Low)</strong></li>
<li>โหมด <strong>I2C</strong>: ขา <strong>PS</strong> ไม่เป็น <strong>L</strong> หรือ <strong>H</strong> (ให้ปล่อยลอยไว้เป็น  <strong>Floating input / Unconnected</strong>) </li>
</ul>
</li>
</ul>
<p><img alt="" src="GY-US042v2_modules.png" /></p>
<p>รูป: โมดูล <strong>GY-US042v2</strong></p>
<p>การทำงานในโหมด <strong>I2C</strong> มีแอดเดรสแบบ 7 บิต (<strong>7-bit Address</strong>)
เท่ากับ <strong>0x70</strong> (default) แต่สามารถส่งคำสั่งไปเปลี่ยนหรือตั้งค่าแอดเดรสได้
ถ้าต้องการวัดระยะทางให้ส่งคำสั่ง <strong>0x51</strong> ไปยังโมดูลดังกล่าว เว้นระยะเวลาอย่างน้อย <strong>65 ms</strong> แล้วอ่านข้อมูล 2 ไบต์ ซึ่งเป็น
<strong>High byte</strong> และ <strong>Low byte</strong> เพื่อนำมาต่อกันแบบ <strong>Big Endian</strong> จะได้ค่าเลขจำนวนเต็ม หน่วยเป็นเซนติเมตร</p>
<p>การทำงานในโหมด <strong>Serial</strong> จะใช้ขา <strong>DT</strong> สำหรับ <strong>TX</strong> และขา <strong>CR</strong> สำหรับ <strong>RX</strong>
และใช้ค่า <strong>Baudrate</strong> เท่ากับ <strong>9600</strong>  โดยจะวัดระยะทางและส่งค่าออกมาต่อเนื่องไปเรื่อย ๆ 
(<strong>Continuous Output</strong>) ด้วยอัตราไม่เกิน <strong>1000/65 = 15</strong> ครั้งต่อวินาที</p>
<p>ข้อมูลที่ถูกส่งออกมาในแต่ละครั้ง จะมีจำนวน 7 ไบต์ ตามรูปแบบดังนี้
<code>0x5A 0x5A 0x45 0x02 HB LB CS</code></p>
<ul>
<li>Frame header (2 bytes):<code>0x5A 0x5A</code> </li>
<li>Frame data type (1 byte): <code>0x45</code></li>
<li>Amount of data (1 byte): <code>0x02</code></li>
<li>Data (2 bytes): <code>HB</code> = High Byte, <code>LB</code> = Low Byte</li>
<li>Checksum (1 byte): <code>CS</code> = Checksum (Sum of the first 6 bytes)</li>
</ul>
<p>การทำงานในโหมด <strong>Pulse</strong> จะต้องส่งสัญญาณพัลส์ ไปยังขา <strong>CR (Trigger)</strong> ของโมดูลเซนเซอร์
และรอสัญญาณพัลส์ที่ขา <strong>DT (Echo)</strong> เป็นสัญญาณตอบกลับ
และใช้ในการวัดความกว้างของสัญญาณดังกล่าว</p>
<p>&nbsp;</p>
<hr />
<h2 id="i2c">&#9655; <strong>การทำงานในโหมด I2C</strong><a class="headerlink" href="#i2c" title="Permanent link">#</a></h2>
<p>ตัวอย่างโค้ด <strong>Arduino Sketch</strong> ต่อไปนี้ ใช้สำหรับบอร์ด <strong>ESP32</strong> เช่น <strong>WeMos Lolin32 Lite</strong>
เพื่อสาธิตการตรวจสอบดูว่า มีโมดูลเชื่อมต่อกับบัส <strong>I2C</strong> หรือไม่ </p>
<p>ในการทดลอง ให้นำโมดูลเซนเซอร์มาต่อกับ <strong>ESP32</strong> ในโหมดการทำงานแบบ <strong>I2C</strong>
ตัวอย่างนี้ได้เลือกใช้ขา <strong>GPIO16</strong> และ <strong>GPIO17</strong> ของ <strong>ESP32</strong>
 สำหรับ <strong>SDA</strong> และ  <strong>SCL</strong> ตามลำดับ และใช้แรงดันไฟเลี้ยงสำหรับโมดูลเท่ากับ <strong>3.3V</strong></p>
<pre><code class="language-cpp">#include &lt;Wire.h&gt;

#define I2C_SDA_PIN (16)
#define I2C_SCL_PIN (17)

void setup() {
  Serial.begin( 115200 );
  Wire.begin( I2C_SDA_PIN, I2C_SCL_PIN );
  Wire.setClock( 400000 ); // 400kHz
}

void i2c_scan() {
  int n_devices = 0;
  Serial.println( &quot;Scanning I2C bus...&quot; );
  Serial.print( &quot;   &quot; );
  for ( uint8_t col=0; col &lt; 16; col++ ) {
    Serial.printf( &quot;%3x&quot;, col );
  }
  Serial.println( &quot;&quot; );

  uint8_t addr=0;
  for( uint8_t row=0; row &lt; 8; row++ ) {
    Serial.printf( &quot;%02x:&quot;, row &lt;&lt; 4 );
    for ( uint8_t col=0; col &lt; 16; col++ ) {
      if ( row == 0 &amp;&amp; addr&lt;=1 ) {
        Serial.print(&quot;   &quot;);
      } else {
        Wire.beginTransmission( addr );
        if ( Wire.endTransmission()&gt;0 ) {
          Serial.printf( &quot; --&quot; );
        } else {
          Serial.printf( &quot; %2x&quot;, addr );
          n_devices++;
        }
      }
      addr++;
    }
    Serial.println( &quot;&quot; );
  }
  Serial.println( &quot;---------------------\n\n&quot; );
  Serial.flush();
}

void loop() {
  i2c_scan();
  delay(2000);
}
</code></pre>
<p><img alt="" src="esp32_gy-042v2.jpg" /></p>
<p>รูป: การต่อวงจรทดลองโมดูล <strong>GY-042V2</strong> ร่วมกับบอร์ด <strong>ESP32</strong></p>
<p><img alt="" src="i2c_scan_output.png" /></p>
<p>รูป: ตัวอย่างข้อความเอาต์พุตในหน้าต่างของ <strong>Arduino Serial Monitor</strong></p>
<p>จากข้อความเอาต์พุตใน <strong>Arduino Serial Monitor</strong> จะเห็นได้ว่า มีอุปกรณ์ที่ทำงานเป็น
<strong>I2C Slave Device</strong> อยู่ 2 อุปกรณ์ มีค่าแอดเดรสเท่ากับ <code>0x70</code> และ <code>0x71</code> ตามลำดับ</p>
<p>ถัดไปเป็นตัวอย่างโค้ดสำหรับอ่านค่าจากโมดูลเซนเซอร์ ที่มีแอดเดรสเท่ากับ <code>0x70</code> และค่าที่วัดได้เป็นเลขจำนวนเต็ม
มีหน่วยเป็นเซนติเมตร ถ้ามีค่าไม่เท่ากับ <code>INVALID_VALUE</code> หรือ <code>720</code> จะถือว่า 
เซนเซอร์สามารถวัดระยะทางจากวัตถุกีดขวางได้</p>
<pre><code class="language-cpp">#include &lt;Wire.h&gt;

// select GPIO pins for I2C bus
#define I2C_SDA_PIN    (16)
#define I2C_SCL_PIN    (17)

#define INVALID_VALUE   (720)
#define I2C_ADDR        (0x70)

void setup() {
  Serial.begin( 115200 );
  Serial.println( &quot;ESP32 GY-042V2 (I2C Mode)&quot; );
  Serial.flush();
  Wire.begin( I2C_SDA_PIN, I2C_SCL_PIN );
  Wire.setClock( 400000 ); // 400kHz
}

uint32_t read_sensor( uint8_t addr ) {
  Wire.beginTransmission( addr );
  Wire.write( 0x51 ); // send the measurement command
  if ( Wire.endTransmission( ) &gt; 0 ) {
     return INVALID_VALUE;
  }
  delay( 65 ); // Wait at least 65 msec.
  Wire.requestFrom( addr, 2, true );
  if ( Wire.available() &gt;= 2 ) {
    uint16_t distance = Wire.read();
    distance = (distance &lt;&lt; 8) | Wire.read();
    return distance; // in cm.
  }
  return INVALID_VALUE;
}

void loop() {
  int distance = read_sensor( I2C_ADDR );
  if (distance &lt; INVALID_VALUE) {
    Serial.printf( &quot;distance: %3u\n&quot;, distance ); 
    delay(100);
  }
}
</code></pre>
<p><img alt="" src="i2c_output_distance.png" /></p>
<p>รูป: ตัวอย่างข้อความเอาต์พุตจากการวัดระยะทางในโหมด <strong>I2C</strong> (วัดระยะทางได้ 201 ซม.)</p>
<p>หากต้องการเปลี่ยนแอดเดรสของโมดูล ก็สามารถสร้างและเรียกใช้ฟังก์ชันดังนี้</p>
<pre><code class="language-cpp">void change_addr( uint8_t old_addr, uint8_t new_addr ) {
  Wire.beginTransmission( old_addr );
  Wire.write( 0xAA );
  Wire.write( 0xA5 );
  Wire.write( new_addr &lt;&lt; 1 );
  Wire.endTransmission( );
}
</code></pre>
<p>ตัวอย่างการเรียกใช้ฟังก์ชัน เช่น  <code>change_addr( 0x70, 0x71 );</code>
ซึ่งเป็นตัวอย่างการเปลี่ยนจากแอดเดรสจากเดิม <code>0x70</code> ให้เป็น <code>0x71</code>
และเมื่อเปลี่ยนแอดเดรสใหม่แล้ว จะต้องรีเซตการทำงานของโมดูล จึงจะเริ่มใช้แอดเดรสใหม่</p>
<p>&nbsp;</p>
<hr />
<h2 id="serial">&#9655; <strong>การทำงานในโหมด Serial</strong><a class="headerlink" href="#serial" title="Permanent link">#</a></h2>
<p>ถัดไปเป็นการทดลองใช้งานโมดูลในโหมด <strong>Serial</strong> โดยใช้วงจร <strong>UART</strong> ภายใน <strong>ESP32</strong>
และเลือกใช้  <strong>Serial2</strong> ซึ่งจะต้องใช้ขา <strong>GPIO16</strong> / <strong>GPIO17</strong> สำหรับขา
<strong>RX</strong> และ <strong>TX</strong> ตามลำดับ และใช้ค่า <strong>Baudrate</strong> เท่ากับ <strong>9600</strong>
และที่สำคัญคือ จะต้องต่อขา <strong>PS</strong> ไปยัง <strong>VCC (3.3V)</strong> เพื่อเลือกโหมดการทำงานให้ถูกต้อง</p>
<p>การทำงานของโค้ดตัวอย่างนี้ จะคอยรับข้อมูลไบต์จากโมดูลเซนเซอร์ที่ส่งข้อมูลชุดละ 7 ไบต์ 
และสามารถใช้ข้อมูลที่มีค่า <code>0x5A</code> เป็นตัวแบ่ง หรือ <strong>Delimiter</strong> แล้วเก็บข้อมูลที่อ่านได้ลงในอาร์เรย์
เพื่อนำไปตรวจสอบค่า <strong>Checksum Byte</strong> ถ้าได้ค่าถูกต้อง ก็ให้แปลงข้อมูล 2 ไบต์ ให้เป็นค่าตัวเลขสำหรับระยะทางที่วัดได้</p>
<pre><code class="language-cpp">// see: https://github.com/espressif/arduino-esp32/blob/master/cores/esp32/HardwareSerial.cpp
#define ESP_SERIAL         Serial2
#define ESP_SERIAL_RX_PIN  (16)
#define ESP_SERIAL_TX_PIN  (17)

#define SENSOR_SERIAL_BAUD (9600)
#define SERIAL_TIMEOUT_MS  (100)

#ifdef LED_BUILTIN
#define LED_PIN  LED_BUILTIN
#else
#define LED_PIN  22
#endif

byte buf[7] = {0x5A,0x5A,0x00};

void setup() {
  pinMode( LED_PIN, OUTPUT );
  digitalWrite( LED_PIN, LOW );
  Serial.begin( 115200 );
  ESP_SERIAL.begin( SENSOR_SERIAL_BAUD );

  Serial.println( &quot;ESP32 GY-042V2 (Serial Mode)&quot; );
  Serial.flush();

  Serial.setTimeout( SERIAL_TIMEOUT_MS );
  ESP_SERIAL.setTimeout( SERIAL_TIMEOUT_MS );
  digitalWrite( LED_PIN, HIGH );
}

void loop() {
  int n_read = ESP_SERIAL.readBytesUntil( 0x5A, &amp;buf[2], 5 );
  if ( n_read == 5 &amp;&amp; buf[2] == 0x45 &amp;&amp; buf[3] == 0x02 ) {
     digitalWrite( LED_PIN, HIGH );
     uint8_t sum = 0;
     for ( int i=0; i &lt; 6; i++ ) { // sum of the first 6 bytes
       sum += buf[i];
     }
     if ( sum == buf[6] ) { // checksum OK
        uint16_t distance = buf[4];
        distance = (distance &lt;&lt; 8) | buf[5];
        Serial.printf( &quot;distance(cm): %3u\n&quot;, distance );      
     } else {
        Serial.printf( &quot;checksum failed\n&quot;);      
     }
     digitalWrite( LED_PIN, LOW );
     delay(100);
  }
}
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="pulse">&#9655; <strong>การทำงานในโหมด Pulse</strong><a class="headerlink" href="#pulse" title="Permanent link">#</a></h2>
<p>ถัดไปเป็นการทดลองใช้งานโมดูลเซนเซอร์ในโหมด <strong>Pulse</strong> 
และเลือกใช้  <strong>GP16</strong> และ <strong>GP17</strong> ของ <strong>ESP32</strong>
เป็นขา <strong>Echo</strong> และ <strong>Trigger</strong> ตามลำดับ
และจะต้องต่อขา <strong>PS</strong> ไปยัง <strong>GND</strong> เพื่อเลือกโหมดการทำงานให้ถูกต้อง</p>
<p>ตัวอย่างโค้ดสาธิตมีดังนี้</p>
<pre><code class="language-cpp">#define SOUND_SPEED   (342)
#define US_TO_CM(t)   ((SOUND_SPEED*t)/20000)
#define TIMEOUT_USEC  (40000)
#define ECHO_PIN      (16)
#define TRIG_PIN      (17)

void setup() {
  pinMode( ECHO_PIN, INPUT );
  pinMode( TRIG_PIN, OUTPUT );
  Serial.begin( 115200 );
  Serial.println( &quot;ESP32 GY-042V2 (Pulse Mode)&quot; );
  Serial.flush();
}

uint32_t read_sensor() {
  digitalWrite( TRIG_PIN, HIGH );
  delayMicroseconds( 20 );
  digitalWrite( TRIG_PIN, LOW );
  // Measure the HIGH pulse width (in usec) 
  return pulseIn( ECHO_PIN, HIGH, TIMEOUT_USEC );
}

void loop() {
  uint32_t t_usec = read_sensor();
  Serial.print( &quot;distance(cm): &quot; );      
  if ( t_usec == 0 ) { // no pulse detected
    Serial.println( &quot;---&quot; );    
  } else {   
    Serial.printf( &quot;%3lu\n&quot;, US_TO_CM(t_usec) );
  }
  delay(100);
}
</code></pre>
<p>ในโค้ดตัวอย่าง เมื่อได้สร้างสัญญาณเอาต์พุตที่ขา <strong>Trigger</strong> เป็นพัลส์ความกว้างประมาณ 20 ไมโครวินาทีแล้ว
ขั้นตอนถัดไปคือ การวัดความกว้างของพัลส์ที่เกิดกับสัญญาณ <strong>Echo</strong> โดยใช้ฟังก์ชัน
<code>pulseIn()</code> ซึ่งเป็นคำสั่งของ <strong>Arduino API</strong>
โดยจะต้องระบุหมายเลขขา <strong>Echo</strong> สำหรับสัญญาณพัลส์ช่วงที่เป็น <strong>HIGH</strong>
และมีการกำหนดระยะเวลาในการรอเพื่อวัดความกว้างของพัลส์ที่เกิดขึ้น
หรือ <strong>"Waiting Timeout"</strong> ไว้ไม่เกิน <strong>40000</strong> (ไมโครวินาที)</p>
<p>ความกว้างของสัญญาณพัลส์ คือ ระยะเวลาในการเดินทางไปและกลับของคลื่นเสียงอัตราโซนิกเมื่อสะท้อนกลับจากวัตถุกีดขวางด้านหน้า 
ถ้ากำหนดให้ความเร็วเสียงในอากาศ (<script type="math/tex">v_{Sound}</script>) เช่น 342 เมตร/วินาที โดยประมาณ (ขึ้นอยู่กับปัจจัย เช่น
อุณหภูมิและความชื้นสัมพัทธ์ของอากาศด้วย) จะสามารถเขียนสูตรคำนวณได้ดังนี้</p>
<p>
<script type="math/tex; mode=display">
  distance\,[cm] = \frac{v_{Sound}\,[m/s] \times 10^2 \times t\,[usec] \times 10^{-6}}{2}
</script>
หรือเขียนใหม่ได้เป็น
<script type="math/tex; mode=display">
  distance\,[cm] = \frac{v_{Sound}\,[m/s] \times t\,[usec] }{20000}
</script>
</p>
<p>&nbsp;</p>
<hr />
<h2 id="_1">&#9655; <strong>กล่าวสรุป</strong><a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p>บทความนี้ได้นำเสนอการใช้งานโมดูลเซนเซอร์อัลตราโซนิก <strong>GY-US042v2</strong> 
และตัวอย่างการเขียนโค้ด <strong>Arduino Sketch</strong> สำหรับบอร์ดไมโครคอนโทรลเลอร์ <strong>ESP32</strong>
เพื่ออ่านค่าจากโมดูลเซนเซอร์ ในโหมดการทำงาน <strong>I2C</strong>, <strong>Serial</strong> และ <strong>Pulse</strong> ตามลำดับ</p>
<p><strong>บทความที่เกี่ยวข้อง</strong></p>
<ul>
<li>การใช้งานโมดูล <a href="../hc-sr04/"><strong>HC-SR04 Ultrasonic Sensor</strong></a></li>
</ul>
<p>&nbsp;</p>
<hr />
<p><em>This work is licensed under a</em> <strong><em>Creative Commons Attribution-ShareAlike 4.0 International License</em></strong>.</p>
<p>Created: 2022-10-18 | Last Updated: 2022-10-18</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021-2023 IoT Engineering Education, Bangkok/Thailand</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
