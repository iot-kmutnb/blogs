<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="RSP">
        <link rel="canonical" href="http://iot-kmutnb.github.com/blogs/esp32/esp32_vscode_pio/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>การใช้งาน PlatformIO ร่วมกับ VS Code IDE สำหรับบอร์ด ESP32 - IoT Engineering Education</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../../css/extra.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/c++.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/arduino.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/vhdl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/verilog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/matlab.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/julia.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">IoT Engineering Education</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#platformio-vs-code-ide-esp32" class="nav-link">การใช้งาน PlatformIO ร่วมกับ VS Code IDE สำหรับบอร์ด ESP32</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#platformio" class="nav-link">&#9655; PlatformIO</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#platformio-extension" class="nav-link">&#9655; การติดตั้ง PlatformIO Extension</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_1" class="nav-link">&#9655; การสร้างโปรเจกต์ใหม่</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#platformio-cli" class="nav-link">&#9655; ตัวอย่างคำสั่ง PlatformIO CLI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#platformio-cli_1" class="nav-link">&#9655; การสร้างโปรเจกต์และคอมไพล์โค้ดด้วย PlatformIO CLI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#arduino-library" class="nav-link">&#9655; การใช้งาน Arduino Library</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link">&#9655; บทความที่เกี่ยวข้อง</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_3" class="nav-link">&#9655; กล่าวสรุป</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="platformio-vs-code-ide-esp32">การใช้งาน PlatformIO ร่วมกับ VS Code IDE สำหรับบอร์ด ESP32<a class="headerlink" href="#platformio-vs-code-ide-esp32" title="Permanent link">#</a></h1>
<hr />
<h2 id="platformio">&#9655; <strong>PlatformIO</strong><a class="headerlink" href="#platformio" title="Permanent link">#</a></h2>
<p><strong>PlatformIO</strong> (หรือเขียนชื่อย่อเป็น <strong>PIO</strong>) ของบริษัท <strong>PlatformIO Labs</strong>
เป็นซอฟต์แวร์ประเภท <strong>Open Source (Apache License)</strong>
ที่สามารถนำมาใช้ในการพัฒนาเฟิร์มแวร์ด้วยภาษา <strong>C/C++</strong>
สำหรับไมโครคอนโทรลเลอร์หลายแบบหลายตระกูล</p>
<p><strong>PIO</strong> สามารถใช้งานได้ร่วมกับ  <a href="https://code.visualstudio.com/"><strong>Microsoft VS Code IDE</strong></a> โดยนำมาติดตั้งใช้งานในรูปแบบที่เรียกว่า <strong>VS Code Extension</strong>
แต่ในเอกสารนี้จะกล่าวถึงการติดตั้งและใช้งานร่วมกับ <strong>VS Code IDE</strong> สำหรับระบบปฏิบัติการ <strong>Windows</strong> เท่านั้น</p>
<p><strong>PIO</strong> มีการแบ่งหรือจัดกลุ่มองค์ประกอบของซอฟต์แวร์ที่เกี่ยวข้องกับตัวเลือกทางฮาร์ดแวร์ ดังนี้</p>
<ul>
<li><a href="https://docs.platformio.org/en/stable/frameworks/index.html"><strong>Frameworks</strong></a> หมายถึง วิธีการหรือรูปแบบที่ใช้ในการเขียนโค้ด เช่น<ul>
<li><a href="https://docs.platformio.org/en/stable/frameworks/arduino.html"><code>arduino</code></a>
การเขียนโค้ดด้วย <strong>API</strong> ของ  <strong>Arduino</strong> ซึ่งเป็นรูปแบบที่นิยมใช้กัน</li>
<li><a href="https://docs.platformio.org/en/stable/frameworks/cmsis.html"><code>cmsis</code></a> 
การเขียนโค้ดโดยใช้ <strong>API</strong> ของ  <strong>ARM CMSIS</strong> สำหรับไมโครคอนโทรลเลอร์ตระกูล
<strong>32-bit Arm Cortex-M0/M3/M4/M7</strong> เท่านั้น</li>
<li><a href="https://docs.platformio.org/en/stable/frameworks/espidf.html"><code>espidf</code></a> 
การเขียนโค้ดโดยใช้ <strong>API</strong> ของ  <strong>Espressif ESP-IDF</strong> สำหรับชิปของบริษัท 
เช่น <strong>ESP32 / ESP32-S2 / ESP-S3</strong> และ <strong>ESP32-C3</strong></li>
<li><a href="https://docs.platformio.org/en/stable/frameworks/stm32cube.html"><code>stm32cube</code></a>
การเขียนโค้ดใช้ <strong>API</strong> ของ  <strong>STM32HAL / STM32Cube</strong> สำหรับชิปของบริษัท
<strong>STMicroelectronics</strong> เท่านั้น</li>
<li><a href="https://docs.platformio.org/en/stable/frameworks/mbed.html"><code>mbed</code></a> 
การเขียนโค้ดใช้  <strong>ARM Mbed RTOS</strong> ซึ่งเป็นระบบปฏิบัติการเวลาจริงแบบ <strong>Open Source</strong> ของบริษัท <strong>Arm</strong> และใช้สำหรับบอร์ดไมโครคอนโทรลเลอร์ที่มีซีพียูภายในเป็น <strong>ARM Cortex-M Series</strong>
เท่านั้น เช่น ชิปของบริษัท <strong>STMicroelectronics</strong> และ <strong>NXP/Freescale</strong> เป็นต้น</li>
<li><a href="https://docs.platformio.org/en/stable/frameworks/freertos.html"><code>freertos</code></a> 
การเขียนโค้ดใช้  <strong>AWS FreeRTOS</strong> ซึ่งเป็นระบบปฏิบัติการเวลาจริงแบบ <strong>Open Source</strong>
อีกตัวเลือกหนึ่ง</li>
<li><a href="https://docs.platformio.org/en/stable/frameworks/zephyr.html"><code>zephyr</code></a> 
การเขียนโค้ดใช้  <strong>Zephyr RTOS</strong> ซึ่งเป็นระบบปฏิบัติการเวลาจริงแบบ <strong>Open Source</strong>
อีกตัวเลือกหนึ่ง</li>
</ul>
</li>
<li><a href="https://docs.platformio.org/en/stable/platforms/index.html"><strong>Platforms</strong></a>
หมายถึง การแบ่งกลุ่มของบอร์ดต่าง ๆ ตามสถาปัตยกรรมของตัวประมวลผล
และจะต้องใช้เครื่องมือที่เป็นซอฟต์แวร์ วิธีการคอมไพล์โค้ด วิธีการอัปโหลดเฟิร์มแวร์
และการดีบักโค้ดที่แตกต่างกันไป เช่น<ul>
<li><a href="https://docs.platformio.org/en/latest/platforms/atmelavr.html"><code>atmelavr</code></a> สำหรับชิป  <strong>Microchip/Atmel AVR (8-bit)</strong> เช่น บอร์ด <strong>Arduino Uno, Nano, MEGA2560</strong> เป็นต้น</li>
<li><a href="https://docs.platformio.org/en/latest/platforms/atmelsam.html"><code>atmelsam</code></a> สำหรับชิป <strong>Microchip/Atmel SAM Series</strong> เช่น บอร์ด <strong>Arduino Zero / Arduino MKR Series (SAMD21-based)</strong></li>
<li><a href="https://docs.platformio.org/en/latest/platforms/espressif32.html"><code>espressif32</code></a>
สำหรับชิปของบริษัท <strong>Espressif Systems</strong> เท่านั้น เช่น  <strong>ESP32/ESP32-S2/-S3/-C3</strong></li>
<li><a href="https://docs.platformio.org/en/latest/platforms/ststm32.html"><code>ststm32</code></a> สำหรับชิป <strong>STM32</strong> ของบริษัท <strong>STMicroelectronics</strong> เช่น บอร์ด <strong>STM32 Nucleo</strong> และบอร์ด <strong>BlackPill (STM32F4xx)</strong></li>
<li><a href="https://docs.platformio.org/en/latest/platforms/nordic52.html"><code>nordic52</code></a> สำหรับชิปตระกูล <strong>nRF52xxx</strong> ของบริษัท <strong>Nordic Semiconductor</strong></li>
</ul>
</li>
<li><a href="https://docs.platformio.org/en/latest/librarymanager/index.html"><strong>PlatformIO Library Manager</strong></a>
ใช้สำหรับการติดตั้งและจัดการไลบารีต่าง ๆ ที่เป็น <strong>Open Source</strong> เช่น ไลบรารีสำหรับ <strong>Arduino</strong> เป็นต้น</li>
</ul>
<hr />
<h2 id="platformio-extension">&#9655; <strong>การติดตั้ง PlatformIO Extension</strong><a class="headerlink" href="#platformio-extension" title="Permanent link">#</a></h2>
<p>หากยังไม่เคยใช้งาน <strong>VS Code IDE</strong> ให้ติดตั้งซอฟต์แวร์ในเครื่องคอมพิวเตอร์ของผู้ใช้ก่อน</p>
<p><img alt="" src="vscode_ide.png" /></p>
<p>รูป: <strong>Microsoft VS Code IDE</strong> (เว็บไซต์สำหรับดาวน์โหลดไฟล์เพื่อติดตั้งและใช้งาน)</p>
<p>เมื่อได้ติดตั้ง <strong>VS Code IDE</strong> ไว้พร้อมใช้งานแล้ว ถัดไปเป็นการติดตั้ง <strong>PlatformIO IDE Extension</strong> สำหรับ <strong>VS Code</strong> ซึ่งก็ทำได้ไม่ยาก</p>
<p>ให้คลิกเลือกจากปุ่ม <strong>"Extensions"</strong> ในแถบทางซ้ายมือ 
หรือกดปุ่ม <strong>Ctrl+Shift+X</strong> จากนั้นให้พิมพ์และค้นหาชื่อ <code>platformio</code> 
ในส่วนที่เกี่ยวข้องกับการติดตั้ง <strong>Extensions</strong> และกดปุ่ม <strong>Install</strong> เพื่อทำการติดตั้งรายการดังกล่าว</p>
<p><img alt="" src="vscode_ide_extensions.png" /></p>
<p>รูป: การค้นหาและติดตั้ง <strong>PlatformIO IDE extension</strong> สำหรับ <strong>VS Code</strong></p>
<p>เมื่อติดตั้ง <strong>PIO</strong> ได้แล้ว จะเห็นว่า ในแถบทางด้านซ้ายมือ มีไอคอน (<strong>Icon</strong>) ชื่อ <strong>PlatformIO</strong>
ถูกใส่เพิ่มเข้ามา ให้คลิกที่ไอคอนดังกล่าว แล้วจะเห็นแถบเมนูรายการคำสั่งปรากฏเพิ่ม ให้คลิกเลือก <strong>PIO Home</strong> 
เพื่อเข้าสู่หน้าต่างหลักของ <strong>PIO Home</strong></p>
<p><img alt="" src="vscode_ide_pio_home.png" /></p>
<p>รูป: หน้าต่างเมื่อเปิดใช้งาน <strong>PIO Home</strong> ใน <strong>VS Code IDE</strong></p>
<p>ในหน้าต่าง <strong>PIO Home</strong> มีการแบ่งออกเป็นส่วนต่าง ๆ และมีหลายเมนูคำสั่ง
เช่น การสร้างโปรเจกต์ใหม่  การติดตั้งและใช้งานแพลตฟอร์ม (<strong>Platforms</strong>) และบอร์ดไมโครคอนโทรลเลอร์ (<strong>Boards</strong>) การติดตั้งและใช้งานไลบรารีต่าง ๆ (<strong>Libraries</strong>)
การตรวจสอบดูว่า มีอุปกรณ์หรือบอร์ดไมโครคอนโทรลเลอร์ใดบ้างที่กำลังเชื่อมต่ออยู่กับคอมพิวเตอร์ของผู้ใช้ เป็นต้น</p>
<p>&nbsp;</p>
<hr />
<h2 id="_1">&#9655; <strong>การสร้างโปรเจกต์ใหม่</strong><a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p>การสร้างโปรเจกต์ใหม่ใน <strong>PIO Home</strong> เริ่มต้นด้วยการกดปุ่ม <strong>PIO</strong> ที่ในแถบทางด้านซ้ายมือ
จากนั้นให้ไปที่เมนู <strong>QUICK ACCESS &gt; PIO Home &gt; Open</strong> ในหน้าต่าง <strong>PIO Home</strong>
จะมีปุ่ม <strong>+ New Project</strong> เพื่อเริ่มต้นสร้างโปรเจกต์ใหม่โดยใช้ <strong>PIO Project Wizard</strong></p>
<ol>
<li>ตั้งชื่อโปรเจกต์ (<strong>Project Name</strong>) เช่น "<strong>esp32_led_blink</strong>"</li>
<li>เลือกบอร์ดที่จะใช้งาน (<strong>Board</strong>) เช่น เลือกบอร์ด "<strong>WEMOS Lolin32 Lite</strong>" สำหรับชิป  <strong>ESP32</strong></li>
<li>เลือกรูปแบบการเขียนโค้ด (<strong>Framework</strong>) เช่น <strong>"Arduino Framework"</strong></li>
<li>เลือกไดเรกทอรีสำหรับการจัดเก็บไฟล์ของโปรเจกต์ (<strong>Location</strong>) อาจจะเลือกเป็น <strong>default</strong>
หรือกำหนดเองก็ได้</li>
</ol>
<p><img alt="" src="pio_new_project.png" /></p>
<p>รูป: การสร้างโปรเจกต์ใหม่ในหน้าต่าง <strong>Project Wizard</strong></p>
<p><img alt="" src="pio_esp32_board_selection.png" /></p>
<p>รูป: รายการของบอร์ด <strong>ESP32</strong> (บางส่วน) ที่สามารถเลือกใช้ได้</p>
<p>&nbsp;</p>
<p>เมื่อสร้างโปรเจกต์ได้แล้ว ก็สามารถมองเห็นไฟล์และไดเรกทอรีภายในโปรเจกต์ที่ถูกสร้างขึ้นมา เช่น 
ไฟล์ <code>src/main.cpp</code> ที่ใช้สำหรับเขียนการโค้ด <strong>Arduino Sketch</strong>
ซึ่งจะต้องมีอย่างน้อยหนึ่งไฟล์ที่เป็น <strong>Source Code</strong> ในโปรเจกต์ เหมือนกรณีที่ใช้งานซอฟต์แวร์ 
<strong>Arduino IDE</strong> เพื่อเขียนโค้ดในไฟล์ <strong>Arduino Sketch (.ino)</strong> </p>
<p><img alt="" src="pio_project_main.png" /></p>
<p>รูป: รายการไฟล์และไดเรกทอรีของโปรเจกต์ใหม่ในช่องทางด้านซ้ายมือ</p>
<p>&nbsp;</p>
<p>ไฟล์ <code>platformio.ini</code> (<a href="https://docs.platformio.org/en/latest/projectconf/"><strong>Project Configuration File</strong></a>)
เป็นอีกหนึ่งไฟล์ที่สำคัญและใช้ในการกำหนดหรือตั้งค่าสำหรับโปรเจกต์ และถูกสร้างขึ้นมาโดยอัตโนมัติ</p>
<p>ส่วนที่เริ่มต้นด้วย <code>[env:lolin_lite]</code> เรียกว่า <strong>Environment Setting Section</strong>
และมีชื่อของ <strong>Environment Name</strong> เป็น <code>lolin_lite</code> สำหรับโปรเจกต์ในตัวอย่างนี้</p>
<p><img alt="" src="pio_project_platformio_ini.png" /></p>
<p>รูป: ไฟล์ <code>platformio.ini</code></p>
<p><strong>ข้อสังเกต:</strong> ในหนึ่งโปรเจกต์สามารถมี <strong>Environment Sections</strong> ได้มากกว่าหนึ่ง 
ยกตัวอย่างเช่น การเขียนโค้ด <strong>Arduino Sketch</strong> ที่สามารถนำไปใช้กับบอร์ดไมโครคอนโทรลเลอร์ที่แตกต่างกันได้ 
หรือมีรูปแบบการตั้งค่าใช้งานที่แตกต่างกัน ดังนั้นจึงมี <strong>Environments</strong> สำหรับการทำขั้นตอน
<strong>Build Process</strong> แยกกันในแต่ละกรณีได้</p>
<p>ในส่วนนี้จะเห็นได้ว่า มีการกำหนดค่าตัวเลือกสำหรับโปรเจกต์ เช่น มีการระบุว่า <strong>Platform</strong> 
ที่ใช้คือ <code>espresssif32</code> มี <strong>Framework</strong> ที่ใช้คือ <code>arduino</code>
ผู้ใช้สามารถระบุค่าตัวเลือกอื่นเพิ่มได้ เช่น <code>upload_port</code> เพื่อระบุหมายเลขของพอร์ตอนุกรม
(<strong>Serial Port</strong>) และ <code>upload_speed</code>
ความเร็วในการสื่อสารข้อมูลสำหรับการเชื่อมต่อกับอุปกรณ์หรือบอร์ดไมโครคอนโทรลเลอร์ เป็นต้น</p>
<p><strong>File:</strong> <code>platformio.ini</code></p>
<pre><code>[env:lolin32_lite]
platform = espressif32
board = lolin32_lite
framework = arduino
upload_speed = 921600
monitor_speed = 115200
upload_port = COM5
</code></pre>
<p>&nbsp;</p>
<p>ถัดไปให้แก้ไขโค้ดในไฟล์ <code>main.cpp</code> ตามตัวอย่างต่อไปนี้ (<strong>ESP32 LED Blink</strong> ทำให้ <strong>LED</strong>
ที่ขา <strong>GPIO-22</strong> กระพริบ) แล้วบันทึกการแก้ไขลงไฟล์ </p>
<pre><code class="language-c">#include &lt;Arduino.h&gt;

#define LED_PIN  22 // use GPIO-22

void setup() {
  pinMode( LED_PIN, OUTPUT );
}

void loop() {
  // toggle LED
  digitalWrite( LED_PIN, !digitalRead(LED_PIN) );
  delay(500);
}
</code></pre>
<p>&nbsp;</p>
<p>จากนั้นให้ทำคำสั่ง <strong>PlatformIO: Build</strong> ให้สังเกต สัญลักษณ์
&#x2713; หรือ เครื่องหมายถูก ตรงแถบด้านล่างของ <strong>VS Code IDE</strong> เลื่อนเมาส์ไปตำแหน่งดังกล่าว
แล้วกดคลิกเพื่อทำคำสั่ง  หรือไปที่ <strong>PlatformIO &gt; PROJECT TASKS</strong> จากนั้นดูคำสั่งที่เกี่ยวข้องกับโปรเจกต์ 
เช่น <strong>Build</strong>, <strong>Upload</strong>, <strong>Monitor</strong> และ <strong>Clean</strong> เป็นต้น</p>
<p><img alt="" src="pio_project_build.png" /></p>
<p>รูป: การทำคำสั่ง <strong>PlatformIO Build</strong></p>
<p>เมื่อคอมไพล์โค้ดและได้ไฟล์ <code>firmware.elf</code> ได้สำเร็จแล้ว ก็สามารถนำไปใช้กับบอร์ด <strong>ESP32</strong> โดยให้เสียบสาย <strong>USB</strong> เชื่อมต่อกับคอมพิวเตอร์ของผู้ใช้  และตรวจสอบหมายเลขพอร์ตอนุกรมของบอร์ด <strong>ESP32</strong> ที่ได้นำมาใช้งานในขณะนั้น</p>
<p>การตรวจสอบเพื่อดูว่า บอร์ด <strong>ESP32</strong> เชื่อมต่อผ่านทางพอร์ตอนุกรมใดในขณะนั้น ทำได้หลายวิธี 
วิธีการหนึ่งคือ การเปิดใช้งาน <strong>PlatformIO Core CLI (Command Line Interface)</strong> 
ในหน้าต่าง <strong>Windows Powershell</strong> 
จากนั้นทำคำสั่ง <code>pio device list</code> ในหน้าต่าง <strong>Terminal</strong></p>
<p><img alt="" src="pio_device_list.png" /></p>
<p>รูป: ตัวอย่างการคำสั่ง <code>pio device list</code></p>
<p>&nbsp;</p>
<p>ให้ตรวจสอบการตั้งค่าสำหรับ <code>upload_port</code> ในไฟล์ <code>platformio.ini</code> ให้ถูกต้อง
ก่อนทำขั้นตอน <strong>PlatformIO: Upload</strong></p>
<p><img alt="" src="pio_upload.png" /></p>
<p>รูป: ตัวอย่างการทำคำสั่ง <strong>PlatformIO: Upload</strong></p>
<p>เมื่อได้ทำมาถึงขั้นตอนนี้ ซึ่งเป็นขั้นตอนสุดท้าย จะสังเกตเห็นว่า <strong>LED</strong> ที่อยู่บนบอร์ดไมโครคอนโทรลเลอร์
จะกระพริบด้วยอัตราคงที่</p>
<p>&nbsp;</p>
<hr />
<h2 id="platformio-cli">&#9655; <strong>ตัวอย่างคำสั่ง PlatformIO CLI</strong><a class="headerlink" href="#platformio-cli" title="Permanent link">#</a></h2>
<p><strong>PlatformIO Core</strong> รองรับการทำคำสั่งแบบ <strong>CLI (Command Line Interface)</strong>
ตามรูปแบบที่ได้มีการเขียนอธิบายไว้ในเอกสารออนไลน์ <a href="https://docs.platformio.org/en/stable/core/quickstart.html"><strong>Platform CLI - QuickStart Guide</strong></a></p>
<p>สำหรับผู้ใช้ระบบปฏิบัติการ <strong>Windows</strong> เพื่อให้สามารถเรียกใช้คำสั่ง <code>pio.exe</code> ได้ใน <strong>PowerShell</strong>
จะต้องไปเพิ่มรายการสำหรับตัวแปรของระบบ (<strong>Environment Variable</strong>) ที่มีชื่อว่า <code>PATH</code> 
โดยใช้ชื่อไดเรกทอรีต่อไปนี้</p>
<p><code>C:\Users\%USERNAME%\.platformio\penv\Scripts\</code></p>
<p>แต่จะต้องแทนที่ <code>%USERNAME%</code> ด้วยชื่อบัญชีของผู้ใช้ (<strong>User Account Name</strong>)</p>
<p>&nbsp;</p>
<p>เปิดใช้งาน <strong>Windows Powershell</strong> แล้วลองทำคำสั่งต่อไปนี้ </p>
<p>1) ตรวจสอบเวอร์ชันของ <strong>PIO</strong> (ในบทความนี้ ได้ทดลองใช้ <strong>PlatformIO Core v5.2.5</strong>)</p>
<pre><code># show the version of the Platformio core
pio --version
</code></pre>
<p>2) ดูรายการ <strong>Platforms</strong> ที่ได้มีการติดตั้งไว้ใช้งานแล้วสำหรับ <strong>PlatformIO</strong></p>
<pre><code># list all installed platforms
pio platform list
</code></pre>
<p>หรือระบุชื่อ เช่น <code>espressif</code> สำหรับการค้นหา  เป็นต้น</p>
<pre><code># search platform by a specific name
pio platform search 'espressif'
</code></pre>
<p>3) ดูรายการ <strong>Frameworks</strong> ที่เป็นตัวเลือกสำหรับการเขียนโค้ด</p>
<pre><code># list all supported frameworks
pio platform frameworks
</code></pre>
<p>4) แสดงรายการชื่อบอร์ดไมโครคอนโทรลเลอร์ โดยค้นหาตามชื่อที่ระบุ เช่น
<code>arduino</code>, <code>esp32</code>, <code>esp32s2</code>, <code>stm32</code> เป็นต้น</p>
<pre><code># search all supported boards by a specific name (e.g. 'esp32')
pio boards 'esp32'
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="platformio-cli_1">&#9655; <strong>การสร้างโปรเจกต์และคอมไพล์โค้ดด้วย PlatformIO CLI</strong><a class="headerlink" href="#platformio-cli_1" title="Permanent link">#</a></h2>
<p>เปิดใช้งาน <strong>Windows Powershell</strong> แล้วทำคำสั่งต่อไปนี้ </p>
<p>1) สร้างโปรเจกต์ใหม่ เช่น ใช้ชื่อว่า <code>esp32_demo</code> 
และเลือกใช้บอร์ด <strong>WEMOS Lolin32 Lite</strong> เป็นตัวอย่างเพื่อสาธิตใช้งาน
(ระบุชื่อของบอร์ดหรือ <strong>Board Identifier</strong> เป็น <code>lolin32_lite</code>)</p>
<pre><code># create a new directory
mkdir './esp32_pio_demo'
# change to the new directory
cd './esp32_pio_demo'
# initialize the new project
pio project init -b &quot;lolin32_lite&quot; --ide &quot;vscode&quot;
</code></pre>
<p>เมื่อทำคำสั่งตามลำดับแล้ว จะมีการสร้างไฟล์ <code>platformio.ini</code> และไดเรกทอรีใหม่ เช่น
<code>src</code>, <code>lib</code>, <code>include</code> ภายใต้ไดเรกทอรีของโปรเจกต์</p>
<p>&nbsp;</p>
<p>2) ตรวจสอบการตั้งค่าตัวเลือกเริ่มต้นสำหรับโปรเจกต์ที่มีอยู่ในไฟล์ <code>platformio.ini</code></p>
<pre><code># show the project's current configuration data
pio project config
</code></pre>
<p>ถัดไปลองมาดูตัวอย่างการทำคำสั่งในสองขั้นตอนแรก และข้อความเอาต์พุตที่ปรากฏ</p>
<p><img alt="" src="pio_cli_demo-1.png" /></p>
<p>รูป: การทำคำสั่งด้วย <code>pio</code> เพื่อสร้างโปรเจกต์ใหม่</p>
<p>เมื่อถึงขั้นตอนนี้ ผู้ใช้สามารถเปิดโปรเจกต์ใน <strong>VS Code IDE</strong> ได้ โดยทำคำสั่งต่อไปนี้</p>
<pre><code>code .
</code></pre>
<p><img alt="" src="pio_cli_demo-2.png" /></p>
<p>รูป: การเปิดโปรเจกต์ที่มีชื่อว่า <code>esp32_demo</code> ใน <strong>VS Code IDE</strong></p>
<p>&nbsp;</p>
<p>3) สร้างไฟล์ใหม่ที่มีชื่อว่า <code>src/main.cpp</code> ให้เป็นส่วนหนึ่งของโปรเจกต์ และเขียนโค้ด 
<strong>Arduino Sketch</strong> </p>
<p><img alt="" src="pio_cli_demo-3.png" /></p>
<p>รูป: การสร้างไฟล์ <code>src/main.cpp</code> และเขียนโค้ดตัวอย่าง</p>
<p>&nbsp;</p>
<p>4) ทำคำสั่งเพื่อคอมไพล์โค้ดของโปรเจกต์ (ทำขั้นตอน <strong>Build</strong>) เพื่อให้ได้ไฟล์ <code>firmware.elf</code> 
และ <code>firmware.bin</code></p>
<pre><code># start the build process to generate firmware files
pio run -e 'lolin32_lite' 
</code></pre>
<p><code>-e</code> เป็นการเจาะจง <strong>Environment Name</strong> เพื่อใช้ในการคอมไพล์โค้ดของโปรเจกต์
ซึ่งในตัวอย่างนี้มีชื่อว่า <code>lolin32_lite</code></p>
<p>แต่ถ้าต้องการคอมไพล์ทุกไฟล์ในโปรเจกต์ใหม่ทั้งหมด ให้ทำคำสั่งต่อไปนี้ ตามลำดับ</p>
<pre><code># clean the project's build directory
pio run -e 'lolin32_lite' -t clean
# rebuild the project
pio run -e 'lolin32_lite'
</code></pre>
<p>&nbsp;</p>
<p>5) ตรวจสอบรายการบอร์ดไมโครคอนโทรลเลอร์ที่เชื่อมต่อกับเครื่องผู้ใช้</p>
<pre><code># detect the target board
pio device list
</code></pre>
<p>&nbsp;</p>
<p>6) ทำคำสั่งเพื่ออัปโหลดไฟล์ <code>firmware.bin</code> ไปยังบอร์ด <strong>ESP32</strong></p>
<pre><code># upload firmware to the target board
pio run -e &quot;lolin32_lite&quot; -t upload --upload-port COM5
</code></pre>
<p>&nbsp;</p>
<p>7) เปิดใช้งาน <strong>Serial Monitor</strong> เพื่อรับข้อความจากบอร์ด</p>
<pre><code>pio device monitor --port COM5 --baud 115200
</code></pre>
<p><img alt="" src="pio_cli_demo-4.png" /></p>
<p>รูป: การอัปโหลดไฟล์ <strong>Firmware</strong> ไปยังบอร์ด <strong>ESP32</strong></p>
<p>&nbsp;</p>
<p><strong>ข้อสังเกต:</strong> การใช้คำสั่งของ <strong>PlatformIO CLI</strong> สำหรับผู้ใช้ทั่วไปอาจจะไม่จำเป็น
เมื่อเปรียบเทียบกับการใช้ <strong>VS Code IDE + PlatformIO extension</strong>
แต่การทำคำสั่งแบบ <strong>CLI</strong> เหมาะสำหรับการทำขั้นตอน <strong>Automated Build Process</strong>
เช่น มีการตั้งค่าใช้งานและนำไปทดสอบสำหรับบอร์ดหลายรูปแบบ มีการใช้งานในลักษณะเช่นเดียวกับซอฟต์แวร์ 
<a href="https://arduino.github.io/arduino-cli/latest/getting-started/"><strong>Arduino CLI</strong></a> </p>
<p>&nbsp;</p>
<hr />
<h2 id="arduino-library">&#9655; <strong>การใช้งาน Arduino Library</strong><a class="headerlink" href="#arduino-library" title="Permanent link">#</a></h2>
<p>ถัดไปเป็นการสาธิตการใช้งานไลบรารีสำหรับการเขียนโค้ด <strong>Arduino</strong> 
และในปัจจุบันก็มีไลบรารีจำนวนมากที่สามารถนำมาใช้ได้กับ <strong>ESP32</strong></p>
<p>ในส่วนนี้จะสาธิตการใช้งานไลบรารีที่มีชื่อว่า <a href="https://github.com/FastLED/FastLED"><strong>FastLED</strong></a> เพื่อกำหนดสีของหลอด <strong>RGB LED</strong> ที่ใช้ชิป <strong>WS2812B (NeoPixel)</strong> เป็นตัวควบคุม และใช้สายสัญญาณข้อมูลเพียงเส้นเดียว</p>
<p>โค้ดตัวอย่างนี้ได้เลือกใช้ขา <strong>GPIO-19</strong> ของ <strong>ESP32</strong> เป็นขาเอาต์พุต เพื่อส่งสัญญาณควบคุมไปยังโมดูล 
<strong>8-Pixel WS2818B LED Strip</strong> ซึ่งมีจำนวน 8 พิกเซล หรือมี <strong>RGB LED</strong> จำนวน 8 ดวง</p>
<p>เมื่อเริ่มทำงาน โปรแกรมจะทำให้ <strong>LED</strong> ในหนึ่งตำแหน่งเปลี่ยนเป็นสีแดง (ตั้งระดับความสว่างไว้คงที่) 
และในตำแหน่งอื่นจะไม่สว่าง (<strong>OFF</strong>) จากนั้นจะเลื่อนตำแหน่งของ <strong>LED</strong> ที่มีสีแดง ไปตามลำดับ จนครบ 8 ดวง
(<code>NUM_LEDS</code> เท่ากับ 8) แล้ววนซ้ำไปเรื่อย ๆ</p>
<pre><code class="language-c++">#include &lt;Arduino.h&gt;
#include &lt;FastLED.h&gt; // include the FastLED library
// see: https://github.com/FastLED/FastLED

#define LED_PIN      19  // select GPIO-19 pin for WS2812 LED strip
#define NUM_LEDS     8   // 8 pixels 
#define COLOR_ORDER  GRB
#define CHIPSET      WS2812B

CRGB leds[NUM_LEDS]; // used to store the RGB values
int level = 50;      // set the brightness level: 0..255

void setup() {
  // set brightness level
  FastLED.setBrightness( level );
  FastLED.addLeds&lt;CHIPSET, LED_PIN, COLOR_ORDER&gt;(leds, NUM_LEDS);
  leds[NUM_LEDS-1] = CRGB::Red; // set color to red
  for ( int i=0; i &lt; NUM_LEDS-1; i++ ) {
     leds[i] = CRGB::Black;  // turn LED off
  }
  FastLED.show(); // display this frame
  delay(1000);
}

void loop() {
  // rotate the color position
  CRGB color = leds[0];
  for ( int i=0; i &lt; NUM_LEDS-1; i++ ) {
     leds[i] = leds[i+1]; 
  }
  leds[NUM_LEDS-1] = color;
  FastLED.show(); // update LED colors
  delay(200);
}
</code></pre>
<p>ก่อนที่จะทำขั้นตอน <strong>Build</strong> ให้แก้ไขไฟล์ <code>platformio.ini</code> เพื่อระบุว่า 
ต้องการจะใช้หรือนำเข้าไลบารีใดบ้างในส่วนที่เรียกว่า <code>lib_deps</code> (<strong>Library Dependencies</strong>) 
และในตัวอย่างนี้ ได้ระบุชื่อไลบรารีเป็น <code>FastLED/FastLED</code> (อ้างอิงตามชื่อใน <strong>Github repository</strong>
ของไลบรารีนี้ <a href="https://github.com/FastLED/FastLED/">https://github.com/FastLED/FastLED/</a>)
 และระบุตัวเลขเวอร์ชันของไลบรารีด้วย เช่น เวอร์ชัน <strong>3.5.0</strong> หรือสูงกว่า</p>
<pre><code>[env:lolin32_lite]
platform = espressif32
board = lolin32_lite
framework = arduino
upload_speed = 921600
monitor_speed = 115200
upload_port = COM5
lib_deps =
  FastLED/FastLED @ ^3.5.0
</code></pre>
<p><img alt="" src="esp32_neopixel.png" /></p>
<p>รูป: การต่อวงจรเชื่อมต่อระหว่างบอร์ด <strong>WEMOS LOLIIN32 Lite</strong> และโมดูล <strong>NeoPixel</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="_2">&#9655; <strong>บทความที่เกี่ยวข้อง</strong><a class="headerlink" href="#_2" title="Permanent link">#</a></h2>
<ul>
<li><a href="../../arduino/vscode_pio_arduino/">การใช้งาน <strong>VS Code IDE + PlatformIO</strong> สำหรับบอร์ด <strong>Arduino (AVR)</strong></a></li>
<li><a href="../../arduino/vscode_pio_arduino_stm32/">การเขียนโปรแกรมด้วย <strong>Arduino</strong> และ <strong>VS Code IDE + PlatformIO</strong> สำหรับบอร์ด <strong>STM32</strong></a></li>
</ul>
<hr />
<h2 id="_3">&#9655; <strong>กล่าวสรุป</strong><a class="headerlink" href="#_3" title="Permanent link">#</a></h2>
<p>บทความนี้นำเสนอขั้นตอนการติดตั้งและใช้งาน <strong>PlatformIO Extension</strong>
สำหรับ <strong>Microsoft VS Code IDE (for Windows)</strong> เพื่อสาธิตการเขียนโค้ด
<strong>Arduino Sketch</strong> สำหรับบอร์ดไมโครคอนโทรลเลอร์ <strong>ESP32</strong></p>
<p>&nbsp;</p>
<hr />
<p>This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.</p>
<p>Created: 2022-05-16 | Last Updated: 2022-05-17</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021-2022 IoT Engineering Education, Bangkok/Thailand</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
