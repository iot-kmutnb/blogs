<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="RSP">
        <link rel="canonical" href="http://iot-kmutnb.github.com/blogs/esp32/arduino-esp32-wokwi-part2/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>การเขียนโปรแกรมไมโครคอนโทรลเลอร์ Arduino-ESP32 ด้วย Wokwi Simulator (ตอนที่ 2) - IoT Engineering Education</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../../css/extra.css" rel="stylesheet">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/arduino.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/vhdl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/verilog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/text.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/matlab.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/julia.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-966FQ6RN6W"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-966FQ6RN6W');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">IoT Engineering Education</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#arduino-esp32-wokwi-simulator-2" class="nav-link">การเขียนโปรแกรมไมโครคอนโทรลเลอร์ Arduino-ESP32 ด้วย Wokwi Simulator (ตอนที่ 2)</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#wokwi-electronic-components" class="nav-link">&#9655; Wokwi - Electronic Components</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#led-push-button" class="nav-link">&#9655; LED + Push Button</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1" class="nav-link">&#9655; โจทย์ฝึกปฏิบัติข้อที่ 1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2" class="nav-link">&#9655; โจทย์ฝึกปฏิบัติข้อที่ 2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#_1" class="nav-link">&#9655; กล่าวสรุป</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="arduino-esp32-wokwi-simulator-2">การเขียนโปรแกรมไมโครคอนโทรลเลอร์ Arduino-ESP32 ด้วย Wokwi Simulator (ตอนที่ 2)<a class="headerlink" href="#arduino-esp32-wokwi-simulator-2" title="Permanent link">#</a></h1>
<hr />
<h2 id="wokwi-electronic-components">&#9655; <strong>Wokwi - Electronic Components</strong><a class="headerlink" href="#wokwi-electronic-components" title="Permanent link">#</a></h2>
<p>บทความนี้นำเสนอซอฟต์แวร์ <strong>Wokwi Online Simulator</strong>
สำหรับการเขียนโค้ดด้วยภาษา <strong>C/C++</strong> 
และสร้างวงจรเสมือนจริงที่มีบอร์ดไมโครคอนโทรลเลอร์ <strong>ESP32</strong> และอุปกรณ์อิเล็กทรอนิกส์พื้นฐานต่าง ๆ</p>
<p>นอกจากบอร์ดไมโครคอนโทรลเลอร์ที่มีให้เลือกใช้งานได้หลายแบบแล้ว
ยังมีรายการอุปกรณ์ชิ้นส่วนหรือโมดูลอิเล็กทรอนิกส์อีกหลายประเภท ให้เลือกใช้งานได้
และนำมาต่อวงจรเสมือนจริง</p>
<p><img alt="" src="wowki_esp32.png" /></p>
<p>รูป: เริ่มต้นโปรเจกต์ใหม่ใน <strong>Wokwi Online Simulator</strong> โดยเลือกใช้บอร์ด <strong>ESP32</strong> </p>
<p>ถ้าต้องการเพิ่มอุปกรณ์อิเล็กทรอนิกส์จากรายการ เพื่อนำมาต่อใช้งานเสมือนจริงกับบอร์ด
<strong>ESP32</strong> ก็ให้กดปุ่ม <strong>(+)</strong> เพื่อเลือกอุปกรณ์</p>
<p><img alt="" src="wokwi_add_components.png" /></p>
<p>รูป: รายการอุปกรณ์อิเล็กทรอนิกส์ใน <strong>Wokwi Online Simulator</strong></p>
<p><img alt="" src="wokwi_components_list.png" /></p>
<p>รูป: รายการอุปกรณ์อิเล็กทรอนิกส์ที่สามารถเลือกใช้ได้</p>
<p><strong>ข้อสังเกต:</strong> แม้ว่า <strong>Wokwi Simulator</strong> สามารถจำลองการทำงานของวงจรอิเล็กทรอนิกส์ได้ 
แต่มีข้อจำกัดในการจำลองการทำงานของวงจรอิเล็กทรอนิกส์แบบแอนะล็อก 
(เนื่องจากไม่ได้ใช้ตัวจำลองการทำงานของวงจรด้วย <strong>SPICE Circuit Simulator</strong>)</p>
<p>&nbsp;</p>
<hr />
<h2 id="led-push-button">&#9655; <strong>LED + Push Button</strong><a class="headerlink" href="#led-push-button" title="Permanent link">#</a></h2>
<p>ถัดไปลองมาดูตัวอย่างการต่อวงจร <strong>LED</strong> และปุ่มกด (<strong>Push Button</strong>) พร้อมตัวต้านทาน 
เพื่อใช้งานร่วมกับบอร์ด <strong>ESP32</strong></p>
<p><img alt="" src="wokwi_esp32_led_button_resistors-1.png" /></p>
<p>รูป: ตัวอย่างการเลือกอุปกรณ์มาต่อวงจรร่วมกับบอร์ด <strong>ESP32</strong></p>
<p>ถ้าหากดูรายการในไฟล์ <code>diagram.json</code> ของโปรเจกต์ ในส่วนที่เรียกว่า
<code>"parts": [ ... ]</code> จะเห็นรายการอุปกรณ์ที่ได้เลือกมาต่อวงจร
ซึ่งภายในเป็นข้อความแบบ <strong>JSON String Format</strong></p>
<p>จากรูปตัวอย่าง อุปกรณ์ <code>"wokwi-led"</code> มี <code>"id"</code> (<strong>Instance ID</strong>) 
เท่ากับ <code>"led1"</code> มีพิกัดหรือตำแหน่งสำหรับการวาดรูป <code>"top"</code> และ <code>"left"</code>
ในบริเวณที่เป็น <strong>Drawing Canvas</strong>
และมี <code>"attrs"</code> สำหรับรายการคุณสมบัติของอุปกรณ์ เช่น <code>"color"</code> ที่มีค่าเท่ากับ
<code>"red"</code> ซึ่งหมายถึง หลอดแอลอีดี (5mm.) มีสีแดง เป็นต้น</p>
<p>อุปกรณ์ <code>"wokwi-pushbutton"</code> มี <code>"id"</code> (<strong>Instance ID</strong>) 
เท่ากับ <code>"btn1"</code> มีพิกัดหรือตำแหน่งสำหรับการวาดรูปในบริเวณที่เป็น <strong>Drawing Canvas</strong> 
ที่ถูกกำหนดโดย <code>"top"</code> และ <code>"left"</code> และมี <code>"attrs"</code>
สำหรับรายการคุณสมบัติเฉพาะสำหรับแต่ละอุปกรณ์
เช่น <code>"color"</code> ที่มีค่าเท่ากับ
<code>"green"</code> ซึ่งหมายถึง ปุ่มกด (<strong>12mm. Tactile Switch</strong>) มีสีเขียว เป็นต้น</p>
<pre><code class="language-json">{
      &quot;type&quot;: &quot;wokwi-led&quot;,
      &quot;id&quot;: &quot;led1&quot;,
      &quot;top&quot;: -64.48,
      &quot;left&quot;: -162.47,
      &quot;attrs&quot;: { &quot;color&quot;: &quot;red&quot; }
},
{
      &quot;type&quot;: &quot;wokwi-pushbutton&quot;,
      &quot;id&quot;: &quot;btn1&quot;,
      &quot;top&quot;: 17.96,
      &quot;left&quot;: -177.91,
      &quot;attrs&quot;: { &quot;color&quot;: &quot;green&quot; }
},
</code></pre>
<p>&nbsp;</p>
<p>นอกจากนั้นยังมีตัวต้านทาน <code>"wokwi-resistor"</code> อีกสองตัว ได้แก่
<code>"id"</code> เท่ากับ <code>"r1"</code> และ <code>"r2"</code> ตามลำดับ
และมีการกำหนดค่าให้สำหรับ <code>"value"</code> เท่ากับ <code>"1000"</code> (โอห์ม) ซึ่งจะใช้เป็นตัวต้านทานจำกัดกระแสสำหรับ <strong>LED</strong>
และ  <code>"10000"</code> (โอห์ม) ซึ่งจะใช้สำหรับเป็นตัวต้านทานแบบ <strong>Pullup</strong> สำหรับปุ่มกด 
และมีการหมุน <code>"rotate"</code> เป็นองศาเท่ากับ <code>0</code> และ <code>90</code> ตามลำดับ </p>
<pre><code class="language-json">{
      &quot;type&quot;: &quot;wokwi-resistor&quot;,
      &quot;id&quot;: &quot;r1&quot;,
      &quot;top&quot;: -39.15,
      &quot;left&quot;: -92.53,
      &quot;rotate&quot;: 0,
      &quot;attrs&quot;: { &quot;value&quot;: &quot;1000&quot; }
},
{
      &quot;type&quot;: &quot;wokwi-resistor&quot;,
      &quot;id&quot;: &quot;r2&quot;,
      &quot;rotate&quot;: 90,
      &quot;top&quot;: 36.33,
      &quot;left&quot;: -86.46,
      &quot;attrs&quot;: { &quot;value&quot;: &quot;10000&quot; }
}
</code></pre>
<p>รายละเอียดเพิ่มเติมสำหรับการใช้งานอุปกรณ์ทั้งสามประเภท สามารถดูได้จาก</p>
<ul>
<li><a href="https://docs.wokwi.com/parts/wokwi-led"><strong>"wokwi-led" Reference</strong></a></li>
<li><a href="https://docs.wokwi.com/parts/wokwi-pushbutton"><strong>"wokwi-pushbutton" Reference</strong></a></li>
<li><a href="https://docs.wokwi.com/parts/wokwi-resistor"><strong>"wokwi-resistor" Reference</strong></a></li>
</ul>
<p>เมื่อได้เลือกอุปกรณ์ต่าง ๆ มาวางในพื้นที่วาดรูปวงจรแล้ว ถัดไปเป็นการลากสายสัญญาณหรือสายไฟ
เพื่อเชื่อมต่อขาของอุปกรณ์ให้เป็นวงจรที่ถูกต้อง ใช้เมาส์คลิกเลือกขาที่เป็นจุดเริ่มต้นแล้วเลื่อนไปยังตำแหน่งของ
ขาของอุปกรณ์ปลายทาง ตามรูปตัวอย่างดังนี้</p>
<p><img alt="" src="wokwi_esp32_led_button_resistors-2.png" /></p>
<p>รูป: ตัวอย่างการเชื่อมต่อขาของอุปกรณ์ต่าง ๆ ให้เป็นวงจร (<strong>Wiring</strong>)</p>
<p>ถ้าลองดูในไฟล์ <code>diagram.json</code> ของโปรเจกต์ จะเห็นว่า มีส่วนที่มีชื่อว่า  <code>"connections"</code> 
ซึ่งมีข้อความตามตัวอย่างดังนี้</p>
<pre><code class="language-json">{
 &quot;connections&quot;: [
    [ &quot;esp:TX0&quot;, &quot;$serialMonitor:RX&quot;, &quot;&quot;, [] ],
    [ &quot;esp:RX0&quot;, &quot;$serialMonitor:TX&quot;, &quot;&quot;, [] ],
    [ &quot;esp:D4&quot;, &quot;led1:A&quot;, &quot;green&quot;, [ &quot;h159.26&quot;, &quot;v58.52&quot;, &quot;h-26.45&quot; ] ],
    [ &quot;led1:C&quot;, &quot;r1:2&quot;, &quot;green&quot;, [ &quot;v0&quot; ] ],
    [ &quot;r1:1&quot;, &quot;esp:GND.1&quot;, &quot;black&quot;, [ &quot;v0.69&quot;, &quot;h-16.83&quot;, &quot;v-30.14&quot; ] ],
    [ &quot;esp:3V3&quot;, &quot;r2:1&quot;, &quot;red&quot;, [ &quot;v-0.07&quot;, &quot;h19.89&quot;, &quot;v42.06&quot;, &quot;h188.97&quot;, &quot;v-200.9&quot; ] ],
    [ &quot;r2:2&quot;, &quot;btn1:1.l&quot;, &quot;green&quot;, [ &quot;v0.69&quot;, &quot;h-15.8&quot; ] ],
    [ &quot;btn1:2.r&quot;, &quot;esp:GND.1&quot;, &quot;black&quot;, [ &quot;v0&quot; ] ],
    [ &quot;esp:D5&quot;, &quot;btn1:1.l&quot;, &quot;green&quot;, [ &quot;h68.23&quot;, &quot;v-92.96&quot;, &quot;h-1.88&quot; ] ]
  ]
}
</code></pre>
<p>เมื่อต่อวงจรได้ครบถ้วนแล้ว ถัดไปลองเขียนโค้ดตามตัวอย่างต่อไปนี้ โดยมีขั้นตอนการทำงานดังนี้</p>
<ul>
<li>ขา <strong>LED_PIN</strong> และ <strong>BTN_PIN</strong> เป็นขา <strong>4</strong> (<strong>D4</strong>) และ <strong>5</strong> (<strong>D5</strong>) บนบอร์ด <strong>ESP32</strong></li>
<li>คำสั่ง <code>pinMode( LED_PIN, OUTPUT );</code> ทำให้ขา <code>LED_PIN</code> เป็นเอาต์พุตแบบดิจิทัล</li>
<li>คำสั่ง <code>pinMode( BTN_PIN, INPUT  );</code> ทำให้ขา <code>BTN_PIN</code> เป็นขาอินพุตแบบดิจิทัล</li>
<li>คำสั่ง <code>digitalWrite( LED_PIN, !digitalRead( BTN_PIN) );</code>
ทำหน้าที่คอยอ่านค่าลอจิกจากขา <code>BTN_PIN</code> เป็นอินพุต
เมื่อได้ค่ามาแล้ว ก็นำมากลับค่าลอจิก ก่อนนำไปใช้กำหนดค่าลอจิกที่ขา <code>LED_PIN</code> เป็นเอาต์พุต
ประโยคคำสั่งนี้อยู่ในฟังก์ชัน <code>loop()</code> ดังนั้นจึงมีการทำซ้ำไปเรื่อย ๆ โดยเว้นระยะเวลา
10 มิลลิวินาที ด้วยคำสั่ง <code>delay(10);</code> ก่อนทำซ้ำในแต่ละครั้ง</li>
</ul>
<p>เอกสารสำหรับคำสั่งและการเขียนโค้ด <strong>Arduino</strong> สำหรับ <strong>ESP32</strong> สามารถศึกษาได้จาก: 
<a href="https://espressif-docs.readthedocs-hosted.com/projects/arduino-esp32/en/latest/index.html">"<strong>ESP32 Arduino Core’s documentation</strong>"</a>
และ <a href="https://docs.wokwi.com/guides/esp32">"<strong>Wokwi - ESP32 Simulation Guide</strong>"</a></p>
<pre><code>const int LED_PIN = 4; // D4 pin
const int BTN_PIN = 5; // D5 pin

void setup() {
  Serial.begin(115200);
  pinMode( LED_PIN, OUTPUT );
  pinMode( BTN_PIN, INPUT  );
}

void loop() {
  // Read the input value from the button pin,
  // write the inverted input value to the output LED pin.
  digitalWrite( LED_PIN, !digitalRead( BTN_PIN) );
  delay(10);
}
</code></pre>
<p><img alt="" src="wokwi_esp32_led_button_resistors-3.png" /></p>
<p>รูป: การจำลองการทำงานของวงจรและโค้ดที่ได้เขียนไว้</p>
<p>โดยทั่วไปแล้ว วงจรภายในไมโครคอนโทรลเลอร์ สำหรับแต่ละขาของ <strong>GPIO</strong> (<em>General-Purpose I/O</em>) 
มีตัวต้านทานอยู่ภายใน สามารถเลือกใช้งานเป็นตัวต้านทานแบบ <strong>Pullup</strong> ได้ ดังนั้นถ้าใช้ตัวต้านทานภายใน
ก็ไม่จำเป็นต้องต่อตัวต้านทานภายนอก แต่จะต้องใช้คำสั่งของ <strong>Arduino</strong> ดังนี้สำหรับการเขียนโค้ด</p>
<p>คำสั่งนี้ใช้งานขา <strong>GPIO</strong> ตามที่กำหนด เป็นขาอินพุตแบบดิจิทัล แต่ไม่ใช้ตัวต้านทานภายใน
ดังนั้นต้องต่อตัวต้านทานภายนอก (<strong>External Pullup</strong>)</p>
<p><code>pinMode( BTN_PIN, INPUT );</code></p>
<p>คำสั่งนี้ใช้งานขา <strong>GPIO</strong> ตามที่กำหนด เป็นขาอินพุตแบบดิจิทัล แต่เปิดใช้งานตัวต้านทานภายในแบบ <strong>Internal Pullup</strong></p>
<p><code>pinMode( BTN_PIN, INPUT_PULLUP );</code></p>
<p>หากลองแก้ไขวงจรใหม่ โดยไม่ใช้ตัวต้านทาน <strong>Pullup</strong> ที่ขาสำหรับปุ่มกด
และลองปรับเปลี่ยนรูปแบบการเขียนใหม่ 
เช่น ให้มีการแสดงข้อความเมื่อสถานะหรือค่าลอจิกของอินพุตมีการเปลี่ยนแปลง ก็มีแนวทางตามตัวอย่างดังนี้</p>
<pre><code>const int LED_PIN = 4;
const int BTN_PIN = 5;

void setup() {
  Serial.begin(115200);
  pinMode( LED_PIN, OUTPUT );
  // Use the internal pullup resistor on GPIO pin.
  pinMode( BTN_PIN, INPUT_PULLUP );
}

int saved_value = HIGH; // Used to save the last changed value.

void loop() {
  // Read the input value from the button pin.
  int value = digitalRead( BTN_PIN );
  if ( saved_value != value ) {
    // Show the input value.
    Serial.printf( &quot;Input value changed: %d\n&quot;, value );
    // Save the new input value.
    saved_value = value;
  }
  // Write the inverted input value to the output LED pin.
  digitalWrite( LED_PIN, !value );
  delay(10);
}
</code></pre>
<p><img alt="" src="wokwi_esp32_led_button_resistors-4.png" /></p>
<p>รูป: การแก้ไขวงจรและโค้ดตัวอย่าง</p>
<p>อีกแนวทางหนึ่งในการเขียนโค้ดคือ การเปิดใช้งานอินเทอร์รัพท์ภายนอก (<strong>External Interrupt</strong>) ที่ขาอินพุต
โดยใช้คำสั่ง <a href="https://www.arduino.cc/reference/en/language/functions/external-interrupts/attachinterrupt/"><code>attachInterrupt(...)</code></a>
ของ <strong>Arduino API</strong> ซึ่งสามารถนำมาใช้ได้กับ <strong>Arduino-ESP32</strong></p>
<p>ในตัวอย่างโค้ดต่อไปนี้ ถ้ามีการเปลี่ยนแปลงสถานะลอจิก (<strong>Change</strong>) ที่ขาอินพุต <code>I0</code> หรือ <code>I1</code> ได้ทั้งสองกรณีคือ 
ขอบขาขึ้น (<strong>Rising Edge</strong>) และขอบขาลง (<strong>Falling Edge </strong>)
จะถือว่า มีเหตุการณ์ที่เป็นอินเทอร์รัพท์จากภายนอก และจะทำให้ฟังก์ชันที่ทำหน้าที่ตอบสนองต่อเหตุการณ์ดังกล่าว
ซึ่งในตัวอย่างคือ ฟังก์ชัน <code>isr()</code> ทำงานโดยอัตโนมัติ เพื่ออ่านค่าอินพุตของขา <code>I0</code> และ <code>I1</code> และอัปเดทค่าของเอาต์พุต <code>O</code></p>
<pre><code>const int LED_PIN = 4;
const int BTN_PIN = 5;

void isr() {
  int value = digitalRead( BTN_PIN );
  digitalWrite( LED_PIN, !value );
}

void setup() {
  Serial.begin(115200);
  pinMode( LED_PIN, OUTPUT );
  // Use the  internal pullup resistor on GPIO pin.
  pinMode( BTN_PIN, INPUT_PULLUP );
  attachInterrupt( digitalPinToInterrupt(BTN_PIN), 
                   isr, CHANGE /* Any change */ );
}

void loop() {}
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="1">&#9655; <strong>โจทย์ฝึกปฏิบัติข้อที่ 1</strong><a class="headerlink" href="#1" title="Permanent link">#</a></h2>
<p>การสร้างสัญญาณเอาต์พุตดิจิทัลที่เปลี่ยนสถานะลอจิกตามสัญญาณอินพุต</p>
<ol>
<li>เลือกใช้ขาดิจิทัลของบอร์ดไมโครคอนโทรลเลอร์ <strong>ESP32</strong> ตามความเหมาะสม ใช้ 2 ขา โดยให้ขาที่หนึ่งเป็นอินพุตและ
ขาที่สองเป็นเอาต์พุต อ้างอิงชื่อเป็น <code>DIN</code> (<strong>Digital Input</strong>) และ <code>DOUT</code> (<strong>Digital Output</strong>) ตามลําดับ</li>
<li>เขียนโปรแกรม <strong>Arduino Sketch</strong> ให้มีพฤติกรรมการทํางานดังนี้<ul>
<li>ถ้า <code>DIN</code> มีการเปลี่ยนแปลงสถานะลอจิก เช่น เกิดจากการกดปุ่มแล้วปล่อย จะทําให้เปลี่ยนสถานะจาก
<strong>HIGH</strong> เป็น <strong>LOW</strong> และ <strong>LOW</strong> เป็น <strong>HIGH</strong> ตามลําดับ 
ดังนั้นให้สัญญาณที่ขา <code>DOUT</code> เปลี่ยนแปลงค่าลอจิกตาม <code>DIN</code> <em>โดยใช้เวลาให้น้อยที่สุด</em> ดังนั้นหลีกเลี่ยงการใช้คำสั่งที่ไม่จำเป็น
(ให้ตรวจสอบระยะเวลาที่เกิดขึ้นกับสัญญาณ โดยใช้เครื่องออสซิลโลสโคป เปรียบเทียบกับผลการทดลองเสมือนจริงด้วย <strong>Wokwi Simulator</strong>)</li>
<li>หากไม่มีการเปลี่ยนแปลงที่ขา <code>DIN</code> ให้ทั้งสองสัญญาณ มีสถานะลอจิกเหมือนกัน</li>
</ul>
</li>
<li>วัดสัญญาณ <code>DIN</code> และ <code>DOUT</code> พร้อมกัน ด้วยเครื่องออสซิลโลสโคป (ช่อง <code>CH1</code> และ <code>CH2</code> ตามลําดับ) และ
บันทึกรูปคลื่นสัญญาณ</li>
<li>วัดค่า <strong>Delay Time</strong> ระหว่างสองสัญญาณ นับจากตําแหน่งขอบขาขึ้น หรือ ขอบขาลงของสัญญาณ เช่น ถ้ามี
การเปลี่ยนแปลงขอบขาขึ้น (หรือขาลง) ที่ <code>DIN</code> สัญญาณ <code>DOUT</code> จะต้องมีการเปลี่ยนแปลงเช่นกัน และเกิดขอบขาขึ้น (หรือขาลง) ตามมา</li>
</ol>
<p><strong>คําแนะนํา</strong></p>
<ul>
<li>ในการต่อวงจรปุ่มกดบนเบรดบอร์ด เพื่อใช้งานเป็นอินพุตแบบดิจิทัล ให้ต่อวงจรปุ่มกดแบบ <strong>Active-Low</strong>
(เมื่อกดปุ่มได้ลอจิก 0 และปล่อยปุ่มได้ลอจิก 1) และแนะนําให้เปิดใช้งานตัวต้านทาน <strong>Pull-Up</strong> ที่ขา <strong>I/O</strong>
สําหรับอินพุตภายในชิปไมโครคอนโทรลเลอร์ โดยสามารถใช้คําสั่ง <code>pinMode()</code> ของ <strong>Arduino API</strong> และ
กําหนดตัวเลือกให้เป็น <code>INPUT_PULLUP</code></li>
<li>ใช้คำสั่ง <code>digitalRead(...)</code> และ <code>digitalWrite(...)</code> เพื่ออ่านค่าอินพุตและเขียนค่าเอาต์พุตสำหรับขา
<strong>GPIO</strong> ที่ได้เลือกใช้งานตามลำดับ</li>
<li>การต่อใช้งานปุ่มกด <a href="https://docs.wokwi.com/parts/wokwi-pushbutton"><strong>Push Button</strong></a> 
และจำลองการทำงานใน <strong>Wokwi Simulator</strong> แนะนำให้เพิ่มการตั้งค่าของปุ่มกดในไฟล์ <code>diagram.json</code> 
ดังนี้: <code>{ "bounce": "0" }</code> เพื่อปิดการกระเด้งของปุ่มกด (<strong>Disable Bouncing Simulation</strong>)</li>
<li>การวัดสัญญาณที่ขา <strong>GPIO</strong> ของ <strong>ESP32</strong> และหาค่า <strong>Delay</strong>
สามารถใช้ <strong>Virtual Logic Analyzer (8-channel)</strong> มาต่อในวงจร 
และเมื่อจำลองการทำงาน จะได้ไฟล์ <code>wokwi-logic.vcd</code> ที่สามารถดาวน์โหลดมายังเครื่องคอมพิวเตอร์ของผู้ใช้
และนำไปใช้ร่วมกับซอฟต์แวร์ภายนอก เช่น <a href="https://gtkwave.sourceforge.net/"><strong>GTKWave</strong></a> เพื่อแสดงรูปคลื่นสัญญาณ</li>
</ul>
<p><img alt="" src="wowki_esp32_button_led_logic_analyzer.png" /></p>
<p>รูป: ตัวอย่างการวาดผังวงจรเพื่อจำลองการทำงานด้วย <strong>Wokwi Simulator</strong> สำหรับโจทย์ฝึกปฏิบัติข้อที่ 1</p>
<p><img alt="" src="gtkwave_io_follower.png" /></p>
<p>รูป: ตัวอย่างการแสดงรูปคลื่นสัญญาณ <strong>DIN</strong> และ <strong>DOUT</strong> ด้วย <strong>GTKWave</strong> 
และการวัดระยะเวลาระหว่างสองเหตุการณ์ที่เกิดขึ้นกับสัญญาณ เมื่อได้จำลองการทำงานด้วย <strong>Wokwi Simulator</strong>
(<a href="wokwi_io_follower_solution.png">&rarr;</a>)</p>
<p>&nbsp;</p>
<hr />
<h2 id="2">&#9655; <strong>โจทย์ฝึกปฏิบัติข้อที่ 2</strong><a class="headerlink" href="#2" title="Permanent link">#</a></h2>
<p>การเขียนโปรแกรม <strong>ESP32</strong> เพื่อทำให้มีฟังก์ชันการทำงานได้เหมือนลอจิกเกต <strong>XOR</strong> แบบ 2 ขาอินพุต</p>
<ol>
<li>เลือกใช้ขาดิจิทัลเป็นอินพุต 2 ขา (ชื่อขา <code>I0</code> และ <code>I1</code>) และเป็นขาเอาต์พุตอีก 1 ขา (ชื่อขา <code>O</code>)
ของบอร์ด <strong>ESP32</strong> ตามความเหมาะสม</li>
<li>เขียนโค้ด <strong>Arduino Sketch</strong> เพื่อทําให้ไมโครคอนโทรลเลอร์ทํางานได้เหมือนลอจิกเกตแบบ <strong>2-input XOR
(Exclusive OR)</strong></li>
<li>วัดสัญญาณด้วยเครื่องออสซิลโลสโคป เพื่อระบุค่าหน่วงเวลาที่เกิดขึ้น (หน่วยเป็นไมโครวินาที) 
เมื่อมีการเปลี่ยนแปลงที่ขาอินพุต <code>I0</code> หรือ <code>I1</code> แล้วทําให้เกิดการเปลี่ยนแปลงลอจิกที่ขาเอาต์พุต <code>O</code> ตามมา</li>
</ol>
<p>การหน่วงเวลาของสัญญาณอินพุต-เอาต์พุตที่เกิดขึ้นที่ขาของลอจิกเกต เรียกว่า <strong>Propagation Delay</strong> (<script type="math/tex">t_P</script>) 
แบ่งเป็น 2 กรณีคือ</p>
<ul>
<li>
<script type="math/tex">t_{PLH}</script> (<em>Low-to-High</em>) 
เมื่ออินพุตเปลี่ยน แล้วทําให้เอาต์พุตเปลี่ยนจาก <strong>LOW → HIGH</strong></li>
<li>
<script type="math/tex">t_{PHL}</script> (<em>High-to-Low</em>) 
เมื่ออินพุตเปลี่ยน แล้วทําให้เอาต์พุตเปลี่ยนจาก <strong>HIGH → LOW</strong> </li>
</ul>
<p><strong>คําแนะนํา</strong></p>
<ul>
<li>ในการต่อวงจรและสร้างสัญญาณอินพุต-ดิจิทัล <code>I0</code> และ <code>I1</code> สามารถต่อวงจรปุ่มกด <strong>Push Button</strong>
บนเบรดบอร์ด จํานวน 2 ปุ่ม หรือ จะใช้สัญญาณจากโมดูล "โรตารี-เอ็นโค้ดเดอร์" 
(<strong>Rotary Encoder</strong>) ที่มี 2 ช่องสัญญาณ นำมาต่อเป็นอินพุตต่อเข้ากับขาของบอร์ด <strong>ESP32</strong></li>
</ul>
<p><img alt="" src="wokwi_esp32_xor2.png" /></p>
<p>รูป: ตัวอย่างการวาดผังวงจรสำหรับโจทย์ข้อที่ 2 โดยใช้บอร์ด <strong>ESP32</strong> และ
โมดูล <strong>Rotary Encoder Switch</strong></p>
<p><img alt="" src="gtkwave_xor2.png" /></p>
<p>รูป:  ตัวอย่างการแสดงรูปคลื่นสัญญาณ <strong>I0, I1, O</strong> ตามลำดับ ด้วย <strong>GTKWave</strong> </p>
<p>ในรูปคลื่นสัญญาณตัวอย่าง แสดงให้เห็นการเปลี่ยนแปลงที่ขาอินพุต <code>I0</code> จาก <code>High</code> เป็น <strong>Low</strong> 
(<strong>Falling Edge</strong>) และทำให้เกิดการเปลี่ยนแปลงที่ขาเอาต์พุต <code>O</code> ตามมา
โดยเปลี่ยนจาก <strong>High</strong> เป็น <strong>Low</strong> (<strong>Rising Edge</strong>) 
ระยะเวลาที่วัดได้ในกรณีนี้คือ <script type="math/tex">t_{PLH}</script> ซึ่งวัดจากขอบขาลงขอบสัญญาณ <code>I0</code> และขอบขาขึ้นของสัญญาณ <code>O</code></p>
<p>&nbsp;</p>
<p>ข้อสังเกตเกี่ยวกับโมดูล <strong>Rotary Encoder</strong> ที่ได้เลือกมาใช้งาน</p>
<ul>
<li>ขา <strong>SW</strong> เป็นขาสัญญาณของปุ่มกด ทำงานแบบ <strong>Active-Low</strong></li>
<li>โมดูล <strong>Rotary Encoder แบบที่ 1</strong>: 
ถัาวัดค่าความต้านทานที่ขา <strong>VCC(+)</strong> กับ <strong>S1</strong> หรือ <strong>S2</strong> จะได้ประมาณ <strong>20k</strong> โอห์ม 
เนื่องจากมีการใส่ตัวต้านทานแบบ <strong>Pullup</strong> ไว้ให้แล้ว แต่ถ้าเป็นขา <strong>Key</strong> 
จะได้ค่าประมาณ <strong>10k</strong> โอห์ม และถ้าวัดค่าความจุไฟฟ้าที่ขา <strong>GND</strong> กับ <strong>S1</strong> หรือ <strong>S2</strong> 
จะได้ประมาณ <strong>200nF</strong> เนื่องจากมีการเพิ่มตัวเก็บประจุที่ขาสัญญาณแต่ละขาไปยัง <strong>GND</strong></li>
<li>โมดูล <strong>Rotary Encoder แบบที่ 2</strong>: 
ถัาวัดค่าความต้านทานที่ขา <strong>VCC(+)</strong> กับ <strong>CLK</strong> หรือ <strong>DT</strong> 
จะได้ประมาณ <strong>10k</strong> โอห์ม (บางกรณีได้ <strong>5k</strong> โอห์ม) เนื่องจากมีการใส่ตัวต้านทานแบบ <strong>Pullup</strong> ไว้ให้แล้ว</li>
</ul>
<p><img alt="" src="rotary_encoder_switch_modules.jpg" /></p>
<p>รูป: ตัวอย่างโมดูล <strong>Rotary Encoder + Switch</strong> แบบที่ 1 (ด้านซ้ายมือ) และแบบที่ 2 (ด้านขวามือ)</p>
<p>&nbsp;</p>
<hr />
<h2 id="_1">&#9655; <strong>กล่าวสรุป</strong><a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p>บทความนี้นำเสนอการใช้งาน <strong>Wokwi Online Arduino Simulator</strong> 
เพื่อการทดลองเขียนโค้ด <strong>Arduino Sketch</strong> และทดลองต่อวงจรโดยใช้ <strong>LED</strong>
และปุ่มกดแบบเสมือนจริง และจำลองการทำงานของโค้ดสำหรับบอร์ดไมโครคอนโทรลเลอร์
<strong>ESP32</strong> </p>
<p>&nbsp;</p>
<hr />
<p>This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.</p>
<p>Created: 2022-11-13 | Last Updated: 2023-01-07</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021-2023 IoT Engineering Education, Bangkok/Thailand</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
