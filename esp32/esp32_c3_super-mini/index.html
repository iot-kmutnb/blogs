<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="RSP">
        <link rel="canonical" href="https://iot-kmutnb.github.io/blogs/esp32/esp32_c3_super-mini/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>แนะนำการใช้งานบอร์ด ESP32-C3 Super-Mini - IoT Engineering Education</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/arduino.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/vhdl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/verilog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/text.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/plaintext.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/matlab.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/julia.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-966FQ6RN6W"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-966FQ6RN6W");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">IoT Engineering Education</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#esp32-c3-super-mini" class="nav-link">แนะนำการใช้งานบอร์ด ESP32-C3 Super-Mini</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#esp32-c3-super-mini_1" class="nav-link">&#9655; ESP32-C3 Super-Mini</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#arduino-sketch-demo-1" class="nav-link">&#9655; Arduino Sketch Demo 1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#arduino-sketch-demo-2" class="nav-link">&#9655; Arduino Sketch Demo 2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#arduino-sketch-demo-3" class="nav-link">&#9655; Arduino Sketch Demo 3</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#arduino-sketch-demo-4" class="nav-link">&#9655; Arduino Sketch Demo 4</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#arduino-sketch-demo-5" class="nav-link">&#9655; Arduino Sketch Demo 5</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_1" class="nav-link">&#9655; กล่าวสรุป</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="esp32-c3-super-mini">แนะนำการใช้งานบอร์ด ESP32-C3 Super-Mini<a class="headerlink" href="#esp32-c3-super-mini" title="Permanent link">#</a></h1>
<hr />
<h2 id="esp32-c3-super-mini_1">&#9655; <strong>ESP32-C3 Super-Mini</strong><a class="headerlink" href="#esp32-c3-super-mini_1" title="Permanent link">#</a></h2>
<p>บทความนี้กล่าวถึง การใช้งานบอร์ดไมโครคอนโทรลเลอร์
<a href="http://wiki.icbbuy.com/doku.php?id=developmentboard:esp32-c3mini"><strong>ESP32-C3 Super-Mini</strong></a>
 ของบริษัท  <strong>QSZNTEC / Maker Go</strong> ในเบื้องต้น</p>
<p><strong>ข้อมูลเกี่ยวกับบอร์ด</strong></p>
<ul>
<li>ชิปตัวประมวลผล: <strong>Espressif ESP32-C3FH4 SoC</strong><ul>
<li><strong>Single-Core RISC-V 32-bit CPU, 160MHz</strong></li>
<li><strong>IEEE 802.11 b/g/n 2.4GHz WiFi / BLE 5.0 / Bluetooth Mesh</strong></li>
</ul>
</li>
<li>มีหน่วยความจำแบบแฟลชรวมไว้ในชิปเดียวกัน: <strong>Embedded SPI Flash (4MB)</strong></li>
<li>เชื่อมต่อด้วยคอนเนกเตอร์ <strong>Type-C USB</strong></li>
<li>ใช้ตัวสร้างความถี่ <strong>Crystal Oscillator 40MHz</strong></li>
<li>ไม่มีชิป <strong>USB-to-Serial Bridge</strong> ดังนั้นต้องใช้งานแบบ <strong>USB-CDC</strong> สำหรับการรับส่งข้อมูลกับคอมพิวเตอร์ของผู้ใช้</li>
<li>ใช้ไอซีควบคุมแรงดันคงที่:  <strong>ME611C33 LDO Voltage Regulator (3.3V)</strong></li>
<li>ใช้สายอากาศแบบ <strong>Ceramic Chip Antenna (SMD)</strong></li>
<li>มีปุ่มกด <strong>BOOT</strong> (<strong>10k pullup, GPIO-9</strong>)</li>
<li>มีปุ่มกด <strong>RESET</strong> (<strong>10k pullup, CHIP_EN</strong>)</li>
<li>มี <strong>Onboard LED (GPIO-8, Active-low)</strong></li>
<li><strong>13x I/O Pins</strong></li>
<li><strong>6x ADC Input Pins (A0 .. A5)</strong></li>
<li><strong>Power-On LED: VSYS</strong></li>
<li><strong>Power-On LED: 3.3V</strong></li>
<li>ถ้ามีการบัดกรีด้วยขา <strong>Pin Headers</strong> ก็สามารถเสียบขาลงบนเบรดบอร์ดได้ (<strong>Breadboard-Friendly</strong>)</li>
</ul>
<p><img alt="" src="supermini_esp32_c3.png" /></p>
<p>รูป: บอร์ด <strong>ESP32-C3 Super-Mini</strong> มุมมองด้านหน้าและด้านหลัง</p>
<p><img alt="" src="supermini_esp32_c3_variants.png" /></p>
<p>รูป: บอร์ด <strong>ESP32-C3 Super-Mini</strong> รุ่นเก่า (ซ้ายมือ) และรุ่นปรับปรุง (ขวามือ)</p>
<p><img alt="" src="esp32c3_super-mini_pinout.png" /></p>
<p>รูป: แผนผังแสดงตำแหน่งขาของบอร์ด <strong>ESP32-C3 Super-Mini</strong> (มุมมองจากด้านหลังของบอร์ด)</p>
<p><img alt="" src="supermini_esp32_c3_schematic.png" /></p>
<p>รูป: ผังวงจร</p>
<p>&nbsp;</p>
<hr />
<h2 id="arduino-sketch-demo-1">&#9655; <strong>Arduino Sketch Demo 1</strong><a class="headerlink" href="#arduino-sketch-demo-1" title="Permanent link">#</a></h2>
<p>โค้ดตัวอย่างนี้สาธิตการสร้างทาสก์ (<strong>Task</strong>) โดยใช้ <strong>FreeRTOS</strong> ซึ่งรองรับการใช้งานโดยอัตโนมัติ
(ถ้าใช้  <strong>Espressif ESP-IDF / Arduino Core for ESP32</strong>)
ในตัวอย่างนี้เป็นการสร้างทาสก์ เพื่อทำให้ <strong>LED</strong> ที่ขา <strong>GPIO-8</strong> กระพริบด้วยอัตราคงที่</p>
<pre><code class="language-c++">const int ledPin = 8; // use GPIO-8

// Task function to blink the LED.
void led_blink(void *pvParameters) {
  (void)pvParameters; // Task parameters not used
  int state = 0;
  pinMode( ledPin, OUTPUT );
  while (1) {
    digitalWrite( ledPin, state ^=1 ); // Toggle the LED
    vTaskDelay( 500 / portTICK_PERIOD_MS ); 
  }
}

void setup() {
  Serial.begin( 115200 );
  delay( 2000 );
  Serial.println( &quot;ESP32C3 FreeRTOS Demo...&quot; );

  // Create and run a FreeRTOS task.
  xTaskCreate( 
    led_blink,       // Task function
    &quot;ledBlinkTask&quot;,  // Task name
    512,             // Stack size (words)
    NULL,            // Task parameter
    1,               // Task priority
    NULL             // Task handle
  );
}

void loop() {
}
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="arduino-sketch-demo-2">&#9655; <strong>Arduino Sketch Demo 2</strong><a class="headerlink" href="#arduino-sketch-demo-2" title="Permanent link">#</a></h2>
<p>โค้ดตัวอย่างนี้สาธิตการสร้างทาสก์จำนวน 2 ทาสก์ โดยให้ทาสก์แรกอ่านค่าจากขาอินพุตแบบแอนะล็อก
ตามช่วงเวลาที่กำหนดไว้ เลือกใช้ขา <strong>GPIO-2</strong> ในตัวอย่างนี้ 
ค่าที่ได้จากการแปลงด้วยวงจร <strong>ADC</strong> ภายในชิป จะเป็นตัวเลขขนาด 12 บิต
จากนั้นก็ส่งข้อมูลตัวเลขที่ได้ไปยังอีกทาสก์หนึ่ง โดยใช้วิธีการสื่อสารข้อมูลด้วยแถวคอย (<strong>Queue</strong>)
เมื่อทาสก์ที่สองได้รับข้อมูล ก็จะนำค่าดังกล่าวไปใช้ในการอัปเดตค่า <strong>Duty Cycle</strong>
ของสัญญาณ <strong>PWM</strong> เพื่อปรับความสว่างของ <strong>LED</strong></p>
<pre><code class="language-c++">const int AIN_PIN = 2;  // GPIO-2
const int LED_PIN = 8;  // GPIO-8

// FreeRTOS task handles
TaskHandle_t tasks[2];

// Queue handle for passing values between tasks.
QueueHandle_t queue = NULL;

// Task function to read analog value
void analog_input_read(void *pvParameters) {
  (void)pvParameters;
  pinMode( AIN_PIN, ANALOG );
  analogSetPinAttenuation( AIN_PIN, ADC_11db );
  analogReadResolution( 12 ); // 12-bit ADC resolution

  while (1) {
    // Read the analog input pin.
    uint32_t value = analogRead(AIN_PIN);
    // Send the analog value to the queue.
    xQueueSend(queue, &amp;value, portMAX_DELAY);
    // Delay for 50 ticks (1 tick = 1 msec).
    vTaskDelay( pdMS_TO_TICKS(50) );
  }
}

// Task function to process the value
void led_pwm_update(void *pvParameters) {
  (void)pvParameters;
  int value;
  while (1) {
    // Wait until the queue is not empty.
    if (xQueueReceive(queue, &amp;value, portMAX_DELAY)) {
      // Update the PWM duty cycle (8-bit) for LED dimming.
      Serial.printf( &quot;AIN: %lu\n&quot;, value );
      analogWrite( LED_PIN, 255 - (value &gt;&gt; 4) );
    }
  }
}

void setup() {
  Serial.begin( 115200 );
  while(!Serial);
  delay( 2000 );
  Serial.println( &quot;ESP32C3 FreeRTOS Demo...&quot; );

  // Create a FreeRTOS queue used to pass an integer value.
  queue = xQueueCreate( 1, sizeof(uint32_t) );

  // Create two FreeRTOS tasks
  xTaskCreate(
      analog_input_read,     // Task function
      &quot;AnalogReadTask&quot;,      // Task name
      2048,                  // Stack size (words)
      NULL,                  // Task input parameter
      1,                     // Task priority
      &amp;tasks[0]              // Task handle
  );
  xTaskCreate(
      led_pwm_update,        // Task function
      &quot;ledPwmTask&quot;,          // Task name
      4096,                  // Stack size (words)
      NULL,                  // Task input parameter
      2,                     // Task priority
      &amp;tasks[1]              // Task handle
  );
}

void loop() {
}
</code></pre>
<p><img alt="" src="esp32_c3_super-mini_adc_pwm_demo.jpg" /></p>
<p>รูป: ตัวอย่างการต่อวงจรทดลองบนเบรดบอร์ด โดยใช้ตัวต้านทานปรับค่าได้สร้างสัญญาณอินพุต-แอนะล็อก</p>
<p>&nbsp;</p>
<hr />
<h2 id="arduino-sketch-demo-3">&#9655; <strong>Arduino Sketch Demo 3</strong><a class="headerlink" href="#arduino-sketch-demo-3" title="Permanent link">#</a></h2>
<p>ตัวอย่างโค้ดถัดไป สาธิตการตรวจสอบการกดปุ่มที่ขา <strong>GPIO-9</strong> ซึ่งเป็นปุ่มกดบนบอร์ดที่ทำงานแบบ
<strong>Active-Low</strong> เมื่อมีการกดปุ่มแล้วเกิดเหตุการณ์ขอบขาลง จะทำให้เกิดอินเทอร์รัพท์ และมีการเรียกใช้ฟังก์ชัน
<strong>ISR</strong> (<em>Interrupt Service Routine</em>) ที่เกี่ยวข้อง </p>
<p>ฟังก์ชัน <strong>ISR</strong> จะใช้เซมาฟอร์แบบไบนารี (<strong>Binary Semaphore</strong>)
สื่อสารกับอีกทาสก์หนึ่งที่คอยอยู่ เมื่อทาสก์ดังกล่าวเข้าถึงเซมาฟอร์ได้ ก็จะสลับสถานะลอจิก
<strong>LED</strong> ที่ขา <strong>GPIO-8</strong> หนึ่งครั้ง และวนกลับไปรอเซมาฟอร์อีกรอบ</p>
<pre><code class="language-c++">const int BTN_PIN = 9;
const int LED_PIN = 8;

// FreeRTOS task handle
TaskHandle_t buttonTask;

// FreeRTOS binary semaphore
SemaphoreHandle_t semaphore;

// Function to handle button press
void buttonAction( void *pvParameters ) {
  (void)pvParameters;
  bool state = 0;
  uint32_t clicks = 0;
  pinMode( LED_PIN, OUTPUT );
  digitalWrite( LED_PIN, HIGH ); 
  while (1) {
    if (xSemaphoreTake(semaphore, portMAX_DELAY) == pdTRUE) {
      digitalWrite( LED_PIN, state ^= 1 ); // Toggle the LED. 
      Serial.printf(&quot;Button pressed! (#%lu)\n&quot;, ++clicks );
    }
  }
}

void setup() {
  Serial.begin( 115200 );
  while(!Serial);
  delay( 2000 );
  Serial.println( &quot;ESP32C3 FreeRTOS Demo...&quot; );

  pinMode( BTN_PIN, INPUT_PULLUP );
  // Create a FreeRTOS binary semaphore.
  semaphore = xSemaphoreCreateBinary();

  // Attach an external interrupt to the button pin.
  attachInterrupt( digitalPinToInterrupt(BTN_PIN), [] {
    BaseType_t xHigherPriorityTaskWoken = pdFALSE;
    xSemaphoreGiveFromISR( semaphore, &amp;xHigherPriorityTaskWoken );
    if (xHigherPriorityTaskWoken == pdTRUE) {
       portYIELD_FROM_ISR();
    }
  }, FALLING );

  // Create the button task.
  xTaskCreate(
      buttonAction,       // Task function
      &quot;ButtonTask&quot;,       // Task name
      2048,               // Stack size (words)
      NULL,               // Task input parameter
      1,                  // Task priority
      &amp;buttonTask         // Task handle
  );
}

void loop() {
}
</code></pre>
<p><img alt="" src="esp32c3_freertos_button.png" /></p>
<p>รูป: ตัวอย่างข้อความเอาต์พุต หลังจากมีการกดปุ่มบนบอร์ดหลายครั้ง</p>
<p>&nbsp;</p>
<p>หากจะเปลี่ยนจากการใช้เซมาฟอร์แบบไบนารี ไปใช้วิธีการแจ้งเตือนเหตุการณ์ระหว่างทาสก์
(<strong>Task Notification</strong>) ก็มีตัวอย่างการเขียนโค้ดดังต่อไปนี้</p>
<pre><code class="language-c++">const int BTN_PIN = 9;
const int LED_PIN = 8;

// FreeRTOS task handle
TaskHandle_t buttonTask;

// Function to handle button press
void buttonAction(void *pvParameters) {
  (void)pvParameters;
  bool state = 0;
  uint32_t clicks = 0;
  pinMode( LED_PIN, OUTPUT );
  digitalWrite( LED_PIN, HIGH );
  while (1) {
    // Wait for task notification.
    ulTaskNotifyTake( pdTRUE, portMAX_DELAY );
    digitalWrite( LED_PIN, state ^= 1 ); // Toggle the LED.
    Serial.printf( &quot;Button pressed! (#%lu)\n&quot;, ++clicks );
  }
}

void setup() {
  Serial.begin( 115200 );
  while(!Serial);
  delay( 2000 );
  Serial.println( &quot;ESP32C3 FreeRTOS Demo...&quot; );

  pinMode( BTN_PIN, INPUT_PULLUP );

  // Attach an external interrupt to the button pin.
  attachInterrupt( digitalPinToInterrupt(BTN_PIN), [] {
    // Send a task notification to the button task.
    BaseType_t xHigherPriorityTaskWoken = pdFALSE;
    vTaskNotifyGiveFromISR( buttonTask, &amp;xHigherPriorityTaskWoken );
    if (xHigherPriorityTaskWoken == pdTRUE) {
       portYIELD_FROM_ISR();
    }
  }, FALLING);

  // Create the button task.
  xTaskCreate(
      buttonAction,   // Task function
      &quot;ButtonTask&quot;,   // Task name
      2048,           // Stack size (words)
      NULL,           // Task input parameter
      1,              // Task priority
      &amp;buttonTask     // Task handle
  );
}

void loop() {
}
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="arduino-sketch-demo-4">&#9655; <strong>Arduino Sketch Demo 4</strong><a class="headerlink" href="#arduino-sketch-demo-4" title="Permanent link">#</a></h2>
<p>โค้ดตัวอย่างถัดไป สาธิตการเปลี่ยนสีของ <strong>WS2812 RGB LED</strong> เมื่อมีการกดปุ่มในแต่ละครั้ง
ตามลำดับของค่าสีที่ได้มีการกำหนดไว้ในอาร์เรย์
ในการเขียนโค้ดเพื่อใช้งานโมดูล <strong>WS2812 / NeoPixel</strong> ก็มีไลบรารี
<code>Adafruit_NeoPixel</code> ของบริษัท <strong>Adafruit</strong> ให้ใช้งานได้</p>
<p>เมื่อมีการกดปุ่มแต่ละครั้ง จะเกิดอินเทอร์รัพท์ และฟังก์ชัน <strong>ISR</strong> ที่เกี่ยวข้องจะสื่อสารไปยังทาสก์
ด้วยวิธี <strong>Task Notification</strong> ของ <strong>FreeRTOS</strong> และทาสก์ดังกล่าวที่รออยู่
ได้รับการแจ้งเหตุการณ์จาก <strong>ISR</strong> ก็จะทำงานได้แล้วเปลี่ยนสีของ <strong>RGB LED</strong>
แล้วรอการสื่อสารจาก <strong>ISR</strong> ในครั้งถัดไป</p>
<pre><code class="language-c++">#include &lt;Adafruit_NeoPixel.h&gt;

const int BTN_PIN = 9;
const int WS2812_PIN = 7;

const uint32_t COLORS [] = {
   0x00001f, //  Blue
   0x001f00, // Green
   0x1f0000, // Red
   0x0000000 // OFF
};
const uint32_t NUM_COLORS = sizeof(COLORS)/sizeof(uint32_t);

// Create a NeoPixel object for a single WS2812 RGB LED.
Adafruit_NeoPixel neopixel(1, WS2812_PIN, NEO_GRB + NEO_KHZ800);

// FreeRTOS task handle
TaskHandle_t buttonTask;

// Function to handle button press
void buttonAction(void *pvParameters) {
  (void)pvParameters;
  uint32_t clicks = 0;
  uint32_t index = (NUM_COLORS-1);

  neopixel.begin();
  neopixel.setPixelColor(0, 0x1f1f1f );
  neopixel.show();

  while (1) {
    // Wait for task notification.
    ulTaskNotifyTake( pdTRUE, portMAX_DELAY );
    Serial.printf( &quot;Button pressed! (#%lu)\n&quot;, ++clicks );
    // Change the WS2812 color.
    index = (index+1) % NUM_COLORS;
    neopixel.setPixelColor(0, COLORS[ index ] );
    neopixel.show();
  }
}

void setup() {
  Serial.begin( 115200 );
  while(!Serial);
  delay( 2000 );
  Serial.println( &quot;ESP32C3 FreeRTOS Demo...&quot; );

  pinMode( BTN_PIN, INPUT_PULLUP );

  // Attach an external interrupt to the button pin.
  attachInterrupt( digitalPinToInterrupt(BTN_PIN), [] {
    // Send a task notification to the button task.
    BaseType_t xHigherPriorityTaskWoken = pdFALSE;
    vTaskNotifyGiveFromISR( buttonTask, &amp;xHigherPriorityTaskWoken );
    if (xHigherPriorityTaskWoken == pdTRUE) {
       portYIELD_FROM_ISR();
    }
  }, FALLING);

  // Create the button task.
  xTaskCreate(
      buttonAction,   // Task function
      &quot;ButtonTask&quot;,   // Task name
      2048,           // Stack size (words)
      NULL,           // Task input parameter
      1,              // Task priority
      &amp;buttonTask     // Task handle
  );
}

void loop() {
}
</code></pre>
<p><img alt="" src="esp32_c3_super-mini_ws2812_demo.jpg" /></p>
<p>รูป: ตัวอย่างการต่อวงจรทดลองบนเบรดบอร์ด โดยใช้โมดูล <strong>WS2812 RGB LED (Single-Pixel)</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="arduino-sketch-demo-5">&#9655; <strong>Arduino Sketch Demo 5</strong><a class="headerlink" href="#arduino-sketch-demo-5" title="Permanent link">#</a></h2>
<p>ตัวอย่างถัดไปสาธิตการรับและส่งต่อข้อมูลระหว่าง <strong>USB-CDC</strong> กับ <strong>Hardware Serial</strong>
(เลือกใช้ขา <strong>GPIP-20</strong> สำหรับ <strong>RX</strong> และขา <strong>GPIO-21</strong> สำหรับ <strong>TX</strong>)
มีการทำงานออกเป็นสองส่วน คือ ฟังก์ชัน <code>task1</code> และ <code>task2</code></p>
<ul>
<li><code>task1</code>: เมื่อมีข้อมูลได้ถูกส่งจากคอมพิวเตอร์ของผู้ใช้ทางช่องทาง <strong>USB-CDC</strong> 
ก็จะมีการอ่านข้อมูลดังกล่าว แล้วส่งต่อออกไปทางขา <strong>TX</strong> ของ <strong>Hardware Serial</strong> </li>
<li><code>task2</code>: ถ้ามีข้อมูลถูกส่งเข้ามาทาง <strong>Hardware Serial</strong>
ที่ขา <strong>RX</strong> ก็จะอ่านและส่งต่อไปยัง <strong>USB-CDC</strong></li>
</ul>
<pre><code class="language-c++">#include &lt;HardwareSerial.h&gt;

#define RX_PIN   (20)
#define TX_PIN   (21)
#define BUF_SIZE (64)

// Create a HardwareSerial object using UART0
HardwareSerial MySerial(0);
uint8_t tx_data[ BUF_SIZE+1 ];
uint8_t rx_data[ BUF_SIZE+1 ];

void task1() {
  uint32_t len;
  if ( (len = Serial.available()) &gt; 0 ) {
    if ( len &gt; BUF_SIZE ) { len = BUF_SIZE; }
    // Read incoming bytes from Serial.
    len = Serial.readBytes( tx_data, len );
    if ( len &gt; 0 ) {
      // Send the received bytes to MySerial.
      MySerial.write( tx_data, len );
    }
  }
}

void task2() {
  uint32_t len;
  if ( (len = MySerial.available()) &gt; 0 ) {
    if ( len &gt; BUF_SIZE ) { len = BUF_SIZE; }
    // Read incoming bytes from MySerial.
    len = MySerial.readBytes( tx_data, len );
    if ( len &gt; 0 ) {
      // Send the received bytes to Serial.
      Serial.write( tx_data, len );
    }
  }
}

void setup() {
  Serial.begin( 115200 );
  Serial.setTimeout(10);
  MySerial.begin( 115200, SERIAL_8N1, RX_PIN, TX_PIN );
  MySerial.setDebugOutput(false);
  while( MySerial.available() ) { (void)MySerial.read(); }
  MySerial.setTimeout(10);
}

void loop() {
  task1();
  task2();
}
</code></pre>
<p>ถ้าจะลองเขียนให้อยู่ในรูปแบบของทาสก์สำหรับ <strong>FreeRTOS</strong> ก็มีตัวอย่างดังนี้</p>
<pre><code class="language-c++">#include &lt;HardwareSerial.h&gt;

#define RX_PIN   (20)
#define TX_PIN   (21)
#define BUF_SIZE (64)

HardwareSerial MySerial(0);
uint8_t tx_data[ BUF_SIZE+1 ];
uint8_t rx_data[ BUF_SIZE+1 ];

void task1(void *pvParameters) {
  (void)pvParameters; // Task parameters not used.
  uint32_t len;
  while (1) {    
    if ( (len = Serial.available()) &gt; 0 ) {
      if ( len &gt; BUF_SIZE ) { len = BUF_SIZE; }
      len = Serial.readBytes( tx_data, len );
      if ( len &gt; 0 ) {
        MySerial.write( tx_data, len );
      }
    }
    vTaskDelay(pdMS_TO_TICKS(10));
  }
}

void task2(void *pvParameters) {
  (void)pvParameters; // Task parameters not used.
  uint32_t len;
  while (1) {
    if ( (len = MySerial.available()) &gt; 0 ) {
      if ( len &gt; BUF_SIZE ) { len = BUF_SIZE; }
      len = MySerial.readBytes( tx_data, len );
      if ( len &gt; 0 ) {
        Serial.write( tx_data, len );
      }
    }
    vTaskDelay(pdMS_TO_TICKS(10));
  }
}

void setup() {
  Serial.begin( 115200 );
  Serial.setTimeout(10);
  MySerial.begin( 115200, SERIAL_8N1, RX_PIN, TX_PIN );
  MySerial.setDebugOutput(false);
  while( MySerial.available() ) { (void)MySerial.read(); }
  MySerial.setTimeout(10);

  xTaskCreate( task1, &quot;Task1&quot;, 1024, NULL, 1, NULL );
  xTaskCreate( task2, &quot;Task2&quot;, 1024, NULL, 1, NULL );
}

void loop() {
}
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="_1">&#9655; <strong>กล่าวสรุป</strong><a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p>บทความนี้ได้นำเสนอการใช้งานบอร์ด <strong>ESP32-C3 Super-Mini</strong>
ซึ่งถือว่าเป็นบอร์ดไมโครคอนโทรลเลอร์อีกตัวอย่างหนึ่งที่ใช้ชิป <strong>ESP32-C3 SoC</strong>
และบอร์ดมีขนาดเล็ก ขนาดใกล้เคียงกับบอร์ด <strong>Seeed Studio XIAO ESP32-C3</strong>
นอกจากนั้นแล้วยังได้สาธิตการเขียนโค้ดด้วย <strong>Arduino + FreeRTOS</strong> เป็นตัวอย่าง</p>
<p>&nbsp;</p>
<hr />
<p>This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.</p>
<p>Created: 2023-09-17 | Last Updated: 2023-09-30</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021-2025 IoT Engineering Education, Bangkok/Thailand</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
