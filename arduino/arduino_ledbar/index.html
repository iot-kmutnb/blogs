<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="RSP">
        <link rel="canonical" href="https://iot-kmutnb.github.io/blogs/arduino/arduino_ledbar/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>การใช้งานโมดูล LED Bar - IoT Engineering Education</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/arduino.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/vhdl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/verilog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/text.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/plaintext.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/matlab.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/julia.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-966FQ6RN6W"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-966FQ6RN6W");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">IoT Engineering Education</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#led-bar" class="nav-link">การใช้งานโมดูล LED Bar</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#led-bar_1" class="nav-link">&#9655; โมดูล LED Bar</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#wokwi-simulator" class="nav-link">&#9655; การทดลองโดยใช้ Wokwi Simulator</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_1" class="nav-link">&#9655; การต่อวงจรโดยใช้อุปกรณ์จริง</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#pwm-esp32" class="nav-link">&#9655; การสร้างสัญญาณ PWM สำหรับ ESP32</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#pwm-arduino-nano" class="nav-link">&#9655; การสร้างสัญญาณ PWM สำหรับ Arduino Nano</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_2" class="nav-link">&#9655; กล่าวสรุป</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="led-bar">การใช้งานโมดูล  LED Bar<a class="headerlink" href="#led-bar" title="Permanent link">#</a></h1>
<p><strong>Keywords</strong>: <em>Arduino</em>, <em>Nano</em>, <em>ESP32</em>, <em>LED Bar Module</em>,
<em>WokWi Simulator</em> </p>
<hr />
<h2 id="led-bar_1">&#9655; <strong>โมดูล LED Bar</strong><a class="headerlink" href="#led-bar_1" title="Permanent link">#</a></h2>
<p>บทความนี้นำเสนอตัวอย่างการใช้โมดูล <strong>8-bit LED Bar</strong> ที่มีวงจร  <strong>LED</strong>
และตัวต้านทานจำกัดกระแส (มักใช้ตัวต้านทานแบบที่เรียกว่า <strong>R-Pack</strong> 
ที่มีขนาด เช่น <strong>1k&Omega;</strong> หรือ <strong>2k&Omega;</strong> เป็นต้น)
โมดูลประเภทนี้ สามารถนำมาใช้เป็นอุปกรณ์เอาต์พุตเพื่อแสดงสถานะลอจิกได้ 8 บิต 
แบ่งจำแนกได้เป็น 2 ประเภท ตามรูปแบบการต่อวงจร </p>
<ol>
<li><strong>Common-Anode</strong>: ขาแอโนด (<strong>A</strong>) ของหลอด <strong>LED</strong> ทุกดวง เชื่อมต่อถึงกัน
เรียกว่า ขา <strong>COM (Anode)</strong> ซึ่งจะต้องต่อกับแรงดันไฟเลี้ยง <strong>VCC</strong> และที่ขาอินพุต <strong>D1-D8</strong>
ของโมดูล  จะต้องป้อนสัญญาณดิจิทัลแบบ <strong>Active-Low</strong>
(อินพุตเป็น '0' หรือ <strong>LOW</strong> จะทำให้ <strong>LED</strong> อยู่ในสถานะ <strong>ON</strong>)</li>
<li><strong>Common-Cathode</strong> ขาแคโทด (<strong>K</strong>) ของหลอด <strong>LED</strong> ทุกดวง เชื่อมต่อถึงกัน
เรียกว่า ขา <strong>COM (Cathode)</strong> ซึ่งจะต้องต่อกับ <strong>GND</strong> และที่ขาอินพุต <strong>D1-D8</strong> ของโมดูล 
จะต้องป้อนสัญญาณดิจิทัลแบบ <strong>Active-High</strong> (อินพุตเป็น '1' หรือ <strong>HIGH</strong>
จะทำให้ <strong>LED</strong> อยู่ในสถานะ <strong>ON</strong>)</li>
</ol>
<p><img alt="" src="ledbar_schematic.png" /></p>
<p>รูป: ผังวงจรของโมดูล (1) <strong>Common-Anode</strong> (ซ้ายมือ) และ (2) <strong>Common-Cathode</strong> (ขวามือ)</p>
<p><img alt="" src="ledbard_module-1.png" /></p>
<p>รูป: โมดูล <strong>8-bit LED Bar</strong></p>
<p><img alt="" src="ledbar_dimension.png" /></p>
<p>รูป: แสดงขนาดของโมดูลและตำแหน่งการวางชิ้นส่วนอิเล็กทรอนิกส์บนแผ่น <strong>PCB</strong> (มุมมอง <strong>Top View</strong>)</p>
<hr />
<h2 id="wokwi-simulator">&#9655; <strong>การทดลองโดยใช้  Wokwi Simulator</strong><a class="headerlink" href="#wokwi-simulator" title="Permanent link">#</a></h2>
<p>การทดลองเขียนโค้ด <strong>Arduino</strong> เพื่อใช้งานร่วมกับโมดูล <strong>LED Bar</strong>
สามารถทำได้ง่าย โดยใช้ <strong>Wokwi Simulator</strong> 
(<a href="https://wokwi.com/projects/">https://wokwi.com/projects/</a>)
และยังไม่จำเป็นต้องมีอุปกรณ์ฮาร์ดแวร์จริง </p>
<pre><code class="language-cpp">#if defined(ESP32)
// For ESP32 DevKit V1 board + 10-bit LED Bar (Wokwi Simulator):
// =&gt; use pins: {23,22,32,33,25,26,27,14,12,13}
// For WeMos Lolin32 Lite + 8-bit LED bar
// =&gt; use pins: {22,19,23,18,5,17,16,4}
const int LED_PINS[] = {23,22,32,33,25,26,27,14,12,13};
#else
// For Arduino Nano + 10-bit LED Bar (Wokwi Simulator)
// =&gt; use pins: {2,3,4,5,6,7,8,9,10,11}
// For Arduino Nano + 8-bit LED Bar 
// =&gt; use pins: {5,6,7,8,9,10,11,12}
const int LED_PINS[] = {2,3,4,5,6,7,8,9,10,11};
#endif

#define BIT_INV (1)  // 0 or 1

const int NUM_LEDS = sizeof(LED_PINS)/sizeof(int);
uint16_t MASK = (1U &lt;&lt; NUM_LEDS)-1;

String str;

void setup() {
  Serial.begin(115200);
  for ( int i=0; i &lt; NUM_LEDS; i++ ) {
    // set the direction of the i-th LED pin
    pinMode( LED_PINS[i], OUTPUT ); 
    // turn on the first LED (i=0) and the rest off. 
    digitalWrite( LED_PINS[i], (i==0) ? HIGH : LOW );
  }
}

void loop() {
  static uint16_t value=1;
  // update the output of each LED in the array
  for ( int i=0; i &lt; NUM_LEDS; i++ ) {
     digitalWrite( LED_PINS[i], (value &gt;&gt; i) &amp; 1 ^ BIT_INV );     
  }
  // show the current value of the variable in a hex format
  str = &quot;LEDs: value=0x&quot;;
  str += String( value, HEX );
  Serial.println( str.c_str() );
  // performs a rotate-shift-left operation on the value (10 bits)
  value = ((value &lt;&lt; 1) | (value &gt;&gt; (NUM_LEDS-1))) &amp; MASK;
  delay(500);
}
</code></pre>
<p>ในโค้ดตัวอย่างนี้ มีการกำหนดขา <strong>GPIO</strong> สำหรับบอร์ด <strong>Arduino Nano</strong>
และ <strong>ESP32 DevKit V1</strong> แตกต่างกัน โดยใช้ตัวแปรชื่อ<code>LED_PINS</code> 
อ้างอิงอาร์เรย์ที่มีหมายเลขของขา <strong>I/O</strong> ของไมโครคอนโทรลเลอร์ เรียงไปตามลำดับ
มีทั้งหมด 10 ขา (แต่ถ้าใช้กับโมดูล <strong>8-bit LED Bar</strong> จะเลือกใช้หมายเลขขาเพียง 8 ขา)
และมีรูปผังการต่อวงจรเป็นตัวอย่าง</p>
<p>ถ้าใช้บอร์ดไมโครคอนโทรลเลอร์  <strong>ESP32 DevKit V1</strong> จะเลือกใช้หมายเลขขาดังต่อไปนี้</p>
<pre><code class="language-c">const int LED_PINS[] = {23,22,32,33,25,26,27,14,12,13};
</code></pre>
<p>แต่ถ้าใช้บอร์ด <strong>Arduino Nano</strong> จะเปลี่ยนมาใช้หมายเลขขาดังต่อไปนี้</p>
<pre><code class="language-c">const int LED_PINS[] = {2,3,4,5,6,7,8,9,10,11};
</code></pre>
<p><strong>ข้อสังเกต:</strong> </p>
<ul>
<li>โมดูล <strong>LED Bar</strong> ที่มีให้เลือกใช้ใน <strong>WokWi Simulator</strong> เป็นแบบ 10 บิต
มี <strong>LED</strong> ทั้งหมด10 ดวง ถ้าจะใช้จริง จะต้องมีตัวต้านทานจำกัดกระแสในวงจรด้วยสำหรับ <strong>LED</strong>
แต่ละดวง</li>
<li>หากใช้บอร์ดไมโครคอนโทรลเลอร์อื่น จะต้องเลือกใช้ขา <strong>GPIO</strong> ให้เหมาะสม
เพื่อเป็นขาเอาต์พุตและนำไปเชื่อมต่อกับโมดูล <strong>LED Bar</strong></li>
</ul>
<p>เมื่อโปรแกรมเริ่มทำงาน จะทำให้ <strong>LED</strong> ดวงแรก เปลี่ยนเป็นสถานะ <strong>ON</strong> และสว่างขึ้น
จากนั้นจะเปลี่ยนเป็น <strong>OFF</strong> แล้วดับลง และ <strong>LED</strong> ที่จะสว่างขึ้น จะเลื่อนไปตำแหน่งถัดไป
จนครบแล้ว กลับมาเริ่มต้นที่ตำแหน่งแรก ทำซ้ำในลักษณะนี้ไปเรื่อย ๆ</p>
<p>โค้ดตัวอย่างนี้ จะใช้กับโมดูล <strong>LED</strong> ที่ทำงานแบบ <strong>Active-High</strong>
แต่ถ้าใช้กับโมดูลแบบ <strong>Active-Low</strong> จะต้องมีการกลับค่าบิตก่อน 
(<strong>Bit Inversion / Logical Negation</strong>)</p>
<p><img alt="" src="wokwi_nano_ledbar-3.png" /></p>
<p>รูป: ผังการต่อวงจรเสมือนจริงสำหรับ <strong>Arduino Nano V3</strong></p>
<p><img alt="" src="wokwi_esp32_ledbar-3.png" /></p>
<p>รูป: ผังการต่อวงจรเสมือนจริงสำหรับ <strong>ESP32-DevKit-V1</strong></p>
<p><img alt="" src="wokwi_nano_ledbar-1.png" /></p>
<p>รูป: การเขียนโค้ดและวาดวงจรด้วย <strong>WokWi Simulator</strong> สำหรับบอร์ด <strong>Arduino Nano</strong></p>
<p><img alt="" src="wokwi_nano_ledbar-2.png" /></p>
<p>รูป: การรันโค้ดเพื่อทดสอบการทำงานโดยใช้บอร์ด <strong>Arduino Nano</strong></p>
<p><img alt="" src="wokwi_esp32_ledbar-1.png" /></p>
<p>รูป: การเขียนโค้ดและวาดวงจรด้วย <strong>WokWi Simulator</strong> สำหรับบอร์ด <strong>ESP32</strong></p>
<p><img alt="" src="wokwi_esp32_ledbar-2.png" /></p>
<p>รูป: การรันโค้ดเพื่อทดสอบการทำงานโดยใช้บอร์ด <strong>ESP32</strong></p>
<hr />
<h2 id="_1">&#9655; <strong>การต่อวงจรโดยใช้อุปกรณ์จริง</strong><a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p>ลองมาดูตัวอย่างการต่อวงจร และใช้ซอฟต์แวร์ <strong>Arduino IDE</strong> เพื่อคอมไพล์โค้ด
และอัปโหลด <strong>Arduino Sketch</strong> ไปยังบอร์ดไมโครคอนโทรลเลอร์</p>
<p><img alt="" src="arduino_nano_build.png" /></p>
<p>รูป: การคอมไพล์และอัปโหลดโค้ด <strong>Arduino Sketch</strong> สำหรับบอร์ด <strong>Arduino Nano</strong></p>
<p><img alt="" src="nano_ledbar.jpg" /></p>
<p>รูป: ตัวอย่างการต่อวงจรโดยใช้บอร์ด <strong>Arduino Nano</strong> และโมดูล
<strong>8-bit LED Bar</strong> แบบ <strong>COM=GND</strong> และเลือกใช้ขา
<strong>Arduino Pins = {D5, D6, D7, D8, D9, D10, D11, D12}</strong></p>
<p><img alt="" src="esp32_lolin32_lite_ledbar.jpg" /></p>
<p>รูป: ตัวอย่างการต่อวงจรโดยใช้บอร์ด <strong>WeMos Lolin32 Lite</strong> (ใช้แทนบอร์ด
<strong>ESP32 DevKit V1</strong>) และโมดูล
<strong>8-bit LED Bar</strong> แบบ <strong>COM=VCC</strong> และเลือกใช้ขา
<strong>ESP32 GPIO Pins = {22, 19, 23, 18, 5, 17, 16, 4}</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="pwm-esp32">&#9655; <strong>การสร้างสัญญาณ PWM สำหรับ ESP32</strong><a class="headerlink" href="#pwm-esp32" title="Permanent link">#</a></h2>
<p>ชิป <strong>ESP32</strong> มีวงจรภายในที่เรียกว่า <strong>LED Control (LEDC) Peripheral</strong>
สามารถสร้างสัญญาณดิจิทัล-เอาต์พุตตามรูปแบบที่เรียกว่า <strong>PWM (Pulse-Width Modulation)</strong>
ซึ่งเป็นสัญญาณที่มีความถี่คงที่ แต่ปรับความกว้างของพัลส์ที่เป็น <strong>HIGH</strong> ได้ (เรียกว่า <strong>Duty Cycle</strong>)
และสามารถสร้างสัญญาณได้สูงสุด 16 ช่อง (<strong>PWM Channels</strong>)</p>
<p>
<script type="math/tex; mode=display">
  Duty\,Cycle = \frac{High\,Pulse\,Duration}{PWM\,Period} \times 100\%
</script>
</p>
<p><img alt="" src="arduino_pwm_signals.png" /></p>
<p>รูป: ตัวอย่างคลื่นสัญญาณ <strong>PWM</strong> ที่มีค่า <strong>Duty Cycle</strong> แตกต่างกัน (Source: arduino.cc)</p>
<p>&nbsp;</p>
<p>การเขียนโปรแกรมด้วย <strong>Arduino-ESP32</strong> ก็มีคำสั่งที่เกี่ยวข้องกับการใช้งาน 
<a href="https://espressif-docs.readthedocs-hosted.com/projects/arduino-esp32/en/latest/api/ledc.html"><strong>LEDC</strong></a> ดังนี้</p>
<ul>
<li><code>double ledcSetup(uint8_t channel, double freq, uint8_t resolution_bits)</code>
เป็นการเริ่มต้นใช้งานวงจร <strong>LEDC</strong> สำหรับช่องสัญญาณ <code>channel</code> ตามที่เลือก (<strong>0..15</strong>)
และตั้งค่าความถี่ให้ใกล้เคียงกับค่าที่ต้องการ (<code>freq</code>) และเลือกความละเอียดของค่า <strong>PWM Duty Cycle</strong>
โดยระบุเป็นจำนวนบิต (<code>resolution_bits</code>) ฟังก์ชันนี้จะให้ค่าความถี่ (หน่วยเป็น <strong>Hz</strong>)
ของสัญญาณ <strong>PWM</strong> ที่สามารถใช้ได้ แต่ถ้าได้ค่าเป็น 0 แสดงว่าเกิดความผิดพลาดในการตั้งค่าใช้งาน</li>
<li><code>void ledcWrite(uint8_t channel, uint32_t duty)</code>
เป็นการเขียนค่า <code>duty</code> สำหรับ <strong>PWM Duty Cycle</strong> ไปยังช่องสัญญาณ <code>channel</code>
และค่าจะต้องอยู่ในช่วง <script type="math/tex">0 .. 2^n</script>, <script type="math/tex">n</script> คือ จำนวนบิตสำหรับค่า <strong>PWM Resolution</strong></li>
<li><code>void ledcAttachPin(uint8_t pin, uint8_t channel)</code>
เป็นการเริ่มต้นใช้งานขา <code>pin</code> ซึ่งเป็นหมายเลขขา <strong>GPIO</strong> ของ <strong>ESP32</strong>
กับช่องสัญญาณ <code>channel</code></li>
<li><code>void ledcDetachPin(uint8_t pin)</code>
เป็นการเลิกใช้งานขา <code>pin</code> สำหรับช่องสัญญาณ <strong>PWM Channel</strong></li>
</ul>
<p>ตัวอย่างโค้ดต่อไปนี้ สาธิตการทำให้ <strong>LED</strong> แต่ละดวงของโมดูล <strong>8-bit LED Bar</strong>
(เลือกใช้แบบ <strong>Active-Low</strong>) ค่อย ๆ สว่างขึ้นแล้วดับลง เรียงไปตามลำดับของ <strong>LED</strong> 
โดยใช้สัญญาณ <strong>PWM</strong> ที่มีค่า  <strong>Duty Cycle</strong> เปลี่ยนแปลงได้ เพื่อปรับความสว่างของ
<strong>LED</strong>  มีการตั้งค่าความถี่เท่ากับ <strong>1kHz</strong> และค่า <strong>PWM Resolution</strong>
เท่ากับ 8 บิต ดังนั้นจึงใช้ค่า <strong>Duty Cycle</strong> ในช่วง <strong>0 .. 255</strong></p>
<pre><code class="language-c">const int LED_PINS[] = {22,19,23,18,5,17,16,4}; // ESP32 pins
const int NUM_LEDS   = sizeof(LED_PINS)/sizeof(int);

#define OFF (HIGH) // active-low LED

void setup() {
  for ( int i=0; i &lt; NUM_LEDS; i++ ) {
    // set the direction of the i-th LED pin
    pinMode( LED_PINS[i], OUTPUT ); 
    digitalWrite( LED_PINS[i], OFF );
  }
}

const int PWM_RESOLUTION = 8;
const int PWM_FREQ = 1000;
const int DUTY_MAX = (1 &lt;&lt; PWM_RESOLUTION);

void loop() {
  for ( int i=0; i &lt; NUM_LEDS; i++ ) {
      ledcSetup( i /*channel*/, PWM_FREQ, PWM_RESOLUTION );
      ledcAttachPin( LED_PINS[i] /*pin*/, i /*channel*/ );
      for ( int x=0; x &lt; 2*DUTY_MAX; x++ ) {
         int duty = (x &gt;= DUTY_MAX) ? 2*DUTY_MAX-1-x : x; 
         ledcWrite( i, DUTY_MAX-1-duty );
         delay(5);
      }
      ledcDetachPin( LED_PINS[i] ); 
      digitalWrite( LED_PINS[i], OFF );
      delay(200);
  }
}
</code></pre>
<p>&nbsp;</p>
<p><strong>คำแนะนำ:</strong> ให้ลองเปลี่ยนมาใช้ <strong>LED</strong> แทน <strong>LED Bar</strong> ในกรณีที่ใช้ <strong>WokWi Simulator</strong>
จำลองการทำงาน เพราะจะทำให้เห็นการเปลี่ยนแปลงและสังเกตดูความสว่างของ <strong>LED</strong> ได้ชัดเจนกว่าขณะที่จำลองการทำงานของวงจร</p>
<p><img alt="" src="wokwi_esp32_ledc.png" /></p>
<p>รูป: ตัวอย่างการต่อวงจรสำหรับ <strong>WokWi Simulator</strong> และเลือกใช้ขาของบอร์ด
<strong>ESP32 DevKit V1</strong> จำนวน 4 ขา <strong>{5, 18, 19, 21}</strong> และต่อวงจร <strong>LED</strong> จำนวน 4 ชุด
ให้ทำงานแบบ <strong>Active-Low</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="pwm-arduino-nano">&#9655; <strong>การสร้างสัญญาณ PWM สำหรับ Arduino Nano</strong><a class="headerlink" href="#pwm-arduino-nano" title="Permanent link">#</a></h2>
<p>ในการสร้างสัญญาณ <strong>PWM</strong> โดยใช้บอร์ด <strong>Arduino Uno</strong> หรือ <strong>Nano</strong>
จะต้องเลือกใช้ขาจากหมายเลข <strong>{3, 5, 6, 9, 10 ,11}</strong> ซึ่งมีเพียง 6 ขา เท่านั้น
(เนื่องจากชิปไมโครคอนโทรลเลอร์ <strong>ATmega328P</strong> สามารถสร้างสัญญาณ <strong>PWM</strong> 
ด้วยใช้วงจร <strong>Timers</strong> ภายในชิป ได้เพียง 6 ช่อง) และมีคำสั่ง
<a href="https://www.arduino.cc/reference/en/language/functions/analog-io/analogwrite/"><code>analogWrite()</code></a>
ของ <strong>Arduino API</strong> ให้ใช้กับขาเหล่านั้น ความถี่ของสัญญาณ <strong>PWM</strong> ได้ถูกกำหนดไว้แล้ว และมีจำนวนบิตของสัญญาณ <strong>PWM</strong> เท่ากับ 8 บิต </p>
<ul>
<li><strong>490 Hz: 3, 9, 10, 11 pins</strong></li>
<li><strong>980 Hz: 5, 6 pins</strong></li>
</ul>
<p>โค้ดต่อไปนี้ สาธิตการสร้างสัญญาณ <strong>PWM</strong> จำนวน 4 ช่องสัญญาณ โดยเลือกใช้งานขาหมายเลข 
<strong>{5, 6, 9, 10}</strong> เพื่อนำมาใช้ควบคุมความสว่างของ <strong>LED</strong> จำนวน 4 ดวง
(ต่อวงจรให้ทำงานแบบ <strong>Active-High</strong>)</p>
<pre><code class="language-c">const int LED_PINS[] = {5,6,9,10}; // Arduino PWM pins
const int NUM_LEDS   = sizeof(LED_PINS)/sizeof(int);

#define OFF (LOW) // active-high LED

void setup() {
  for ( int i=0; i &lt; NUM_LEDS; i++ ) {
    // set the direction of the i-th LED pin
    pinMode( LED_PINS[i], OUTPUT ); 
    digitalWrite( LED_PINS[i], OFF );
  }
}

#define DUTY_MAX (256) // 8-bit PWM resolution

void loop() {
  for ( int i=0; i &lt; NUM_LEDS; i++ ) {
    int pin = LED_PINS[i];
    analogWrite( pin, 0 );
      for ( int x=0; x &lt; 2*DUTY_MAX; x++ ) {
         int duty = (x &gt;= DUTY_MAX) ? 2*DUTY_MAX-1-x : x; 
         analogWrite( pin, duty );
         delay(5);
      }
      digitalWrite( pin, OFF );
      delay(200);
  }
}
</code></pre>
<p><img alt="" src="wokwi_nano_led_pwm.png" /></p>
<p>รูป: ตัวอย่างการต่อวงจรและจำลองการทำงานโดยใช้ <strong>WokWi Simulator</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="_2">&#9655; <strong>กล่าวสรุป</strong><a class="headerlink" href="#_2" title="Permanent link">#</a></h2>
<p>บทความนี้นำเสนอการใช้งานโมดูล <strong>8-bit LED Bar</strong> และการเขียนโค้ด <strong>Arduino Sketch</strong>
โดยทดลองใช้กับบอร์ดไมโครคอนโทรลเลอร์ <strong>ESP32</strong> และ <strong>Arduino Nano</strong>
และจำลองการทำงานเสมือนจริงด้วย <strong>WokWi Simulator</strong></p>
<p>&nbsp;</p>
<hr />
<p><em>This work is licensed under a</em> <strong><em>Creative Commons Attribution-ShareAlike 4.0 International License</em></strong>.</p>
<p>Created: 2022-09-06 | Last Updated: 2022-11-07</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021-2025 IoT Engineering Education, Bangkok/Thailand</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
