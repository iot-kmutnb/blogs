<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="RSP">
        <link rel="canonical" href="https://iot-kmutnb.github.io/blogs/fpga/tang_nano/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>การใช้งานซอฟต์แวร์ Gowin IDE Standard Edition สำหรับบอร์ด Sipeed Tang Nano - IoT Engineering Education</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/arduino.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/vhdl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/verilog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/text.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/plaintext.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/matlab.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/julia.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-966FQ6RN6W"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-966FQ6RN6W");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">IoT Engineering Education</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#gowin-ide-standard-edition-sipeed-tang-nano" class="nav-link">การใช้งานซอฟต์แวร์ Gowin IDE Standard Edition สำหรับบอร์ด Sipeed Tang Nano</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#sipeed-tang-nano" class="nav-link">&#9655; บอร์ด Sipeed Tang Nano</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#gowin-eda-sipeed-tang-nano" class="nav-link">&#9655; การใช้งานซอฟต์แวร์ Gowin EDA สำหรับบอร์ด Sipeed Tang Nano</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#bitstream-openfpgaloader" class="nav-link">&#9655; การอัปโหลดไฟล์ Bitstream โดยใช้โปรแกรม OpenFPGALoader</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#gowin-eda-ubuntu-vm" class="nav-link">&#9655; การใข้งาน Gowin EDA ภายใต้ Ubuntu VM</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#8x-led-bargraph" class="nav-link">&#9655; **ตัวอย่างโค้ด: 8x LED Bargraph **</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#4-digit-7-segment-display" class="nav-link">&#9655; ตัวอย่างโค้ด: 4-Digit 7-Segment Display</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#rotary-encoder-switch-8x-led-bar" class="nav-link">&#9655; ตัวอย่างโค้ด: Rotary Encoder Switch + 8x LED Bar</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_1" class="nav-link">&#9655; กล่าวสรุป</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="gowin-ide-standard-edition-sipeed-tang-nano">การใช้งานซอฟต์แวร์ Gowin IDE Standard Edition สำหรับบอร์ด Sipeed Tang Nano<a class="headerlink" href="#gowin-ide-standard-edition-sipeed-tang-nano" title="Permanent link">#</a></h1>
<p><strong>Keywords</strong>: <em>Gowin FPGA</em>, <em>Gowin EDA Software</em>, <em>Sipeed Tang Nano</em></p>
<hr />
<h2 id="sipeed-tang-nano">&#9655; <strong>บอร์ด Sipeed Tang Nano</strong><a class="headerlink" href="#sipeed-tang-nano" title="Permanent link">#</a></h2>
<p>บริษัท <a href="https://www.sipeed.com/"><strong>Sipeed</strong></a> ได้พัฒนาบอร์ด <strong>FPGA</strong>
ในกลุ่มที่เรียกว่า <strong>Sipeed Tang FPGA</strong> และมีบอร์ดรุ่นแรกคือ
<strong>Sipeed Tang Nano</strong> ที่มีชิป <strong>FPGA</strong> เป็นรุ่น <strong>GW1N-1-LV</strong> 
(<strong>LittleBee FPGA family, 55nm LP technology</strong>) ของบริษัท <a href="https://www.gowinsemi.com/en/"><strong>Guangdong Gowin Semiconductor (GOWINSEMI)</strong></a> จากประเทศจีน
และมีราคาไม่แพง (ราคาไม่เกิน $6 หรือ  250 ~ 300 บาท โดยประมาณ) เหมาะสำหรับผู้เริ่มต้นเรียนรู้เกี่ยวกับ <strong>FPGA</strong>
หลังจากนั้นจึงมีบอร์ด <strong>FPGA</strong> รุ่นอื่นของ <strong>Sipeed</strong> ทยอยออกมาสู่ตลาด</p>
<p>คำแนะนำ: สำหรับผู้ที่สนใจจะหาซื้อบอร์ด <strong>Tang Nano (GW1N-1 QN48)</strong> มาลองใช้งาน แนะนำให้เลือกใช้
<strong>Tang Nano 1K (GW1NZ-1 QN48)</strong> แทน เนื่องจากบอร์ด <strong>Tang Nano</strong> ไม่มีการผลิตและจำหน่ายแล้ว </p>
<p><img alt="" src="tang_nano_board.png" /></p>
<p>รูป: บอร์ด <strong>Sipeed Tang Nano FPGA</strong></p>
<p><img alt="" src="tang_nano_pinout.png" /></p>
<p>รูป: แผนผังแสดงตำแหน่งขาต่าง ๆ ของบอร์ด <strong>Sipeed Tang Nano FPGA</strong></p>
<p><img alt="" src="sipeed_tang_nano_boards.png" /></p>
<p>รูป: ตัวอย่างบอร์ด <strong>Tang Nano Series: 1K / 4K / 9K / 20K</strong> (Source: Sipeed)</p>
<p><img alt="" src="tang_primer_20k_core.png" /> </p>
<p>รูป: <strong>Tang Primer 20K - Core Board</strong> (Source: Sipeed)</p>
<p><img alt="" src="tang_primer_20k_lite.png" /></p>
<p>รูป: <strong>Tang Primer 20K - Lite Board</strong> (Source: Sipeed)</p>
<p>&nbsp;</p>
<p><strong>ข้อมูลเกี่ยวกับบอร์ด Sipeed Tang Nano (Released: October 2019)</strong></p>
<ul>
<li><strong>FPGA</strong>: Gowin GW1N-1-LV  <ul>
<li><strong>LUTs</strong>: 1,152   </li>
<li><strong>FFs</strong>: 864</li>
<li><strong>Block SRAM</strong>: 72Kbits</li>
<li><strong>User Flash</strong>: 96Kbits</li>
<li><strong>PLL</strong>: 1</li>
<li><strong>I/O banks</strong>: 4</li>
<li><strong>Core Voltage</strong>: 1.2V</li>
<li><strong>IC Package</strong>: QN48</li>
</ul>
</li>
<li><strong>Storage</strong>: Quad-SPI PSRAM, 64Mbits (8MB), 3.3V</li>
<li><strong>USB Type-C port</strong></li>
<li><strong>WCH CH552T</strong>: USB-JTAG &amp; USB-Serial</li>
<li><strong>3x RGB LED</strong> (active-low):<ul>
<li><strong>LED_G</strong>: IOB7A / 16 pin</li>
<li><strong>LED_B</strong>: IOB10A / 17 pin</li>
<li><strong>LED_R</strong>: IOB10B / 18 pin</li>
</ul>
</li>
<li><strong>2x User Buttons</strong>: <ul>
<li><strong>Button A</strong>: IOB3B / 14 pin</li>
<li><strong>Button B</strong>: IOB6B / 15 pin</li>
</ul>
</li>
<li><strong>24MHz Crystal Oscillator</strong>:<ul>
<li><strong>XTAL_IN</strong>: GCLKT_2 / 35 pin</li>
</ul>
</li>
<li><strong>Standard 40-pin RGB LCD interface</strong></li>
<li><strong>Breadboard-compatible Pin Headers (2x20 pins)</strong></li>
</ul>
<p><strong>ข้อสังเกต:</strong> บอร์ด <strong>Sipeed Tang Nano 1K / 4K / 9K / 20K</strong>
สามารถใช้ได้กับซอฟต์แวร์ <strong>Gowin EDA Educational Version</strong> (<em>Free Version</em>)
โดยไม่ต้องขอไฟล์ลิขสิทธิ์ในการใช้งาน แต่ถ้าเลือกใช้งาน <strong>Gowin EDA Standard Version</strong>
จะต้องทำขั้นตอนขอ <strong>License File</strong> จากเว็บไซต์ของบริษัท</p>
<p><a href="tang_nano_schematic.pdf"><img alt="" src="tang_nano_schematic.png" /></a></p>
<hr />
<h2 id="gowin-eda-sipeed-tang-nano">&#9655; <strong>การใช้งานซอฟต์แวร์ Gowin EDA สำหรับบอร์ด Sipeed Tang Nano</strong><a class="headerlink" href="#gowin-eda-sipeed-tang-nano" title="Permanent link">#</a></h2>
<p>บริษัท <strong>Gowin</strong> ได้เปิดให้ผู้ใช้สามารถดาวน์โหลดซอฟต์แวร์ <a href="https://www.gowinsemi.com/en/support/download_eda/"><strong>Gowin (EDA) IDE</strong></a>
เพื่อนำใช้ในการออกแบบวงจรดิจิทัลสำหรับชิป <strong>FPGAs</strong> แบ่งเป็น 2 เวอร์ชัน สำหรับระบบปฏิบัติการ <strong>Windows</strong> และ <strong>Linux</strong></p>
<ul>
<li><strong>Gowin Standard Edition</strong>:
ผู้ใช้จะต้องลงทะเบียนและเข้าไปกรอกข้อมูลบนเว็บไซต์ของบริษัท เพื่อขอรับไฟล์ลิขสิทธิ์ (<a href="https://www.gowinsemi.com/en/support/license"><strong>Apply License File</strong></a>) ทางอีเมล์
และทดลองใช้ซอฟต์แวร์ได้ฟรี เป็นระยะเวลา 1 ปี
ถ้าเลือกใช้บอร์ด <strong>Sipeed Tang Nano</strong> จะต้องเลือกใช้เวอร์ชันนี้</li>
<li><strong>Gowin Education Edition</strong>: เป็นซอฟต์แวร์เหมือน <strong>Gowin EDA</strong> ไม่ต้องใช้ไฟล์ลิขสิทธิ์ใด ๆ
แต่จะใช้ได้กับชิป <strong>Gowin FPGAs</strong> บางรุ่นเท่านั้น
ถ้าเลือกใช้บอร์ด เช่น <strong>Sipeed Tang Nano 1K / 4K / 9K / 20K</strong> (เรียงตามความจุเชิงลอจิกจากน้อยไปมาก)
และ <strong>Tang Primer 20K</strong> ก็สามารถใช้ซอฟต์แวร์ในเวอร์ชันนี้ได้</li>
</ul>
<p><img alt="" src="gowin_eda_design_flow.png" /></p>
<p>รูป: <strong>Gowin FPGA Design Flow</strong> (Source: Gowin Semiconductor)</p>
<p>ถัดไปเป็นการทดลองใช้งานซอฟต์แวร์ <strong>Gowin IDE - Standard Edition</strong> 
สำหรับระบบปฏิบัติการ <strong>Linux (Ubuntu Desktop 22.04 LTS)</strong></p>
<p>ไฟล์สำหรับการติดตั้งใช้งานคือ <a href="https://cdn.gowinsemi.com.cn/Gowin_V1.9.9Beta-2_linux.tar.gz"><code>Gowin_V1.9.9Beta-2_linux.tar.gz</code></a>
และนำมาแตกไฟล์ จะได้ไดเรกทอรีย่อยชื่อ <code>./IDE</code> และ <code>./Programmer</code></p>
<pre><code class="language-bash">$ wget -c https://cdn.gowinsemi.com.cn/Gowin_V1.9.9Beta-2_linux.tar.gz
$ tar xvfz Gowin_V1.9.9Beta-2_linux.tar.gz
$ cd Gowin_V1.9.9Beta-2_linux/
</code></pre>
<p>เปิดใช้งานโปรแกรมโดยทำคำสั่ง </p>
<pre><code class="language-bash">$ ./IDE/bin/gw_ide &amp;
</code></pre>
<p>เริ่มต้นจะมีการตรวจสอบไฟล์ลิขสิทธิ์โดย <strong>Gowin License Manager</strong>
เมื่อผู้ใช้ได้รับไฟล์ <strong>.lic</strong> ผ่านช่องทางอีเมล์มาแล้ว ให้คลิกเลือกไฟล์ดังกล่าว และกดปุ่ม <strong>Check</strong>
หากตรวจสอบแล้วถูกต้อง ให้กดปุ่ม <strong>Save</strong> </p>
<p><img alt="" src="gowin_license_manager.png" /></p>
<p>รูป: การตรวจสอบไฟล์ลิขสิทธิ์ก่อนใช้งานโดย <strong>Gowin License Manager</strong></p>
<p>เปิดใช้งาน <strong>Gowin EDA Standard Edition</strong> ภายใต้การทำงานของ
<strong>Ubuntu 22.04 LTS</strong> </p>
<p>คลิกเลือกทำขั้นตอน <strong>New Project ...</strong></p>
<p><img alt="" src="gowin_eda-1.png" /></p>
<p>รูป: หน้าต่างเริ่มต้น (<strong>Start Page</strong>) สำหรับการใช้งาน <strong>Gowin IDE</strong></p>
<p><img alt="" src="gowin_eda-2.png" /></p>
<p>รูป: กดปุ่ม <strong>OK</strong> เพื่อสร้างโปรเจกต์ใหม่สำหรับการออกแบบวงจรดิจิทัลเพื่อใช้งานกับชิป <strong>FPGA</strong></p>
<p><img alt="" src="gowin_eda-3.png" /></p>
<p>รูป: ระบุไดเรกทอรีของโปรเจกต์ใหม่ และชื่อของโปรเจกต์ (ในรูปตัวอย่าง ได้ใช้ชื่อโปรเจกต์ <code>led_blink</code>) </p>
<p><img alt="" src="gowin_eda-4.png" /></p>
<p>รูป: เลือกชิป <strong>FPGA</strong> ที่ต้องการใช้งาน (เลือก <strong>Device</strong>: <code>GW1N-1</code>,
<strong>IC Package</strong>: <code>QFN48</code>, <strong>Speed</strong>: <code>C6/I5</code>, <strong>Voltage</strong>: <code>LV</code>) </p>
<p><img alt="" src="gowin_eda-5.png" /></p>
<p>รูป: สรุปรายละเอียดในภาพรวม ก่อนการสร้างโปรเจกต์ใหม่</p>
<p><img alt="" src="gowin_eda-6.png" /></p>
<p>รูป: หน้าต่างหลักของ <strong>Gowin IDE</strong> หลังจากที่ได้มีการสร้างและเปิดโปรเจกต์ใหม่แล้ว</p>
<p>&nbsp;</p>
<p>ถัดไปให้เพิ่มไฟล์ <strong>Source Code</strong> เช่น <strong>VHDL</strong> หรือจะเป็น <strong>Verilog / SystemVerilog</strong>
แต่ในตัวอย่างนี้ จะเป็นโค้ดภาษา <strong>VHDL</strong> ที่ทำให้ <strong>RGB LED</strong> ซึ่งมีขาควบคุม 3 ขา
มีแสงสีแดง เขียว และ น้ำเงิน ติดดับสลับกันไปตามลำดับ</p>
<p><img alt="" src="gowin_eda-7.png" /></p>
<p>รูป: การสร้างไฟล์ใหม่ โดยเลือกเป็นไฟล์ <strong>VHDL</strong> ใส่ไว้ในโปรเจกต์ แล้วเพิ่มโค้ดตามตัวอย่าง </p>
<pre><code class="language-vhdl">------------------------------------------------------------------
library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;
------------------------------------------------------------------

entity LED_BLINK is
  generic (
     CLK_HZ : natural := 24000000
  );
  port(
     CLK  : in std_logic; -- system clock
     nRST : in std_logic; -- global asynchronous reset (active-low)
     LEDS : out std_logic_vector(2 downto 0) -- RGB LED Pins
  );
end LED_BLINK;

architecture SYNTH of LED_BLINK is
  constant COUNT_PERIOD : integer := CLK_HZ/10;
  subtype count_t is integer range 0 to (COUNT_PERIOD-1); 
  signal  count : count_t := 0;
  signal  leds_reg : std_logic_vector(2 downto 0);
  signal  shift_en : std_logic;

begin

  LEDS &lt;= not leds_reg; -- use the register's bits (inverted) for LEDs

  process (nRST, CLK) begin
    if nRST = '0' then
      count &lt;= 0;
      shift_en &lt;= '0';
    elsif rising_edge(CLK) then
      -- check whether the counter reaches the max. value.
      if count = (COUNT_PERIOD-1) then 
        count &lt;= 0;       -- reset the counter.
        shift_en &lt;= '1';  -- enable register shift.
      else
        count &lt;= count+1; -- increment counter by 1.
        shift_en &lt;= '0';  -- disable register shift.
      end if;
    end if;
  end process;

  process (nRST, CLK) begin
    if nRST = '0' then
      leds_reg &lt;= &quot;001&quot;; -- initialize the RGB_LED register
    elsif rising_edge(CLK) then
      if  shift_en='1' then -- register shifting is enabled.  
        -- shift left
        leds_reg &lt;= leds_reg(1 downto 0) &amp; leds_reg(2); 
      end if;
    end if;
  end process;

end SYNTH;
</code></pre>
<p><img alt="" src="gowin_eda-8.png" /></p>
<p>รูป: ทำขั้นตอน <strong>Synthesize</strong> เพื่อแปลงโค้ด <strong>VHDL</strong> ให้เป็นวงจรดิจิทัลในระดับล่าง
โดยใช้ทรัพยากรภายในชิป <strong>FPGA</strong></p>
<p><img alt="" src="gowin_eda-9.png" /></p>
<p>รูป: เพิ่มไฟล์ <strong>Physical Constraint File (.cst)</strong> 
สำหรับวงจรดิจิทัลในโปรเจกต์ เพื่อกำหนดคุณสมบัติหรือการเลือกใช้ขา <strong>I/O Pins</strong> ของชิป <strong>FPGA</strong></p>
<p><img alt="" src="gowin_eda-10.png" /></p>
<p>รูป: ตัวอย่างข้อความในไฟล์ <code>led_blink.cst</code> เพื่อเลือกใช้ขา <strong>I/O Pins</strong></p>
<pre><code class="language-text">IO_LOC &quot;CLK&quot;     35;
IO_LOC &quot;nRST&quot;    15;
IO_LOC &quot;LEDS[0]&quot; 16;
IO_LOC &quot;LEDS[1]&quot; 17;
IO_LOC &quot;LEDS[2]&quot; 18;

IO_PORT &quot;CLK&quot; IO_TYPE=LVCMOS33; 
IO_PORT &quot;nRST&quot; IO_TYPE=LVCMOS33 PULL_MODE=UP; 
IO_PORT &quot;LEDS[0]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;LEDS[1]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;LEDS[2]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
</code></pre>
<p>จากนั้นให้ทำขั้นตอน <strong>Synthesize</strong> และตามด้วย <strong>Place &amp; Route</strong>
แล้วลองดูรายงานสรุปผลการดำเนินการ เช่น <strong>Synthesis Report</strong>
และ <strong>Place &amp; Route Report</strong></p>
<p><img alt="" src="gowin_eda-11.png" /></p>
<p>รูป: ตัวอย่างตารางแสดงข้อมูลเกี่ยวกับการใช้ทรัพยากรของชิป <strong>FPGA</strong> ในการสร้างวงจรดิจิทัล</p>
<p>ถ้าต้องการกำหนดเงื่อนไขเชิงเวลาสำหรับการสังเคราะห์และวิเคราะห์วงจรดิจิทัล เช่น กำหนดคาบเวลาหรือความถี่ของสัญญาณอินพุต
<strong>CLK</strong> ของวงจร ก็มีตัวอย่างดังนี้</p>
<p>เลือกจากเมนูคำสั่ง <strong>Tools &gt; Timing Constraints Editor</strong></p>
<p><img alt="" src="timing_constraints-1.png" /></p>
<p>รูป: เปิดใช้งาน <strong>Timing Constraints Editor</strong></p>
<p><img alt="" src="timing_constraints-2.png" /></p>
<p>รูป: คลิกเลือกสัญญาณ <strong>CLK</strong> จากรายการชื่อสัญญาณอินพุต-เอาต์พุตของวงจร</p>
<p><img alt="" src="timing_constraints-3.png" /></p>
<p>รูป: กำหนดคาบสัญญาณ (<strong>Period</strong>) หรือ  ความถี่ (<strong>Frequency</strong>) ของสัญญาณ <strong>CLK</strong>
(ในตัวอย่างได้กำหนดความถี่ไว้ <strong>25 MHz</strong> ซึ่งสูงกว่า <strong>24MHz Crystal Oscillator</strong> บนบอร์ด <strong>Tang Nano</strong>)</p>
<p>จากนั้นให้ทำขั้นตอน <strong>Synthesize</strong> และ <strong>Place &amp; Route</strong>
ใหม่อีกครั้ง แล้วเปิดดูไฟล์รายงาน <strong>Timing Analysis Report</strong>
เช่น ดูว่าวงจรดิจิทัลที่ได้สามารถทำงานด้วยความถี่สูงกว่า <strong>25MHz</strong> หรือไม่
และได้ความถี่สูงสุดเท่าไหร่ (<strong>Max Frequency: Fmax</strong>)</p>
<hr />
<h2 id="bitstream-openfpgaloader">&#9655; <strong>การอัปโหลดไฟล์ Bitstream โดยใช้โปรแกรม OpenFPGALoader</strong><a class="headerlink" href="#bitstream-openfpgaloader" title="Permanent link">#</a></h2>
<p>จากการทดลองใช้งานซอฟต์แวร์ของ <strong>Gowin</strong> ในเวอร์ชัน <strong>Linux</strong> ในขั้นตอนการอัปโหลดไฟล์ <strong>Bitstream</strong> ไปยังบอร์ด <strong>FPGA</strong>
โปรแกรม <strong>Gowin Programmer</strong> ไม่สามารถมองเห็นบอร์ด <strong>Tang Nano</strong> ที่เชื่อมต่อกับคอมพิวเตอร์ผู้ใช้
ในกรณีนี้จึงแนะนำให้ใช้ซอฟต์แวร์ <strong>Open Source</strong> ที่สามารถใช้งานแทนได้คือ <a href="https://github.com/trabucayre/openFPGALoader"><strong>openFPGALoader</strong></a></p>
<p>อีกทางเลือกหนึ่งคือ การดาวน์โหลดโปรแกรม <strong>Gowin Programmer for Windows</strong> 
โดยสำเนาไฟล์ <strong>.fs</strong> ในโปรเจกต์ จาก <strong>Ubuntu</strong> มาใช้ใน <strong>Windows</strong></p>
<p>ขั้นตอนการติดตั้ง <strong>openFPGALoader</strong> สำหรับ <strong>Linux / Ubuntu</strong> โดยการคอมไพล์จากซอร์สโค้ด มีดังนี้</p>
<pre><code class="language-bash">$ sudo apt install -y libftdi1-2 libftdi1-dev \
  libhidapi-hidraw0 libhidapi-dev libudev-dev \
  zlib1g-dev cmake pkg-config make g++

$ git clone https://github.com/trabucayre/openFPGALoader.git
$ cd openFPGALoader &amp;&amp; mkdir -p build &amp;&amp; cd build
$ cmake ../ &amp;&amp; cmake --build .
$ sudo make install

# Show the openFPGALoader version (v0.10.0)
$ openFPGALoader -V
</code></pre>
<p>ขั้นตอนถัดไปคือ การเชื่อมต่อบอร์ด <strong>Tang Nano</strong> เข้ากับพอร์ต <strong>USB</strong>
ของคอมพิวเตอร์ผู้ใช้ แล้วทำคำสั่งใน <strong>Linux</strong> เพื่อตรวจสอบดูว่า พบอุปกรณ์หรือไม่
(มองเห็นเป็นอุปกรณ์ <strong>USB Device</strong> ที่ทำหน้าที่ "เลียนแบบ" ชิป <strong>FTDI FT2232</strong>)</p>
<pre><code class="language-bash">$ lsusb | grep &quot;0403:6010&quot;

Bus 002 Device 003: ID 0403:6010 Future Technology Devices International, 
Ltd FT2232C/D/H Dual UART/FIFO IC
</code></pre>
<p>ทำคำสั่งเพื่อตรวจสอบดูว่า พบชิป <strong>FPGA</strong> ที่เชื่อมต่อผ่านทาง <strong>JTAG Interface</strong> หรือไม่</p>
<pre><code class="language-bash">$ sudo openFPGALoader --detect --freq 2000000

No cable or board specified: using direct ft2232 interface
Jtag frequency : requested 2.00MHz   -&gt; real 2.00MHz  
index 0:
    idcode 0x900281b
    manufacturer Gowin
    family GW1N
    model  GW1N-1
    irlength 8
</code></pre>
<p>ทำคำสั่งเพื่ออัปโหลดไฟล์ <strong>Bitstream</strong> ไปยังชิป <strong>FPGA</strong> ในโหมด <strong>SRAM</strong></p>
<pre><code class="language-bash"># Upload the bitstream file to the SRAM of the FPGA.
$ sudo openFPGALoader -b tangnano --freq 2000000 -m \
  ./led_blink/impl/pnr/led_blink.fs
</code></pre>
<p><img alt="" src="tang_nano_breadboard.jpg" /></p>
<p>รูป: บอร์ด <strong>Tang Nano FPGA</strong> ที่ได้นำมาทดลองจริง (ควบคุมการทำงานของ <strong>Onboard RGB LED</strong>)</p>
<p>ข้อสังเกต: </p>
<ul>
<li>การอัปโหลดไฟล์ <strong>Bitstream</strong> ด้วย <strong>openFPGALoader</strong> ไปยัง <strong>Embedded Flash</strong>
ภายในชิป <strong>GW1N-1 FPGA</strong> (ชิป <strong>CH552T</strong> บนบอร์ดทำหน้าที่เป็น <strong>USB-JTAG</strong>) ดูเหมือนว่าจะใช้ไม่ได้
ดังนั้นแนะนำให้ใช้ซอฟต์แวร์ <strong>Gown Programmer 2 v2.09426 Beta (Windows), updated: 2019-12-06</strong> </li>
<li>บอร์ด <strong>Sipeed Tang Nano 1K</strong> และรุ่นอื่น ๆ ที่ใหม่กว่า ได้มีการเปลี่ยนมาใช้ชิป เช่น <strong>BL702</strong>
ซึ่งทำงานได้มีประสิทธิภาพดีกว่า <strong>CH552T</strong></li>
</ul>
<p>&nbsp;</p>
<p>หากต้องการจะลองใช้โมดูล <strong>RGB LED</strong> แทนการใช้งาน <strong>Onboard RGB LED</strong> ก็ทำได้เช่นกัน
ในตัวอย่างนี้ได้เลือกใช้โมดูล <strong>RGB LED</strong> ที่ทำงานแบบ <strong>Active-High</strong> 
และได้เลือกใช้ขาหมายเลข <strong>38</strong>, <strong>39</strong> และ ** 40<strong> ของบอร์ด </strong>Tang Nano FPGA<strong> เป็นขาสัญญาณควบคุม
และต่อขา </strong>GND<strong> ร่วมกันในวงจรบนเบรดบอร์ด  เมื่อกำหนดหมายเลขขาให้ตรงตามรูปแบบการต่อวงจรจริงแล้ว
ให้ทำขั้นตอน </strong>Synthesize<strong> และ </strong>Place &amp; Route<strong> อีกครั้ง เพื่อสร้างไฟล์ </strong>.fs<strong> ใหม่อีกครั้ง แล้วจึงนำไปทดลองใช้กับบอร์ด </strong>FPGA**</p>
<p><img alt="" src="tang_nano_rgb_led_active_high.jpg" /></p>
<p>รูป: ตัวอย่างการใช้โมดูลภายนอก <strong>RGB LED (active-high)</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="gowin-eda-ubuntu-vm">&#9655; <strong>การใข้งาน Gowin EDA ภายใต้ Ubuntu VM</strong><a class="headerlink" href="#gowin-eda-ubuntu-vm" title="Permanent link">#</a></h2>
<p>อีกทางเลือกหนึ่งคือ การสร้าง <strong>Ubuntu VM (Virtual Machine)</strong> 
โดยใช้ <strong>Oracle VirtualBox</strong> สำหรับผู้ใช้ <strong>Windows (Host OS)</strong> 
และติดตั้งซอฟต์แวร์ <strong>Gowin IDE (Linux / Ubuntu)</strong></p>
<p><img alt="" src="virtualbox_ubuntu_gowin_eda.png" /></p>
<p>รูป: ตัวอย่างการใช้งาน <strong>Gowin EDA</strong> ใน <strong>Ubuntu Desktop 22.04 LTS VM</strong></p>
<p>ผู้ใช้สามารถกำหนดค่า <strong>MAC Addresss (NIC)</strong> ของ  <strong>Ubuntu VM</strong>
สำหรับอินเทอร์เฟสชื่อ <code>enp0s3</code> (<strong>VirtualBox Host-Only Network</strong>)
ได้ตามต้องการ เช่น ตั้งค่าให้ตรงกับ <strong>NIC</strong> ที่มีการระบุไว้ในไฟล์ลิขสิทธิ์
โดยใช้คำสั่งในลักษณะนี้ (<code>XX:XX:XX:XX:XX:XX</code> หมายถึง <strong>MAC Address</strong>)</p>
<pre><code class="language-bash"># Install the 'net-tools for 'ifconfig'
$ sudo apt install net-tools -y

# Turn off the 'enp0s3' network interface
$ sudo ifconfig enp0s3 down

# Change the MAC address of the 'enp0s3' interface
$ sudo ifconfig enp0s3 hw ether XX:XX:XX:XX:XX:XX

# Turn on the 'enp0s3' interface
$ sudo ifconfig enp0s3 up
</code></pre>
<p>นอกจากนั้นแล้วแนะนำให้ตั้งค่าการแชร์ไดเรกทอรี ระหว่าง <strong>Host OS (Windows)</strong> 
กับ <strong>Ubuntu VM</strong> เพื่อทำให้การสำเนาไฟล์ระหว่างระบบไฟล์ทั้งสองทำได้ง่ายขึ้น</p>
<p><img alt="" src="virtualbox_vm_shared_folder.png" /></p>
<p>รูป: ตัวอย่างการตั้งค่าเพื่อแชร์ไฟล์สำหรับ <strong>VirtualBox / Ubuntu VM</strong></p>
<p><img alt="" src="gowin_programmer_windows.png" /></p>
<p>รูป: ตัวอย่างการใช้ <strong>Gowin Programmer Standard Edition for Windows</strong>
เพื่ออัปโหลดไฟล์ <strong>Bitstream (.fs)</strong> ไปยังบอร์ด <strong>Tang Nano FPGA</strong>
ในโหมด <strong>SRAM Access Mode: SRAM Program</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="8x-led-bargraph">&#9655; **ตัวอย่างโค้ด: 8x LED Bargraph **<a class="headerlink" href="#8x-led-bargraph" title="Permanent link">#</a></h2>
<p>อีกตัวอย่างหนึ่งเป็นโค้ด <strong>VHDL</strong> สาธิตการกำหนดค่าลอจิกให้อาร์เรย์ของ <strong>LED</strong> จำนวน 8 ตำแหน่ง
(<strong>8x LED Bar</strong>) และทำงานแบบ <strong>Active-Low</strong> เริ่มต้นทุกดวงจะมีสถานะเป็น <strong>OFF</strong>
และจะเริ่มเปลี่ยนเป็นสถานะ <strong>ON</strong> ทีละดวงตามลำดับจนครบ 8 ดวง แล้วดับลงทุกดวง และทำซ้ำ </p>
<pre><code class="language-vhdl">------------------------------------------------------------------
library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;
------------------------------------------------------------------

entity LED_BARGRAPH is
  generic (
     CLK_HZ : natural := 24000000;
     WIDTH  : natural := 8 
  );
  port(
     CLK  : in std_logic; -- system clock
     nRST : in std_logic; -- acive-low asynchronous reset
     LEDS : out std_logic_vector(WIDTH-1 downto 0)
  );
end LED_BARGRAPH;

architecture SYNTH of LED_BARGRAPH is
  constant ALL_ONES     : unsigned := to_unsigned(2**WIDTH-1,WIDTH);
  constant COUNT_PERIOD : integer := CLK_HZ/8;
  subtype count_t is integer range 0 to (COUNT_PERIOD-1); 
  signal  count : count_t := 0;
  signal  reg   : std_logic_vector(WIDTH-1 downto 0);
  signal  shift_en : std_logic;

begin

  LEDS &lt;= not reg; -- Use the register's bits (inverted) for LEDs.

  process (nRST, CLK) begin
    if nRST = '0' then
      count &lt;= 0;
      shift_en &lt;= '0';
    elsif rising_edge(CLK) then
      -- check whether the counter reaches the max. value.
      if count = (COUNT_PERIOD-1) then 
        count &lt;= 0;       -- reset the counter.
        shift_en &lt;= '1';  -- enable register shift.
      else
        count &lt;= count+1; -- increment counter by 1.
        shift_en &lt;= '0';  -- disable register shift.
      end if;
    end if;
  end process;

  process (nRST, CLK) begin
    if nRST = '0' then
      reg &lt;= (others =&gt; '0'); -- clear the shift register.
    elsif rising_edge(CLK) then
      if  shift_en='1' then -- register shifting is enabled.  
        if reg = std_logic_vector( ALL_ONES ) then
          -- clear the shift register.
          reg &lt;= (others =&gt; '0'); 
        else
          -- shift left, insert '1' as LSB.
          reg &lt;= reg(reg'left-1 downto 0) &amp; '1'; 
        end if;
        end if;
    end if;
  end process;

end SYNTH;
</code></pre>
<p>ตัวอย่างการเลือกใช้ขา <strong>I/O Pins</strong> ของบอร์ด <strong>Tang Nano FPGA</strong>
เพื่อเชื่อมต่อกับโมดูล <strong>8x LED Bar</strong> มีดังนี้
(สร้างไฟล์ <code>led_bargraph.cst</code> ในโปรเจกต์ แล้วใส่ข้อความต่อไปนี้ลงในไฟล์)</p>
<pre><code class="language-text">IO_LOC &quot;CLK&quot;      35;
IO_LOC &quot;nRST&quot;     15;
IO_LOC &quot;LEDS[7]&quot;  38;
IO_LOC &quot;LEDS[6]&quot;  39;
IO_LOC &quot;LEDS[5]&quot;  40;
IO_LOC &quot;LEDS[4]&quot;  41;
IO_LOC &quot;LEDS[3]&quot;  42;
IO_LOC &quot;LEDS[2]&quot;  43;
IO_LOC &quot;LEDS[1]&quot;  44;
IO_LOC &quot;LEDS[0]&quot;  45;

IO_PORT &quot;CLK&quot; IO_TYPE=LVCMOS33; 
IO_PORT &quot;nRST&quot; IO_TYPE=LVCMOS33 PULL_MODE=UP; 
IO_PORT &quot;LEDS[0]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;LEDS[1]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;LEDS[2]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[3]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[4]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[5]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[6]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[7]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
</code></pre>
<p><img alt="" src="tang_nano_led_bargraph.png" /></p>
<p>รูป: การคอมไพล์โค้ดตัวอย่าง <strong>LED Bargraph</strong> และแปลงให้เป็นไฟล์ <strong>Bitstream</strong></p>
<p><img alt="" src="tang_nano_led_bargraph_breadboard-1.jpg" /></p>
<p><img alt="" src="tang_nano_led_bargraph_breadboard-2.jpg" /></p>
<p>รูป: ตัวอย่างการต่อวงจรโดยใช้โมดูล <strong>8x LED Bar</strong> บนเบรดบอร์ด</p>
<p>&nbsp;</p>
<p>อีกตัวอย่างหนึ่งที่มีการใช้ <strong>LED</strong> จำนวน 8 ดวง แต่มีพฤติกรรมที่แตกต่างไปเล็กน้อยคือ
การเลื่อนตำแหน่งของ <strong>LED</strong> ที่อยู่ในสถานะ <strong>ON</strong> ไปตามลำดับ 
เริ่มต้นจากบิต <strong>LSB</strong> เลื่อนไปทางบิต <strong>MSB</strong></p>
<pre><code class="language-vhdl">library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;

entity LED_RUNNING is
  generic (
     CLK_HZ : natural := 24000000;
     WIDTH  : natural := 8
  );
  port(
     CLK  : in std_logic; -- system clock
     nRST : in std_logic;  -- acive-high asynchronous reset
     LEDS : out std_logic_vector(WIDTH-1 downto 0)
  );
end LED_RUNNING;

architecture SYNTH of LED_RUNNING is
  constant COUNT_MAX: integer := (CLK_HZ/10) - 1;
  subtype count_t is integer range 0 to COUNT_MAX; 
  signal  count : count_t := 0;
  signal  leds_reg : std_logic_vector(2*WIDTH-1 downto 0);

begin

  LEDS &lt;= not leds_reg(WIDTH-1 downto 0); 

  process (nRST, CLK) 
  begin
    if nRST = '0' then
      count &lt;= 0;
      leds_reg(WIDTH-1 downto 0 ) &lt;= (others =&gt; '0');
      leds_reg(2*WIDTH-1 downto WIDTH) &lt;= (others =&gt; '1');
    elsif rising_edge(CLK) then
      if count = COUNT_MAX then 
        count &lt;= 0;       -- reset the counter.
        leds_reg &lt;= leds_reg(leds_reg'left-1 downto 0) 
                    &amp; leds_reg(leds_reg'left); 
      else
        count &lt;= count+1; -- increment counter by 1.
      end if;
    end if;
  end process;

end SYNTH;
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="4-digit-7-segment-display">&#9655; <strong>ตัวอย่างโค้ด: 4-Digit 7-Segment Display</strong><a class="headerlink" href="#4-digit-7-segment-display" title="Permanent link">#</a></h2>
<p>ตัวอย่างถัดไปสาธิตการเขียนโค้ด <strong>VHDL</strong> เพื่อแสดงตัวเลข 4 หลัก ที่มีการเริ่มต้นนับจาก <code>0000</code>
ไปจนถึง <code>9999</code> และมีการแสดงค่าตัวเลขโดยใช้โมดูล <strong>7-Segment Display</strong> จำนวน 4 หลัก (<strong>4 Digits</strong>)
โมดูลที่ได้เลือกมาใช้งาน มีวงจรทรานซิสเตอร์ควบคุมการทำงานของแต่ละหลักและทำงานแบบ <strong>Active-Low</strong></p>
<p>เนื่องจากว่าทั้ง 4 หลัก ต้องใช้ขาสัญญาณ <strong>A, B, C, D, E, F, G, DP</strong> ร่วมกัน เพื่อใช้ในการกำหนดสถานะลอจิก
<strong>ON/OFF</strong> ของ <strong>7-Segment</strong> ในแต่ละหลัก ดังนั้นจึงต้องใช้วิธีการที่เรียกว่า <strong>Time-Multiplexing</strong>
เพื่อควบคุมการทำงานของโมดูลแสดงผล</p>
<pre><code class="language-vhdl">library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;

entity DISP_4X7SEG_DEMO is
  generic( 
    CLK_HZ  : natural := 24000000
  );
  port(
    CLK      : in std_logic;
    nRST     : in std_logic;
    SEGMENTS : out std_logic_vector(7 downto 0);
    DIGITS   : out std_logic_vector(3 downto 0) 
 );
end DISP_4X7SEG_DEMO;

architecture SYNTH of DISP_4X7SEG_DEMO is
  constant NUM_DIGITS : natural := 4;
  constant CNT_MAX1   : natural := (CLK_HZ/400)-1;
  constant CNT_MAX2   : natural := (CLK_HZ/10)-1;

  type bcd_counter_t is array(0 to NUM_DIGITS-1) of integer range 0 to 9;
  signal bcd_count  : bcd_counter_t; 

  signal data_buf     : std_logic_vector(7 downto 0);
  signal digits_sel   : std_logic_vector(NUM_DIGITS-1 downto 0);
  signal digit_index  : natural range 0 to NUM_DIGITS-1 := 0;

  subtype nibble is unsigned(3 downto 0);
  -- This function implements a BCD to 7-Segment decoder.
  function BCD2SEG7( data: nibble ) return std_logic_vector is
     variable seg7bits : std_logic_vector(6 downto 0);
  begin
     case data is
        when &quot;0000&quot; =&gt; seg7bits := &quot;0111111&quot;; -- 0
        when &quot;0001&quot; =&gt; seg7bits := &quot;0000110&quot;; -- 1
        when &quot;0010&quot; =&gt; seg7bits := &quot;1011011&quot;; -- 2
        when &quot;0011&quot; =&gt; seg7bits := &quot;1001111&quot;; -- 3
        when &quot;0100&quot; =&gt; seg7bits := &quot;1100110&quot;; -- 4
        when &quot;0101&quot; =&gt; seg7bits := &quot;1101101&quot;; -- 5
        when &quot;0110&quot; =&gt; seg7bits := &quot;1111101&quot;; -- 6
        when &quot;0111&quot; =&gt; seg7bits := &quot;0000111&quot;; -- 7
        when &quot;1000&quot; =&gt; seg7bits := &quot;1111111&quot;; -- 8
        when &quot;1001&quot; =&gt; seg7bits := &quot;1101111&quot;; -- 9
        when others =&gt; seg7bits := &quot;0000000&quot;; -- off
     end case;
     return seg7bits;
  end BCD2SEG7;

begin

  -- This process implements a N-digit BCD counter.
  process (nRST,CLK)
    variable wait_cnt    : natural range 0 to CNT_MAX2 := 0;
    variable clk_enabled : boolean;
    variable carry       : boolean; 
  begin
    if nRST = '0' then
      wait_cnt := 0;
      for i in bcd_count'range loop
         bcd_count(i) &lt;= 0;
      end loop;
    elsif rising_edge(CLK) then 
       if wait_cnt = CNT_MAX2 then
          wait_cnt := 0;
          clk_enabled := true;
       else 
          wait_cnt := wait_cnt + 1;
          clk_enabled := false;
       end if;
       if clk_enabled then
          carry := true;
          for i in 0 to NUM_DIGITS-1 loop
             if carry then
                if bcd_count(i)=9 then
                   bcd_count(i) &lt;= 0;
                   carry := true;
                else
                   bcd_count(i) &lt;= bcd_count(i)+1;
                   carry := false;
                end if;
             else
                carry := false;
             end if;
          end loop;
       end if;
    end if;
  end process; 

  -- This process implements a N-digit 7-segment driver
  -- using time-multiplexing.
  process (nRST, CLK) 
    variable wait_cnt    : natural range 0 to CNT_MAX1 := 0;
    variable clk_enabled : boolean;
    variable bcd_value   : unsigned(3 downto 0);
  begin
    if nRST = '0' then
       wait_cnt := 0;
       data_buf    &lt;= x&quot;00&quot;;
       digits_sel  &lt;= (others =&gt; '0');
       digit_index &lt;= 0;
    elsif rising_edge(CLK) then     
       if wait_cnt = CNT_MAX1 then
          wait_cnt := 0;
          clk_enabled := true;
       else 
          wait_cnt := wait_cnt + 1;
          clk_enabled := false;
       end if;
       if clk_enabled then
          if digit_index = NUM_DIGITS-1 then 
             digit_index &lt;= 0;
          else 
             digit_index &lt;= digit_index + 1;
          end if;
          for i in 0 to NUM_DIGITS-1 loop
             if i = digit_index then
               digits_sel(i) &lt;= '1';
             else 
               digits_sel(i) &lt;= '0';
             end if;
          end loop;
          bcd_value := to_unsigned(bcd_count(digit_index),4);
          data_buf &lt;= '0' &amp; BCD2SEG7( bcd_value );
       end if;
    end if;
  end process;

  DIGITS   &lt;= (others =&gt; '1') when nRST = '0' else (not digits_sel);
  SEGMENTS &lt;= not data_buf; -- for common-anode 7-segment LEDs

end SYNTH;
</code></pre>
<p>ตัวอย่างการเลือกใช้ขา <strong>I/O Pins</strong> ของบอร์ด <strong>Tang Nano FPGA</strong>
เพื่อเชื่อมต่อกับโมดูล <strong>4-Digit 7-Segment Display</strong> มีดังนี้</p>
<pre><code class="language-text">IO_LOC &quot;CLK&quot;          35;
IO_LOC &quot;nRST&quot;         15;
IO_LOC &quot;SEGMENTS[0]&quot;  42;
IO_LOC &quot;SEGMENTS[1]&quot;  43;
IO_LOC &quot;SEGMENTS[2]&quot;  44;
IO_LOC &quot;SEGMENTS[3]&quot;  45;
IO_LOC &quot;SEGMENTS[4]&quot;  11;
IO_LOC &quot;SEGMENTS[5]&quot;  10;
IO_LOC &quot;SEGMENTS[6]&quot;  46;
IO_LOC &quot;SEGMENTS[7]&quot;   5;
IO_LOC &quot;DIGITS[3]&quot;    38;
IO_LOC &quot;DIGITS[2]&quot;    39;
IO_LOC &quot;DIGITS[1]&quot;    40;
IO_LOC &quot;DIGITS[0]&quot;    41;

IO_PORT &quot;CLK&quot;  IO_TYPE=LVCMOS33; 
IO_PORT &quot;nRST&quot; IO_TYPE=LVCMOS33 PULL_MODE=UP; 
IO_PORT &quot;SEGMENTS[0]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;SEGMENTS[1]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;SEGMENTS[2]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;SEGMENTS[3]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;SEGMENTS[4]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;SEGMENTS[5]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;SEGMENTS[6]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;SEGMENTS[7]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;DIGITS[0]&quot;   IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;DIGITS[1]&quot;   IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;DIGITS[2]&quot;   IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;DIGITS[3]&quot;   IO_TYPE=LVCMOS33 DRIVE=8;
</code></pre>
<p>&nbsp;</p>
<p>ข้อสังเกต: หากต้องการใช้งานขา <strong>I/O</strong> บางขาของ <strong>FPGA</strong> ที่ถูกจัดว่าเป็น <strong>Dual-Purpose Pins</strong>
จะต้องมีการตั้งค่าเพื่อให้อนุญาตใช้งานเป็น <strong>I/O Pins</strong> ก่อน จึงจะใช้งานได้</p>
<p><img alt="" src="gowin_eda_use_dual_func_pins.png" /></p>
<p>รูป: ตัวอย่างการตั้งค่าสำหรับ <strong>Project Configuration &gt; Place &amp; Route &gt; Dual-Purpose Pin</strong></p>
<p><img alt="" src="tang_nano_breadboard_4digits_7seg.jpg" /></p>
<p>รูป: ตัวอย่างการต่อวงจรบนเบรดบอร์ดเพื่อใช้งานโมดูล <strong>4-Digit 7-Segment Display</strong> ร่วมกับบอร์ด <strong>Tang Nano FPGA</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="rotary-encoder-switch-8x-led-bar">&#9655; <strong>ตัวอย่างโค้ด: Rotary Encoder Switch + 8x LED Bar</strong><a class="headerlink" href="#rotary-encoder-switch-8x-led-bar" title="Permanent link">#</a></h2>
<p>ตัวอย่างถัดไปเป็นโค้ด <strong>VHDL</strong> สาธิตการตรวจสอบการหมุนปุ่มของโมดูล <strong>Rotary Encoder Switch</strong>
ที่ให้ขาสัญญาณเอาต์พุต <strong>A</strong> และ <strong>B</strong> เมื่อไม่มีการหมุน ค่าลอจิกของ <strong>A</strong> และ <strong>B</strong> จะเป็น <strong>1</strong> (High)
แต่ถ้ามีการหมุนปุ่ม จะทำให้ค่าลอจิกของขาสัญญาณ <strong>A</strong> และ <strong>B</strong> เปลี่ยนแปลง และสลับช่วงเวลากัน</p>
<p>ในตัวอย่างนี้ สัญญาณ <strong>A</strong> และ <strong>B</strong> ของโมดูลจะถูกนำไปใช้เป็นขาสัญญาณอินพุตของวงจรดิจิทัลใน <strong>FPGA</strong>
การหมุนปุ่มของโมดูลตามเข็มหรือทวนเข็ม จะถูกนำมาใช้เป็นเงื่อนไขในการเพิ่มหรือลดค่าของระดับในการแสดงผลของ
<strong>LED Bar</strong> ซึ่งมีทั้งหมด 8 ดวง และทำงานแบบ <strong>Active-Low</strong></p>
<pre><code class="language-vhdl">library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;

entity ROTARY_SW_LEDS is
  generic( 
    CLK_HZ : natural := 24000000
  );
  port( 
    CLK   : in std_logic; 
    nRST  : in std_logic;
    SW_A  : in std_logic; 
    SW_B  : in std_logic;
    LEDS  : out std_logic_vector( 7 downto 0 ) 
  ); 
end ROTARY_SW_LEDS;

architecture behave of ROTARY_SW_LEDS is
  constant CNT_MAX : natural := (CLK_HZ/500)-1;
  signal capture   : std_logic_vector(3 downto 0) := (others =&gt; '1');
  signal update    : std_logic := '0';
  signal change    : std_logic := '0';
  signal inc, dec  : std_logic := '0';
  signal level     : unsigned( 7 downto 0) := (others =&gt; '0');

begin
  -- This process implements switch debouncing logic.
  P1: process (nRST, CLK)
    variable wait_cnt : natural range 0 to CNT_MAX := 0;
  begin
     if nRST = '0' then
        wait_cnt := 0;
        capture &lt;= (others =&gt; '1');
        update &lt;= '0';
     elsif rising_edge(CLK) then
        if wait_cnt = CNT_MAX then 
          wait_cnt := 0;
          update  &lt;= '1';
          capture &lt;= capture(1 downto 0) &amp; (SW_A &amp; SW_B);
        else
          wait_cnt := wait_cnt + 1;
          update &lt;= '0';
        end if;

     end if;
  end process;

  -- Detect the falling edge on the captured SW_A signal.
  change &lt;= capture(3) and (not capture(1));
  inc &lt;= change and (not capture(0));  -- Enable counter increment.
  dec &lt;= change and capture(0);        -- Enable counter decrement.

  -- This process implements the LED level indicator.
  P2: process (nRST, CLK)
  begin
     if nRST = '0' then
       level &lt;= (others =&gt; '0');
     elsif rising_edge(CLK) then
       if update = '1' then   -- Update the LED level.
         if inc = '1' then    -- Increment the LED level.
            level &lt;= level(6 downto 0) &amp; '1';
         elsif dec = '1' then -- Decrement the LED level.
            level &lt;= '0' &amp; level(7 downto 1);
         end if;
       end if;
     end if;
  end process;

  -- Output the LED level to the 8-bit LED bar (active-low).
  LEDS &lt;= not std_logic_vector(level);

end behave;
</code></pre>
<p>ตัวอย่างการเลือกใช้ขา <strong>I/O Pins</strong> ของบอร์ด <strong>Tang Nano FPGA</strong>
เพื่อเชื่อมต่อกับโมดูล <strong>8x LED Bar</strong> และโมดูล <strong>Rotary Encoder Switch</strong> มีดังนี้</p>
<pre><code class="language-text">IO_LOC &quot;CLK&quot;      35;
IO_LOC &quot;nRST&quot;     15;
IO_LOC &quot;LEDS[7]&quot;  38;
IO_LOC &quot;LEDS[6]&quot;  39;
IO_LOC &quot;LEDS[5]&quot;  40;
IO_LOC &quot;LEDS[4]&quot;  41;
IO_LOC &quot;LEDS[3]&quot;  42;
IO_LOC &quot;LEDS[2]&quot;  43;
IO_LOC &quot;LEDS[1]&quot;  44;
IO_LOC &quot;LEDS[0]&quot;  45;
IO_LOC &quot;SW_A&quot;     10;
IO_LOC &quot;SW_B&quot;     46;

IO_PORT &quot;CLK&quot; IO_TYPE=LVCMOS33; 
IO_PORT &quot;nRST&quot; IO_TYPE=LVCMOS33 PULL_MODE=UP; 
IO_PORT &quot;LEDS[0]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;LEDS[1]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;LEDS[2]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[3]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[4]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[5]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[6]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;LEDS[7]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
IO_PORT &quot;SW_A&quot;    IO_TYPE=LVCMOS33;
IO_PORT &quot;SW_B&quot;    IO_TYPE=LVCMOS33;
</code></pre>
<p><img alt="" src="tang_nano_breadboard_rotary_encoder.jpg" /></p>
<p>รูป: ตัวอย่างการต่อวงจรโดยใช้โมดูล <strong>8x LED Bar</strong> และ <strong>Rotary Encoder Switch</strong> บนเบรดบอร์ด</p>
<p><img alt="" src="pulseview_rotary_encoder_sw-1.png" /></p>
<p><img alt="" src="pulseview_rotary_encoder_sw-2.png" /></p>
<p>รูป: ตัวอย่างการบันทึกสัญญาณด้วย <strong>USB Logic Analyzer</strong> และแสดงผลด้วย <strong>PulseView</strong>
(แบ่งเป็น 2 กรณี คือ หมุนตามเข็ม และ หมุนทวนเข็มนาฬิกา)</p>
<p>&nbsp;</p>
<hr />
<p>&nbsp;</p>
<p><strong>แหล่งข้อมูลสำหรับอ้างอิงและศึกษาเพิ่มเติม</strong></p>
<ul>
<li><a href="https://tangnano.sipeed.com/en/">https://tangnano.sipeed.com/en/</a></li>
<li><a href="https://wiki.sipeed.com/hardware/en/tang/">https://wiki.sipeed.com/hardware/en/tang/</a></li>
<li><a href="https://dl.sipeed.com/shareURL/TANG/Nano/">https://dl.sipeed.com/shareURL/TANG/Nano/</a></li>
<li><a href="https://github.com/sipeed/Tang-Nano-examples">https://github.com/sipeed/Tang-Nano-examples/</a></li>
<li><a href="https://trabucayre.github.io/openFPGALoader/vendors/gowin.html">https://trabucayre.github.io/openFPGALoader/vendors/gowin.html</a></li>
</ul>
<hr />
<h2 id="_1">&#9655; <strong>กล่าวสรุป</strong><a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<p>บทความนี้ได้นำเสนอการใช้ซอฟต์แวร์ <strong>Gowin EDA - Standard Edition (V1.9.9Beta-2)</strong> ในระบบปฏิบัติการ <strong>Ubuntu 22.04 LTS</strong>
เพื่อลองเขียนโค้ด <strong>VHDL</strong> แล้วแปลงให้เป็นไฟล์ <strong>Bitstream</strong> สำหรับบอร์ด <strong>Tang Nano FPGA</strong>
และได้ลองใช้โปรแกรม <strong>OpenFPGALoader</strong> (Open Source) เพื่ออัปโหลดไฟล์ <strong>Bitstream</strong>
ไปยังชิปบนบอร์ด <strong>FPGA</strong></p>
<p>ในบทความนี้ยังได้นำเสนอตัวอย่างโค้ด <strong>VHDL</strong> ที่สามารถนำไปทดลองใช้งานได้ เช่น การใช้งานร่วมกับโมดูล <strong>RGB LED</strong>
โมดูล <strong>8-bit LED Bar</strong> โมดูล <strong>4-Digit 7-Segment Display</strong> 
และโมดูล <strong>Rotary Encoder Switch</strong> เป็นต้น</p>
<p>จุดเด่นของ <strong>Gowin EDA</strong> จากที่ผู้เขียนได้ทดลองใช้งาน คือ ขั้นตอนการคอมไพล์โค้ดและแปลงให้เป็นไฟล์ <strong>Bitstream</strong> สามารถทำได้อย่างรวดเร็ว
ภายในไม่มีวินาที และการติดตั้งซอฟต์แวร์ต้องการความจุในฮาร์ดดิสก์ประมาณ <strong>1.2GB</strong> </p>
<p>&nbsp;</p>
<hr />
<p><em>This work is licensed under a</em> <strong><em>Creative Commons Attribution-ShareAlike 4.0 International License.</em></strong></p>
<p>Created: 2023-07-21 | Last Updated: 2023-08-04</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021-2024 IoT Engineering Education, Bangkok/Thailand</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
