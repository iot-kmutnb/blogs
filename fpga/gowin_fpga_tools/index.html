<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="RSP">
        <link rel="canonical" href="https://iot-kmutnb.github.io/blogs/fpga/gowin_fpga_tools/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>การใช้งานซอฟต์แวร์ Open Source FPGA Design Tools สำหรับบอร์ด Sipeed Tang Nano - IoT Engineering Education</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../css/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/arduino.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/javascript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/vhdl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/verilog.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/text.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/plaintext.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/matlab.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/julia.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-966FQ6RN6W"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', "G-966FQ6RN6W");
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">IoT Engineering Education</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#open-source-fpga-design-tools-sipeed-tang-nano" class="nav-link">การใช้งานซอฟต์แวร์ Open Source FPGA Design Tools สำหรับบอร์ด Sipeed Tang Nano</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#gowin-eda-sipeed-tang-nano" class="nav-link">&#9655; ซอฟต์แวร์ Gowin EDA สำหรับบอร์ด Sipeed Tang Nano</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#open-source-fpga-design-tools" class="nav-link">&#9655; ซอฟต์แวร์ Open Source FPGA Design Tools</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#yosys-project" class="nav-link">&#9655; การติดตั้งโปรแกรมของ Yosys Project</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#ghdl-ghdl-yosys-plugin" class="nav-link">&#9655; การติดตั้งโปรแกรม GHDL และ GHDL-Yosys Plugin</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#apicula-project" class="nav-link">&#9655; การติดตั้งโปรแกรมของ Apicula Project</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#nextpnr-project" class="nav-link">&#9655; การติดตั้งโปรแกรมของ Nextpnr Project</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#openfpgaloader-project" class="nav-link">&#9655; การติดตั้งโปรแกรมของ openFPGALoader Project</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#sipeed-tang-nano-1k" class="nav-link">&#9655; การทดลองโดยใช้บอร์ด Sipeed Tang Nano 1K</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#sipeed-tang-nano-9k" class="nav-link">&#9655; การทดลองโดยใช้บอร์ด Sipeed Tang Nano 9K</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_1" class="nav-link">&#9655; แหล่งข้อมูลอ้างอิงและศึกษาเพิ่มเติม</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_2" class="nav-link">&#9655; กล่าวสรุป</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="open-source-fpga-design-tools-sipeed-tang-nano">การใช้งานซอฟต์แวร์ Open Source FPGA Design Tools สำหรับบอร์ด Sipeed Tang Nano<a class="headerlink" href="#open-source-fpga-design-tools-sipeed-tang-nano" title="Permanent link">#</a></h1>
<p><strong>Keywords</strong>: <em>Gowin FPGA</em>, <em>Sipeed Tang Nano</em></p>
<hr />
<h2 id="gowin-eda-sipeed-tang-nano">&#9655; <strong>ซอฟต์แวร์ Gowin EDA สำหรับบอร์ด Sipeed Tang Nano</strong><a class="headerlink" href="#gowin-eda-sipeed-tang-nano" title="Permanent link">#</a></h2>
<p>บอร์ด <strong>Sipeed Tang Nano</strong> เป็นบอร์ดที่มีชิป <strong>FPGA</strong> ของบริษัท <strong>Gowin Semiconductor</strong>
และมีบอร์ดให้เลือกใช้หลายรุ่น เช่น <strong>Sipeed Tang Nano 1K / 4K / 9K / 20K</strong>
และ <strong>Tang Primer 20K</strong> (โดยเรียงตามความจุเชิงลอจิกจากน้อยไปมาก)</p>
<p><img alt="" src="../tang_nano/gowin_eda_design_flow.png" /></p>
<p>รูป: <strong>Gowin FPGA Design Flow</strong> (Source: Gowin Semiconductor)</p>
<p><img alt="" src="../tang_nano/sipeed_tang_nano_boards.png" /></p>
<p>รูป: ตัวอย่างบอร์ด <strong>Tang Nano Series: 1K / 4K / 9K / 20K</strong> (Source: Sipeed)</p>
<p>บอร์ด <strong>Sipeed Tang Nano: FPGA Device / Package</strong></p>
<ul>
<li><code>tangnano</code>: <strong>GW1N-LV1</strong> / <strong>QN48</strong></li>
<li><code>tangnano1k</code>: <strong>GW1NZ-LV1</strong> / <strong>QN48C6/I5</strong></li>
<li><code>tangnano4k</code>: <strong>GW1NSR-L4</strong> / <strong>QN48</strong> </li>
<li><code>tangnano9k</code>: <strong>GW1NR-LV9</strong> / <strong>QN88PC6/I5</strong> </li>
<li><code>tangnano20k</code>: <strong>GW2AR-LV18</strong> / <strong>QN88</strong></li>
<li><code>tangprimer20k</code>: <strong>GW2A-LV18</strong> / <strong>BGA256C8/I7</strong></li>
</ul>
<p>โดยปรกติแล้ว การออกแบบวงจรดิจิทัลสำหรับการนำไปใช้กับชิป <strong>FPGA</strong> ของบริษัท <strong>Gowin</strong> 
จะต้องใช้ซอฟต์แวร์ของบริษัทผู้ผลิต ซึ่งในกรณีนี้ก็คือ ซอฟต์แวร์ <a href="https://www.gowinsemi.com/en/support/download_eda/"><strong>Gowin (EDA) IDE</strong></a>
 (สำหรับระบบปฏิบัติการ <strong>Windows</strong> และ <strong>Linux</strong>) แบ่งเป็น 2 เวอร์ชัน
ได้แก่ <strong>Gowin Standard Edition</strong> และ <strong>Gowin Education Edition</strong>
(ตัวอย่างการใช้งานซอฟต์แวร์ <strong>Gowin</strong> สามารถศึกษาได้จากบทความนี้
<a href="../tang_nano/">"การใช้งานซอฟต์แวร์ <strong>Gowin IDE Standard Edition</strong>
สำหรับบอร์ด <strong>Sipeed Tang Nano</strong>"</a>) </p>
<p>แต่ในบทความนี้ จะนำเสนออีกทางเลือกหนึ่งคือ การใช้งานซอฟต์แวร์ประเภท <strong>Open Source FPGA Design Tools</strong> แบบ <strong>Command Line</strong>
และจะทดลองใช้งานสำหรับระบบปฏิบัติการ <strong>Linux</strong> </p>
<p>&nbsp;</p>
<hr />
<h2 id="open-source-fpga-design-tools">&#9655; <strong>ซอฟต์แวร์ Open Source FPGA Design Tools</strong><a class="headerlink" href="#open-source-fpga-design-tools" title="Permanent link">#</a></h2>
<p>ในช่วงหลายปีที่ผ่านมา ได้มีการพัฒนาซอฟต์แวร์ประเภท <strong>FOSS (Free and Open-Source Software)</strong>
สำหรับ <strong>FPGA Design Toolchain</strong> ยกตัวอย่างโครงการ
<strong>SymbiFlow / F4PGA ("FOSS Flows For FPGA") Project</strong>
(<a href="https://f4pga.org/">https://f4pga.org/</a>, 
<a href="https://github.com/F4PGA/">https://github.com/F4PGA/</a>)
ซึ่งเป็นกลุ่มทำงาน (<strong>Workgroup</strong>) ภายใต้  <a href="https://www.chipsalliance.org/"><strong>CHIPS  (Common Hardware for Interfaces, Processors and Systems)  Alliance</strong></a></p>
<p>ซอฟต์แวร์ <strong>Open Source FPGA Toolchains</strong> นำมาทดลองใช้กับชิป <strong>Commercial FPGAs</strong> ได้สำเร็จ</p>
<ul>
<li><strong>Lattice ECP5</strong>: <a href="https://github.com/YosysHQ/prjtrellis"><strong>Project Trellis</strong></a></li>
<li><strong>Lattice iCE40</strong>: <a href="https://clifford.at/icestorm"><strong>Project IceStorm</strong></a></li>
<li><strong>QuickLogic EOS S3</strong>: <a href="https://github.com/QuickLogic-Corp/quicklogic-fpga-toolchain"><strong>QuickLogic FPGA Toolchain</strong></a></li>
<li><strong>Xilinx 7-Series (Artix, Kintex, Zynq)</strong>: <a href="https://github.com/f4pga/prjxray"><strong>Project X-Ray</strong></a></li>
<li><strong>Gowin LittleBee Series</strong>: <a href="https://github.com/YosysHQ/apicula"><strong>Project Apicula</strong></a></li>
</ul>
<p><img alt="" src="f4pga_flow.png" /></p>
<p>รูป: ซอฟต์แวร์ <strong>Open Source FPGA Toolchains</strong>
(Source: <a href="https://f4pga.readthedocs.io/en/latest/how.html">SymbiFlow / F4PGA</a>)</p>
<p>&nbsp;</p>
<p>ซอฟต์แวร์ที่จะนำมาใช้งานในการออกแบบวงจรดิจิทัลสำหรับชิป <strong>Gowin FPGA</strong> 
หรือ บอร์ด <strong>Sipeed Tang Nano</strong>
ประกอบไปด้วยโปรแกรมดังนี้ (ตามลำดับการใช้งานใน <strong>FPGA Design Flow</strong>)</p>
<ol>
<li><a href="https://github.com/YosysHQ/yosys"><code>yosys</code></a> + 
<a href="https://github.com/ghdl/ghdl-yosys-plugin"><code>ghdl-yosys-plugin</code></a>:
ใช้สำหรับการสังเคราะห์วงจรดิจิทัล (<strong>Logic Synthesis</strong>) หรือแปลงโค้ดในภาษา
<strong>Verilog &amp; VHDL</strong> ในระดับ <strong>RTL (Register Transfer Level)</strong> 
ให้เป็นวงจรในระดับลอจิกเกต (<strong>Gate Level Netlist</strong>)</li>
<li><a href="https://github.com/YosysHQ/nextpnr"><code>nextpnr</code></a>:
ใช้ในการทำขั้นตอน <strong>FPGA Placement and Routing</strong></li>
<li><a href="https://github.com/YosysHQ/apicula"><code>apicula</code></a>:
ใช้ในการสร้างไฟล์ <strong>Bitstream</strong> สำหรับชิป <strong>Gowin FPGA</strong></li>
<li><a href="https://github.com/trabucayre/openFPGALoader"><code>openFPGALoader</code></a>:
ใช้สำหรับการอัปโหลดไฟล์ "บิตสตรีม" ไปยังบอร์ด <strong>FPGA</strong> ด้วยวิธี <strong>JTAG</strong></li>
</ol>
<p>แนะนำให้ผู้ใช้ติดตั้งและใช้งานโปรแกรมเหล่านี้กับระบบปฏิบัติการ <strong>Linux</strong> และผู้ใช้สามารถเลือกใช้งานได้หลายวิธี เช่น</p>
<ul>
<li>การติดตั้งและใช้งาน <strong>Ubuntu Virtual Machine (VM)</strong> โดยใช้ร่วมกับซอฟต์แวร์ <strong>Oracle VirtualBox</strong> สำหรับผู้ใช้ <strong>Windows</strong> หรือ</li>
<li>การติดตั้งและใช้งาน <strong>WSL2 - Ubuntu</strong> สำหรับผู้ใช้ <strong>Windows 10 / 11</strong> หรือ</li>
<li>การติดตั้งและใช้งาน <strong>Raspbian OS (64-bit)</strong> ร่วมกับบอร์ด <strong>Raspberry Pi 4 Model B</strong></li>
</ul>
<p>&nbsp;</p>
<hr />
<h2 id="yosys-project">&#9655; <strong>การติดตั้งโปรแกรมของ Yosys Project</strong><a class="headerlink" href="#yosys-project" title="Permanent link">#</a></h2>
<p>การติดตั้งโปรแกรม <strong>Yosys Open SYnthesis Suite</strong>
สำหรับ <strong>Ubuntu 22.04 LTS</strong> มีขั้นตอนในการทำคำสั่งดังนี้</p>
<pre><code class="language-text">## Build the Yosys project from source.

# Install all prerequisites for building yosys on Ubuntu 22.04 LTS.
$ sudo apt install build-essential clang bison flex \
   libreadline-dev gawk tcl-dev libffi-dev git \
   graphviz xdot pkg-config python3 zlib1g-dev \
   libboost-dev libboost-system-dev libboost-program-options-dev \
   libboost-python-dev libboost-filesystem-dev \
   libboost-thread-dev libboost-iostreams-dev

# Clone the git repository of yosys into the ~/Tools directory.
$ mkdir -p ~/Tools &amp;&amp; cd ~/Tools
$ git clone https://github.com/YosysHQ/yosys.git

# Configure the build system and use clang as the compiler.
$ cd yosys
$ make config-clang
$ mkdir -p build &amp;&amp; cd build
$ make -j $(nproc) -f ../Makefile

# Install the yosys program files.
# The default installation directory is /usr/local/.
$ sudo make install -f ../Makefile
</code></pre>
<p>เมื่อทำขั้นตอนติดตั้งได้สำเร็จแล้ว ให้ลองทำคำสั่งเพื่อเรียกใช้โปรแกรมดังกล่าว เช่น ตรวจสอบดูเวอร์ชันของโปรแกรม
(เวอร์ชันที่ได้ทดลองใช้ในบทความนี้คือ <code>Yosys 0.31+45</code>)</p>
<pre><code class="language-text"># Show the version of the installed yosys program.
# On Ubuntu 22.04
$ ./yosys --version

Yosys 0.31+45 (git sha1 f37ce5c83, clang 14.0.0-1ubuntu1.1) 
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="ghdl-ghdl-yosys-plugin">&#9655; <strong>การติดตั้งโปรแกรม GHDL และ GHDL-Yosys Plugin</strong><a class="headerlink" href="#ghdl-ghdl-yosys-plugin" title="Permanent link">#</a></h2>
<p>การติดตั้งโปรแกรม <strong>GHDL</strong> สำหรับ <strong>Ubuntu 22.04 LTS</strong> มีขั้นตอนการทำคำสั่งดังนี้</p>
<pre><code class="language-text">## Build the GHDL from source.

$ mkdir -p ~/Tools &amp;&amp; cd ~/Tools

# Install prerequisites.
$ sudo apt install -y git make gnat zlib1g-dev clang llvm

# Clone the GHDL repository from github.
$ git clone https://github.com/ghdl/ghdl.git

$ cd ghdl
$ export LDFLAGS=&quot;-Wl,--copy-dt-needed-entries -ldl&quot; 

# Run the configure command to configure and prepare 
# software source code for compilation. 
$ ./configure --with-llvm-config --enable-libghdl

# Run the make command to build the the GHDL program.
$ make -j $(nproc)

# Install the GHDL program.
$ sudo make install

# Update the cache database of shared libraries. 
$ sudo ldconfig
</code></pre>
<p>เมื่อทำขั้นตอนติดตั้งได้สำเร็จแล้ว ให้ลองทำคำสั่ง เช่น เพื่อตรวจสอบดูเวอร์ชันของโปรแกรม
(เวอร์ชันที่ได้ทดลองใช้ในบทความนี้คือ <code>GHDL 4.0.0-dev</code>)</p>
<pre><code class="language-text"># On Ubuntu 22.04
$ ghdl --version | head -n 4

GHDL 4.0.0-dev (3.0.0.r340.g664bf403b) [Dunoon edition]
 Compiled with GNAT Version: 10.5.0
 llvm 14.0.0 code generator
Written by Tristan Gingold.

# Show the locations of the GHDL shared libraries
$ ls -c1 /usr/local/lib/libghdl*.so

/usr/local/lib/libghdl-4_0_0_dev.so
/usr/local/lib/libghdlvpi.so
</code></pre>
<p>ถัดไปให้ทำขั้นตอนการติดตั้งโปรแกรม <strong>GHDL-Yosys Plugin</strong> 
สำหรับ <strong>Ubuntu 22.04 LTS</strong> ซึ่งคำสั่งดังนี้</p>
<pre><code class="language-text">## Build the GHDL-Yosys Plugin from Source

$ mkdir -p ~/Tools &amp;&amp; cd ~/Tools
$ git clone https://github.com/ghdl/ghdl-yosys-plugin.git
$ cd ghdl-yosys-plugin
$ make -j $(nproc)

$ sudo make install
# yosys-config --exec mkdir -p /usr/local/share/yosys/plugins
# yosys-config --exec cp ghdl.so /usr/local/share/yosys/plugins

$ sudo ldconfig
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="apicula-project">&#9655; <strong>การติดตั้งโปรแกรมของ Apicula Project</strong><a class="headerlink" href="#apicula-project" title="Permanent link">#</a></h2>
<p>การติดตั้งโปรแกรม <strong>Apycula (Python-based)</strong> สำหรับ <strong>Ubuntu 22.04 LTS</strong>
มีขั้นตอนในการทำคำสั่งดังนี้ (ในบทความนี้ได้เจาะจงใช้เวอร์ชัน <strong>Apycula v0.8.2</strong> 
ซึ่งเป็นเวอร์ชันล่าสุดในขณะที่ได้ลองใช้งาน)</p>
<pre><code class="language-text"># Install the Apycula Python packages
$ sudo apt install python3-pip
$ pip3 install apycula==0.8.2
$ export PATH=$HOME/.local/bin:$PATH
</code></pre>
<p>&nbsp;</p>
<p>ให้เพิ่มบรรทัดต่อไปนี้ ลงในไฟล์ <code>~/.bashrc</code> โดยทำคำสั่งต่อไปนี้</p>
<pre><code class="language-text">echo 'PATH=&quot;$HOME/.local/bin/:$PATH&quot;' &gt;&gt; ~/.bashrc
</code></pre>
<p>&nbsp;</p>
<p>โปรแกรมที่มีชื่อว่า <code>gowin_bba</code> เป็นส่วนหนึ่งของโปรแกรม  <strong>Apycula</strong> และได้มีการติดตั้งไว้ภายใต้
<code>$HOME/.local/bin</code> จะถูกนำไปใช้ร่วมกับโปรแกรมของ <strong>Nextpnr Project</strong>
ซึ่งจะต้องมีการติดตั้งในระบบเป็นลำดับถัดไป</p>
<p>โปรแกรม <a href="https://pypi.org/project/Apycula/"><strong>Apycula</strong></a> รองรับการใช้งานชิปของ <strong>Gowin FPGA</strong> 
และบอร์ด <strong>Sipeed Tang FPGA</strong> เช่น</p>
<ul>
<li><strong>Sipeed Tang Nano: GW1N-LV1QN48C6/I5</strong></li>
<li><strong>Sipeed Tang Nano 1K: GW1NZ-LV1QN48C6/I5</strong></li>
<li><strong>Sipeed Tang Nano 4K: GW1NSR-LV4CQN48PC7/I6</strong></li>
<li><strong>Sipeed Tang Nano 9K: GW1NR-LV9QN88PC6/I5</strong></li>
<li><strong>Sipeed Tang Nano 20K: GW2A-LV18QN88C8/I7</strong></li>
</ul>
<p>&nbsp;</p>
<hr />
<h2 id="nextpnr-project">&#9655; <strong>การติดตั้งโปรแกรมของ Nextpnr Project</strong><a class="headerlink" href="#nextpnr-project" title="Permanent link">#</a></h2>
<p>การติดตั้งโปรแกรม <strong>Nextpnr (Next-Generation Place &amp; Route Tools)</strong>
สำหรับ <strong>Gowin FPGA</strong> (โปรแกรมมีชื่อว่า <code>nextpnr-gowin</code>) มีขั้นตอนในการทำคำสั่งดังนี้</p>
<pre><code class="language-text">## Build the Nextpnr project from Source.

# Install prerequisites.
$ sudo apt install -y cmake clang git clang-format python3-dev \
  libboost-dev libboost-filesystem-dev \
  libboost-thread-dev libboost-program-options-dev \
  libboost-iostreams-dev libboost-dev libeigen3-dev

$ mkdir -p ~/Tools &amp;&amp; cd ~/Tools
$ git clone https://github.com/YosysHQ/nextpnr.git
$ cd nextpnr
$ cmake . -DARCH=gowin \
  -DGOWIN_BBA_EXECUTABLE=`which gowin_bba`
$ make -j $(nproc)
$ sudo make install

# Show the version of the installed nextpnr-gowin program.
$ nextpnr-gowin --version
&quot;nextpnr-gowin&quot; -- Next Generation Place and Route 
(Version nextpnr-0.6-29-g54b20457)
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="openfpgaloader-project">&#9655; <strong>การติดตั้งโปรแกรมของ openFPGALoader Project</strong><a class="headerlink" href="#openfpgaloader-project" title="Permanent link">#</a></h2>
<p>การติดตั้งโปรแกรม <code>openFPGALoader</code>
(<strong>Universal Utility for Programming FPGA</strong>) ทำตามขั้นตอนที่มีการเขียนไว้ในเอกสาร
<a href="https://trabucayre.github.io/openFPGALoader/guide/install.html">"<strong>openFPGALoader Installation - User Guide</strong>"</a></p>
<pre><code class="language-text">## Build the openFPGA project from source.

# Install prerequisites.
$ sudo apt install -y libftdi1-2 libftdi1-dev \
   libhidapi-hidraw0 libhidapi-dev libudev-dev \
   zlib1g-dev cmake pkg-config make g++

$ mkdir -p ~/Tools &amp;&amp; cd ~/Tools
$ git clone https://github.com/trabucayre/openFPGALoader.git
$ cd openFPGALoader 
$ mkdir -p build &amp;&amp; cd build
$ cmake ../ &amp;&amp; cmake --build .
$ sudo make install
</code></pre>
<p>เมื่อทำขั้นตอนติดตั้งได้สำเร็จแล้ว ให้ลองทำคำสั่ง เช่น เพื่อตรวจสอบดูเวอร์ชันของโปรแกรม
(เวอร์ชันที่ได้ทดลองใช้ในบทความนี้คือ <code>openFPGALoader v0.11.0</code>)</p>
<pre><code class="language-text"># Show the version of the installed openFPGALoader program.
$ openFPGALoader -V
openFPGALoader v0.11.0
</code></pre>
<p>ขั้นตอนถัดไปคือ การดาวน์โหลดและติดตั้งไฟล์ <code>99-openfpgaloader.rules</code> สำหรับ <strong>Linux udev</strong></p>
<pre><code class="language-text"># Download the 99-openfpgaloader.rules file
$ URL=https://github.com/trabucayre/openFPGALoader; \
  URL=$URL/raw/master/99-openfpgaloader.rules; \
  wget -N $URL -O 99-openfpgaloader.rules
$ sudo cp ./99-openfpgaloader.rules /etc/udev/rules.d/

# Reload and update the udev rules
$ sudo udevadm control --reload-rules &amp;&amp; \
  sudo udevadm trigger

# Add the current user to the 'plugdev' group
$ sudo usermod -a $USER -G plugdev 
</code></pre>
<p>&nbsp;</p>
<hr />
<h2 id="sipeed-tang-nano-1k">&#9655; <strong>การทดลองโดยใช้บอร์ด Sipeed Tang Nano 1K</strong><a class="headerlink" href="#sipeed-tang-nano-1k" title="Permanent link">#</a></h2>
<p>บอร์ด <strong>Sipeed Tang Nano 1K</strong> มีชิป <strong>Gowin FPGA</strong> รุ่น <strong>GW1NZ-LV1-QN48C6/I5</strong>
ในตัวอย่างโค้ด <strong>VHDL</strong> ต่อไปนี้ จะสาธิตการใช้งานวงจรปุ่มกดและวงจร <strong>RGB LED</strong> บนบอร์ด
<strong>Tang Nano 1K</strong> โดยใช้สัญญาณ <strong>Clock</strong> ความถี่ <strong>27MHz</strong> จากวงจร <strong>Crystal Oscillator</strong>
บนบอร์ดดังกล่าว สำหรับกำหนดจังหวะการทำงานของวงจรดิจิทัล</p>
<ul>
<li><strong>SYS_CLK (3.3V)</strong>: Pin 47 / IOT10A</li>
<li><strong>KEY_A (Active-low, 3.3V)</strong>: Pin 13 / IOT12B</li>
<li><strong>RGB LED (Active-low, 3.3V)</strong>:<ul>
<li>LED_R: Pin 09 / IOR2A</li>
<li>LED_G: Pin 11 / IOR3A</li>
<li>LED_B: Pin 10 / IOR3B</li>
</ul>
</li>
</ul>
<p><img alt="" src="tang_nano_1k_breadboard.jpg" /></p>
<p>รูป: บอร์ด <strong>Tang Nano 1K</strong> ที่ได้นำมาทดลองใช้งาน</p>
<p>ไฟล์ที่ใช้ในการทดลอง มี 3 ไฟล์</p>
<ul>
<li><code>leds_running.vhd</code>: <strong>VHDL Source Code</strong></li>
<li><code>leds_running.cst</code>: <strong>Gowin Physical Constraint File (for GW1NZ-LV1QN48C6/I5)</strong></li>
<li><code>Makefile</code>: ใช้สำหรับการทำคำสั่ง <code>make</code> เพื่อทำขั้นตอนต่าง ๆ ของ <strong>FPGA Design Flow</strong></li>
</ul>
<p>&nbsp;</p>
<p><strong>File</strong>: <a href="files-1/leds_running.vhd"><code>leds_running.vhd</code></a></p>
<pre><code class="language-vhdl">------------------------------------------------------------------
library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;
------------------------------------------------------------------

entity LEDS_RUNNING is
  generic (
     CLK_HZ   : natural := 27000000;
     NUM_LEDS : natural := 3
  );
  port(
     CLK  : in std_logic; -- system clock
     nRST : in std_logic; -- global asynchronous reset (active-low)
     LEDS : out std_logic_vector(NUM_LEDS-1 downto 0) -- LED Pins
  );
end LEDS_RUNNING;

architecture SYNTH of LEDS_RUNNING is
  constant COUNT_PERIOD : integer := CLK_HZ/10;
  subtype count_t is integer range 0 to (COUNT_PERIOD-1); 
  signal  count : count_t := 0;
  signal  leds_reg : std_logic_vector(NUM_LEDS-1 downto 0);
  signal  shift_en : std_logic;

begin

  -- Use the register's bits (inverted) for LED outputs
  LEDS &lt;= not leds_reg; 

  process (nRST, CLK) begin
    if nRST = '0' then
      count &lt;= 0;
      shift_en &lt;= '0';
    elsif rising_edge(CLK) then
      -- check whether the counter reaches the max. value.
      if count = (COUNT_PERIOD-1) then 
        count &lt;= 0;       -- reset the counter.
        shift_en &lt;= '1';  -- enable register shift.
      else
        count &lt;= count+1; -- increment counter by 1.
        shift_en &lt;= '0';  -- disable register shift.
      end if;
    end if;
  end process;

  process (nRST, CLK) begin
    if nRST = '0' then
      -- Initialize the LEDs register.
      leds_reg(0) &lt;= '1'; 
      leds_reg(leds_reg'left downto 1) &lt;= (others =&gt; '0');
    elsif rising_edge(CLK) then
      if shift_en='1' then -- Bit shifting is enabled.  
        -- Rotate-left shift.
        leds_reg &lt;= leds_reg(leds_reg'left-1 downto 0) 
                  &amp; leds_reg(leds_reg'left); 
      end if;
    end if;
  end process;

end SYNTH;
</code></pre>
<p><strong>File</strong>: <a href="files-1/leds_running.cst"><code>leds_running.cst</code></a> (Gowin Physical Constraint File
<em>for Tang Nano 9K Board</em>)</p>
<pre><code class="language-text">//Part Number: GW1NZ-LV1QN48C6/I5
IO_LOC &quot;CLK&quot;     47;
IO_LOC &quot;nRST&quot;    13;
IO_LOC &quot;LEDS[0]&quot; 9;
IO_LOC &quot;LEDS[1]&quot; 11;
IO_LOC &quot;LEDS[2]&quot; 10;

IO_PORT &quot;CLK&quot;     IO_TYPE=LVCMOS33; 
IO_PORT &quot;nRST&quot;    IO_TYPE=LVCMOS18 PULL_MODE=UP; 
IO_PORT &quot;LEDS[0]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;LEDS[1]&quot; IO_TYPE=LVCMOS33 DRIVE=8; 
IO_PORT &quot;LEDS[2]&quot; IO_TYPE=LVCMOS33 DRIVE=8;
</code></pre>
<p><strong>File</strong>: <a href="./files-1/Makefile"><code>Makefile</code></a> (<em>for VHDL code</em>)</p>
<pre><code class="language-text">############################################################
BOARD=tangnano1k
FAMILY=GW1NZ-1
DEVICE=GW1NZ-LV1QN48C6/I5

SRCS=$(wildcard *.vhd)
TOP=leds_running

# &lt;target name&gt;: &lt;target dependencies&gt;
# &lt;tab&gt; &lt;target commands&gt;

YOSYS_CMD=ghdl $(SRCS) -e $(TOP);
YOSYS_CMD+=synth_gowin -json synth.json

all: bitstream.fs
    @echo &quot;Done...&quot;

# Logic Synthesis
synth.json: $(SRCS)
    @echo &quot;Starting the FPGA design flow...&quot;
    yosys -m ghdl -p '$(YOSYS_CMD)'

# Place &amp; Route Step
pnr.json: synth.json
    nextpnr-gowin \
        --json synth.json \
        --write pnr.json \
        --device ${DEVICE} \
        --family ${FAMILY} \
        --cst ${TOP}.cst \
        --freq 27

# Bitstream Generation
bitstream.fs: pnr.json
    gowin_pack -d ${FAMILY} -o bitstream.fs pnr.json

# Device Programming: upload bitstream to on-chip SRAM
upload_sram: bitstream.fs
    openFPGALoader -b ${BOARD} bitstream.fs

# Device Programming: upload bitstream to on-chip Flash
upload_flash: bitstream.fs
    openFPGALoader -b ${BOARD} bitstream.fs -f

clean:
    rm -f *.fs *.json *.cf *.o

# The following targets do not represent a file.
.PHONY: all clean upload_sram upload_flash

# The following files can be removed when finished.
.INTERMEDIATE: synth.json pnr.json
</code></pre>
<p>ตัวอย่างการทำคำสั่ง <code>make</code> โดยเรียกใช้ไฟล์ <strong>Makefile</strong> มีดังนี้</p>
<p><img alt="" src="wsl2_ubuntu_make-1.png" /></p>
<p><img alt="" src="wsl2_ubuntu_make-2.png" /></p>
<p>รูป: การทำคำสั่ง <code>make</code> และตัวอย่างข้อความเอาต์พุตบางส่วน</p>
<p>เมื่อทำคำสั่งได้สำเร็จ ก็จะได้ไฟล์ <code>bitstream.fs</code> ถ้าเชื่อมต่อบอร์ด
<strong>Tang Nano 1K</strong> กับพอร์ต <strong>USB</strong> ของเครื่องผู้ใช้ ก็สามารถทำคำสั่ง
เพื่ออัปโหลดไฟล์บิตสตรีมไปยังบอร์ด <strong>FPGA</strong> ได้ ซึ่งเป็นการเรียกใช้โปรแกรม
<code>openFPGALoader</code></p>
<pre><code class="language-text"># upload bitstream to on-chip SRAM
$ make upload_sram

# or upload bitstream to embedded Configuration Flash 
$ make upload_flash
</code></pre>
<p>&nbsp;</p>
<p><strong>คำแนะนำ: สำหรับผู้ใช้ WSL2 ร่วมกับ Ubuntu</strong></p>
<p>ถ้าใช้ <strong>WSL Kernel</strong> ตั้งแต่เวอร์ชัน 5.10.60.1 เป็นต้นไป
ก็สามารถใช้โปรแกรมที่มีชื่อว่า <code>usbipd</code> (<strong>USB-over-IP Server Daemon</strong>) 
เพื่อทำให้มองเห็นอุปกรณ์ <strong>USB</strong> ได้ใน <strong>WSL2-Ubuntu</strong>
แต่มีขั้นตอนที่จะต้องดำเนินการก่อนใช้งาน</p>
<p>ทำคำสั่งต่อไปนี้ใน <strong>WSL2 - Ubuntu Terminal</strong>
เพื่อติดตั้งแพ็กเกจสำหรับ <strong>Ubuntu</strong></p>
<pre><code class="language-text">$ sudo apt install -y linux-tools-virtual hwdata
$ sudo update-alternatives \
 --install /usr/local/bin/usbip usbip \
 `ls /usr/lib/linux-tools/*/usbip | tail -n1` 20
</code></pre>
<p>ถัดไปให้เปิดใช้งาน <strong>Windows PowerShell</strong> 
(<strong><em>Run in "Adminstrator Mode"</em></strong>) ของ <strong>Windows 10 / 11</strong> 
แล้วทำคำสั่งต่อไปนี้ เพื่อแสดงรายการอุปกรณ์ <strong>USB</strong> ที่มองเห็นได้ใน <strong>Windows</strong>
และให้เชื่อมต่อบอร์ด <strong>Tang Nano</strong> กับพอร์ต <strong>USB</strong> ของคอมพิวเตอร์ผู้ใช้ </p>
<pre><code class="language-text">## Powershell

# Show the version of usbpid.
&gt; usbipd --version

# List all visible USB devices.
&gt; usbipd wsl list
</code></pre>
<p>แล้วทำคำสั่งเพื่อเลือกใช้อุปกรณ์ตามรหัส <strong>VID:PID</strong> (ในกรณีของบอร์ด 
<strong>Tang Nano</strong> คือ <code>0403:6010</code>) </p>
<pre><code class="language-text">&gt; usbipd wsl attach -i 0403:6010
</code></pre>
<p>จากนั้นให้ไปทำคำสั่งใน <strong>WSL2 - Ubuntu Terminal</strong> เพื่อตรวจสอบดูว่า
สามารถมองเห็นอุปกรณ์ <strong>USB</strong> ที่มีรหัส  <strong>VID:PID</strong> ตรงกับ <code>0403:6010</code>
หรือไม่</p>
<pre><code class="language-text">$ lsusb | sed -n 's/.*\(ID 0403\:6010\).*/\1/p'
</code></pre>
<p>&nbsp;</p>
<p>ลองทำคำสั่ง <code>openFPGALoader --detect --cable ft2232</code>
เพื่อดูว่า สามารถเชื่อมต่อกับบอร์ด <strong>FPGA</strong> ได้หรือไม่ </p>
<pre><code class="language-text">$ openFPGALoader --detect

Jtag frequency : requested 6.00MHz   -&gt; real 6.00MHz
index 0:
        idcode 0x100681b
        manufacturer Gowin
        family GW1NZ
        model  GW1NZ-1
        irlength 8
</code></pre>
<p>จากข้อความเอาต์พุต จะเห็นได้ว่า สามารถเชื่อมต่อกับบอร์ด <strong>FPGA</strong> ได้สำเร็จ</p>
<p>จากนั้นจึงทำคำสั่งเพื่ออัปโหลดไฟล์ "บิตสตรีม" ไปยังบอร์ดทดลอง</p>
<p><img alt="" src="wsl2_ubuntu_make-3.png" /></p>
<p>รูป: ตัวอย่างการทำคำสั่ง <code>make</code> เพื่ออัปโหลดไฟล์ "บิตสตรีม" ไปยังบอร์ดทดลอง
ซึ่งมีสองตัวเลือกคือ อัปโหลดไปยังหน่วยความจำ <strong>SRAM</strong> หรือ <strong>Flash</strong></p>
<p>&nbsp;</p>
<p><strong>คำแนะนำ: สำหรับผู้ใช้ Oracle VirtualBox - Ubuntu VM</strong></p>
<p>ในกรณีที่ใช้ <strong>Ubuntu Virtual Machine (VM)</strong> ร่วมกับ <strong>Oracle VirtualBox</strong>
เมื่อเชื่อมต่อบอร์ด <strong>FPGA</strong> กับคอมพิวเตอร์ของผู้ใช้แล้ว จะต้องเพิ่มรายการอุปกรณ์ <strong>USB</strong>
เพื่อให้สามารถเข้าถึงได้ใน <strong>Ubuntu VM</strong></p>
<p><img alt="" src="ubuntu_vm_usb_devices.png" /></p>
<p>รูป: ตัวอย่างการเพิ่มรายการอุปกรณ์ <strong>USB: Sipeed JTAG Debugger</strong> </p>
<p><img alt="" src="ubuntu_vm_openfpgaloader-1.png" /></p>
<p>รูป: ตัวอย่างการทำคำสั่ง <code>openFPGALoader</code> ภายใต้ <strong>Ubuntu VM</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="sipeed-tang-nano-9k">&#9655; <strong>การทดลองโดยใช้บอร์ด Sipeed Tang Nano 9K</strong><a class="headerlink" href="#sipeed-tang-nano-9k" title="Permanent link">#</a></h2>
<p>ถัดไปเป็นการทดลองโค้ด <strong>Verilog HDL (Verilog-2005)</strong> 
เพื่อนำไปทดลองใช้กับบอร์ด <strong>Tang Nano 9K</strong>
ซึ่งใช้ชิป <strong>GW1NR-LV9QN88PC6/I5</strong>
ใช้สัญญาณ <strong>Clock</strong> ความถี่ <strong>27MHz</strong> จากวงจร <strong>Crystal Oscillator</strong>
บนบอร์ด</p>
<ul>
<li><strong>Onboard Push Button (Active-low, 1.8V)</strong>:<ul>
<li>KEY_A: Pin 4 / IOT5A </li>
</ul>
</li>
<li><strong>Onboard 6x LED (Active-low, 1.8V)</strong>:<ul>
<li>LED1: Pin 10 / IOL15A</li>
<li>LED2: Pin 11 / IOL16B</li>
<li>LED3: Pin 13 / IOL21B</li>
<li>LED4: Pin 14 / IOL22B</li>
<li>LED5: Pin 15 / IOL25B</li>
<li>LED6: Pin 16 / IOL26B</li>
</ul>
</li>
<li><strong>Onboard Clock (3.3V)</strong>: 27MHz <ul>
<li>SYS_CLK: Pin 52 / IOR17A</li>
</ul>
</li>
</ul>
<p><img alt="" src="tang_nano_9k_breadboard.jpg" /></p>
<p>รูป: บอร์ด <strong>Tang Nano 9K</strong> ที่ได้นำมาทดลองใช้งาน</p>
<p>ไฟล์ที่ใช้ในการทดลอง มี 3 ไฟล์</p>
<ul>
<li><code>leds_running.v</code>: <strong>Verilog-HDL Source Code</strong></li>
<li><code>leds_running.cst</code>: <strong>Gowin Physical Constraint File (for GW1NR-LV9QN88PC6/I5)</strong></li>
<li><code>Makefile</code>: ใช้สำหรับการทำคำสั่ง <code>make</code> เพื่อทำขั้นตอนต่าง ๆ ของ <strong>FPGA Design Flow</strong></li>
</ul>
<p>&nbsp;</p>
<p><strong>File</strong>: <a href="files-2/leds_running.v"><code>leds_running.v</code></a></p>
<pre><code class="language-verilog">module leds_running #(
  parameter CLK_HZ   = 27000000,
  parameter NUM_LEDS = 6
)(
  input  wire CLK,    // system clock
  input  wire nRST,   // global asynchronous reset (active-low)
  output wire [NUM_LEDS-1:0] LEDS // LED Pins
);

  localparam COUNT_PERIOD = (CLK_HZ / 10);
  localparam COUNT_MIN = 0;
  localparam COUNT_MAX = COUNT_PERIOD - 1;

  reg [31:0] count = COUNT_MIN;
  reg [NUM_LEDS-1:0] leds_reg = 1;
  reg shift_en  = 0;
  reg shift_dir = 0;
  wire shift_reverse;

  always @(posedge CLK or negedge nRST) begin
    if (nRST == 1'b0) begin
      count &lt;= COUNT_MIN;
      shift_en &lt;= 1'b0;
    end
    else begin
      if (count == COUNT_MAX) begin
        count &lt;= COUNT_MIN;
        shift_en &lt;= 1'b1;
      end
      else begin
        count &lt;= count + 1;
        shift_en &lt;= 1'b0;
      end
    end
  end

  always @(shift_dir or leds_reg) begin
     if (  (!shift_dir &amp;&amp; leds_reg[NUM_LEDS-1])
        || ( shift_dir &amp;&amp; leds_reg[0]) )
       shift_reverse &lt;= 1'b1;
     else
       shift_reverse &lt;= 1'b0;
  end

  always @(posedge CLK or negedge nRST) begin
    if (nRST == 1'b0) begin
      shift_dir   &lt;= 1'b0;
      leds_reg[0] &lt;= 1'b1;
      leds_reg[NUM_LEDS-1:1] &lt;= {NUM_LEDS-1{1'b0}};
    end
    else begin
      if (shift_en == 1'b1) begin // Bit shifting is enabled.
        if (shift_reverse) // Reverse shifting direction
           shift_dir &lt;= !shift_dir;
        else begin
           if (!shift_dir) // Shift-left operation
             leds_reg &lt;= {leds_reg[NUM_LEDS-2:0],1'b0};
           else // Shift-right operation
             leds_reg &lt;= {1'b0,leds_reg[NUM_LEDS-1:1]};
        end
      end
    end
  end

  assign LEDS = ~leds_reg;

endmodule
</code></pre>
<p><strong>File</strong>: <a href="files-2/leds_running.cst"><code>leds_running.cst</code></a> (<em>for Tang Nano 9K Board</em>)</p>
<pre><code class="language-text">//Part Number: GW1NR-LV9QN88PC6/I5

IO_LOC &quot;CLK&quot;     52;
IO_LOC &quot;nRST&quot;     4;
IO_LOC &quot;LEDS[0]&quot; 10;
IO_LOC &quot;LEDS[1]&quot; 11;
IO_LOC &quot;LEDS[2]&quot; 13;
IO_LOC &quot;LEDS[3]&quot; 14;
IO_LOC &quot;LEDS[4]&quot; 15;
IO_LOC &quot;LEDS[5]&quot; 16;

IO_PORT &quot;CLK&quot;     IO_TYPE=LVCMOS33; 
IO_PORT &quot;nRST&quot;    IO_TYPE=LVCMOS18 PULL_MODE=UP; 
IO_PORT &quot;LEDS[0]&quot; IO_TYPE=LVCMOS18 DRIVE=8; 
IO_PORT &quot;LEDS[1]&quot; IO_TYPE=LVCMOS18 DRIVE=8; 
IO_PORT &quot;leds[2]&quot; IO_TYPE=LVCMOS18 DRIVE=8;
IO_PORT &quot;leds[3]&quot; IO_TYPE=LVCMOS18 DRIVE=8;
IO_PORT &quot;leds[4]&quot; IO_TYPE=LVCMOS18 DRIVE=8;
IO_PORT &quot;leds[5]&quot; IO_TYPE=LVCMOS18 DRIVE=8;
</code></pre>
<p><strong>File</strong>: <a href="./files-2/Makefile"><code>Makefile</code></a> (<em>for Verilog Code</em>)</p>
<pre><code class="language-text">############################################################
BOARD=tangnano9k
FAMILY=GW1N-9C
DEVICE=GW1NR-LV9QN88PC6/I5

SRCS=$(wildcard *.v)
TOP=leds_running

# &lt;target name&gt;: &lt;target dependencies&gt;
# &lt;tab&gt; &lt;target commands&gt;

YOSYS_CMD=read_verilog $(SRCS);
YOSYS_CMD+=synth_gowin -top ${TOP} -json synth.json

all: bitstream.fs
    @echo &quot;Done...&quot;

# Logic Synthesis
synth.json: $(SRCS)
    @echo &quot;Starting the FPGA design flow...&quot;
    yosys -p '$(YOSYS_CMD)'

# Place &amp; Route Step
pnr.json: synth.json
    nextpnr-gowin \
        --json synth.json \
        --write pnr.json \
        --device ${DEVICE} \
        --family ${FAMILY} \
        --cst ${TOP}.cst \
        --freq 27

# Bitstream Generation
bitstream.fs: pnr.json
    gowin_pack -d ${FAMILY} -o bitstream.fs pnr.json

# Device Programming: upload bitstream to on-chip SRAM
upload_sram: bitstream.fs
    openFPGALoader -b ${BOARD} bitstream.fs

# Device Programming: upload bitstream to on-chip Flash
upload_flash: bitstream.fs
    openFPGALoader -b ${BOARD} bitstream.fs -f

clean:
    rm -f *.fs *.json *.cf *.o

# The following targets do not represent a file.
.PHONY: all clean upload_sram upload_flash

# The following files can be removed when finished.
.INTERMEDIATE: synth.json pnr.json
</code></pre>
<p>ลองทำคำสั่ง <code>openFPAGLoader</code>
เพื่อตรวจสอบดูว่า สามารถมองเห็นบอร์ด <strong>Tang Nano 9K</strong> หรือไม่</p>
<pre><code class="language-text">$ openFPGALoader --detect --cable ft2232

Jtag frequency : requested 6.00MHz   -&gt; real 6.00MHz
index 0:
        idcode 0x100481b
        manufacturer Gowin
        family GW1N
        model  GW1N(R)-9C
        irlength 8
</code></pre>
<p><img alt="" src="tang_nano_9k_leds_running_upload.png" /></p>
<p>รูป: ตัวอย่างการทำคำสั่ง <code>make</code> เพื่ออัปโหลดไฟล์บิตสตรีมไปยังบอร์ด <strong>Tang Nano 9K</strong></p>
<p><img alt="" src="ubuntu_vm_openfpgaloader-2.png" /></p>
<p>รูป: ตัวอย่างการทำคำสั่ง <code>make</code> ภายใต้ <strong>Ubuntu VM</strong></p>
<p>&nbsp;</p>
<hr />
<h2 id="_1">&#9655; <strong>แหล่งข้อมูลอ้างอิงและศึกษาเพิ่มเติม</strong><a class="headerlink" href="#_1" title="Permanent link">#</a></h2>
<ul>
<li><a href="https://wiki.sipeed.com/hardware/en/tang/">https://wiki.sipeed.com/hardware/en/tang/</a></li>
<li><a href="https://github.com/YosysHQ/yosys">https://github.com/YosysHQ/yosys</a></li>
<li><a href="https://github.com/YosysHQ/nextpnr">https://github.com/YosysHQ/nextpnr</a></li>
<li><a href="https://github.com/YosysHQ/apicula">https://github.com/YosysHQ/apicula</a></li>
<li><a href="https://github.com/ghdl/ghdl">https://github.com/ghdl/ghdl</a> </li>
<li><a href="https://github.com/ghdl/ghdl-yosys-plugin">https://github.com/ghdl/ghdl-yosys-plugin</a></li>
<li><a href="https://github.com/trabucayre/openFPGALoader">https://github.com/trabucayre/openFPGALoader</a></li>
<li><a href="https://trabucayre.github.io/openFPGALoader/vendors/gowin.html">https://trabucayre.github.io/openFPGALoader/vendors/gowin.html</a></li>
</ul>
<hr />
<h2 id="_2">&#9655; <strong>กล่าวสรุป</strong><a class="headerlink" href="#_2" title="Permanent link">#</a></h2>
<p>บทความนี้ได้นำเสนอซอฟต์แวร์ประเภท <strong>Open Source FPGA Toolchain</strong>
ที่สามารถนำมาใช้งานกับบอร์ด <strong>Sipeed Tang FPGA</strong> ได้หลายรุ่น
และมีการสาธิตการติดตั้งและใช้งานสำหรับระบบปฏิบัติการ <strong>Linux / Ubuntu 22.04</strong> 
พร้อมตัวอย่างโค้ด <strong>VHDL</strong> และ <strong>Verilog</strong> เพื่อการทดลองใช้งานในเบื้องต้น
ดังนั้นการใช้ซอฟต์แวร์ประเภทนี้ จึงเป็นอีกทางเลือกหนึ่งนอกเหนือจากการใช้ซอฟต์แวร์ <strong>Gowin EDA</strong></p>
<p>&nbsp;</p>
<hr />
<p><em>This work is licensed under a</em> <strong><em>Creative Commons Attribution-ShareAlike 4.0 International License.</em></strong></p>
<p>Created: 2023-08-04 | Last Updated: 2023-08-07</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2021-2024 IoT Engineering Education, Bangkok/Thailand</a></p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
